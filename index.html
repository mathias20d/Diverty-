<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diverty Eventos | Fiestas Infantiles en Panam√° Centro | Animaci√≥n y Shows</title>
    <meta name="description" content="Organizamos fiestas infantiles m√°gicas en Panam√° Centro. Animadores, shows de burbujas, pintacaritas y m√°s. ¬°Haz la fiesta so√±ada de tus hijos con Diverty Eventos!">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-R3G3Y0FLVN"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-R3G3Y0FLVN');
    </script>

    <!-- Schema Markup (Datos Estructurados) para LocalBusiness y Organization - SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": ["LocalBusiness", "Organization"],
      "name": "Diverty Eventos",
      "image": "https://placehold.co/1200x630/A78BFA/ffffff?text=Diverty+Eventos+Logo",
      "url": "TU_URL_DEL_SITIO_WEB_AQUI", <!-- ¬°IMPORTANTE! Reemplaza con la URL real de tu sitio -->
      "telephone": "+50766677965",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "Tu Direcci√≥n Exacta Aqu√≠ (Ej: Calle 50, Edificio XYZ)", <!-- ¬°IMPORTANTE! Reemplaza con tu direcci√≥n f√≠sica -->
        "addressLocality": "Panam√° Centro",
        "addressRegion": "Panam√°",
        "postalCode": "Tu C√≥digo Postal Aqu√≠", <!-- Opcional, pero recomendado si lo tienes -->
        "addressCountry": "PA"
      },
      "priceRange": "$$",
      "openingHoursSpecification": [
        {
          "@type": "OpeningHoursSpecification",
          "dayOfWeek": [
            "Monday",
            "Tuesday",
            "Wednesday",
            "Thursday",
            "Friday"
          ],
          "opens": "09:00",
          "closes": "18:00"
        },
        {
          "@type": "OpeningHoursSpecification",
          "dayOfWeek": [
            "Saturday",
            "Sunday"
          ],
          "opens": "10:00",
          "closes": "17:00"
        }
      ],
      "hasOfferCatalog": {
        "@type": "OfferCatalog",
        "name": "Cat√°logo de Servicios y Paquetes de Fiestas Infantiles",
        "itemListElement": [
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Pintacaritas",
              "description": "Transforma a los ni√±os en sus personajes favoritos con pinturas hipoalerg√©nicas."
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Globoflexia",
              "description": "Figuras divertidas y creativas hechas con globos para cada invitado."
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Show de Burbujas Gigantes",
              "description": "¬°Burbujas enormes que los ni√±os pueden atrapar y explotar! Un s√∫per show √∫nico en Panam√°."
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Decoraciones Tem√°ticas",
              "description": "Transforma cualquier espacio en un mundo m√°gico con nuestras decoraciones personalizadas."
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "M√°quinas de Snack Algod√≥n y Pop Corn",
              "description": "M√°quinas de algod√≥n de az√∫car y palomitas de ma√≠z para endulzar tu evento."
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Paquete Fiesta M√°gica Express",
              "description": "Diversi√≥n con animador, juegos, globos y pi√±ata. Ideal para fiestas express."
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Paquete Aventura de Ensue√±o",
              "description": "Servicio completo con payaso, pintacaritas, animaci√≥n, juegos y pi√±ata."
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Paquete Celebraci√≥n Personalizada",
              "description": "Servicio premium con payaso, animaci√≥n, pintacaritas, show de magia c√≥mica y asistencia para pi√±ata."
            }
          }
        ]
      },
      "slogan": "¬°Hacemos magia!",
      "description": "Diverty Eventos ofrece la mejor animaci√≥n y shows para fiestas infantiles en Panam√° Centro, Arraij√°n, La Chorrera, Pacora y Panam√° Norte. Especialistas en shows de burbujas, pintacaritas y paquetes de diversi√≥n inolvidable."
    }
    </script>
    <!-- Tailwind CSS CDN para estilos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter para la tipograf√≠a -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Estilos base para el cuerpo de la p√°gina */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
        }
        /* Estilos personalizados para el hover de botones para consistencia */
        .hover\:bg-purple-600:hover { background-color: #7c3aed; }
        .hover\:bg-pink-600:hover { background-color: #db2777; }
        .hover\:bg-blue-600:hover { background-color: #2563eb; }
        .hover\:bg-green-600:hover { background-color: #16a34a; }
        .hover\:bg-indigo-600:hover { background-color: #4f46e5; }
        /* Estilo para tachar texto (precios anteriores) */
        .line-through { text-decoration: line-through; }

        /* Estilo para el bot√≥n flotante de WhatsApp */
        .whatsapp-float-button {
            position: fixed;
            bottom: 80px; /* Se ajust√≥ la posici√≥n para que est√© m√°s arriba */
            right: 20px;
            z-index: 1000; /* Asegura que est√© por encima de otros elementos */
            width: 56px; /* Ajuste para que el bot√≥n sea cuadrado */
            height: 56px;
            display: flex; /* Usar flexbox para centrar contenido */
            justify-content: center; /* Centra el icono horizontalmente */
            align-items: center; /* Centra el icono verticalmente */
            border-radius: 9999px; /* Redondo completo */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* Sombra m√°s pronunciada */
            transition: all 0.3s ease; /* Transiciones suaves para hover */
            background-color: #25D366; /* Color de fondo de WhatsApp */
        }
        .whatsapp-float-button:hover {
            transform: scale(1.1); /* Ligero aumento de tama√±o al pasar el rat√≥n */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); /* Sombra a√∫n m√°s pronunciada en hover */
        }

        /* Estilos para el FAQ (aunque no se usan ya) */
        .faq-question {
            cursor: pointer;
            padding: 1rem;
            background-color: #f3f4f6; /* bg-gray-100 */
            border-bottom: 1px solid #e5e7eb; /* border-gray-200 */
            font-weight: 600; /* font-semibold */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .faq-answer {
            padding: 1rem;
            background-color: #ffffff; /* bg-white */
            border-bottom: 1px solid #e5e7eb; /* border-gray-200 */
            display: none; /* Oculto por defecto */
        }
        .faq-arrow {
            transition: transform 0.3s ease;
        }
        .faq-question.active .faq-arrow {
            transform: rotate(180deg);
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-200 via-pink-200 to-yellow-200 text-gray-800 flex flex-col">

    <!-- Modal de Informaci√≥n General -->
    <div id="infoModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white rounded-xl shadow-2xl p-6 max-w-sm w-full text-center border-4 border-purple-400">
            <p id="modalMessage" class="text-xl font-bold mb-4 text-purple-700"></p>
            <button id="closeModalButton" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-5 rounded-full shadow-lg transition duration-300">
                ¬°Entendido! üéâ
            </button>
        </div>
    </div>

    <!-- Modal de Promoci√≥n -->
    <div id="promoModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white rounded-xl shadow-2xl p-6 max-w-md w-full text-center border-4 border-green-400">
            <h2 class="text-3xl font-extrabold text-green-700 mb-4">¬°Promoci√≥n del Mes! üåü</h2>
            <p id="promoMessage" class="text-lg text-gray-800 mb-4"></p>
            <button id="closePromoModalButton" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-5 rounded-full shadow-lg transition duration-300">
                ¬°Genial! üéâ
            </button>
        </div>
    </div>

    <!-- Encabezado (Men√∫ de Navegaci√≥n Principal) -->
    <header class="bg-white bg-opacity-95 shadow-xl p-4 w-full rounded-b-xl">
        <nav class="container mx-auto flex flex-col sm:flex-row justify-between items-center">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-purple-700 mb-4 sm:mb-0 text-center sm:text-left">
                Diverty Eventos ‚ú®ü•≥
            </h1>
            <ul class="flex flex-wrap justify-center sm:space-x-4 space-x-2">
                <li><button id="navHome" class="text-base font-bold py-1 px-3 rounded-full text-gray-700 hover:bg-purple-100">Inicio üè†</button></li>
                <li><button id="navServices" class="text-base font-bold py-1 px-3 rounded-full text-gray-700 hover:bg-purple-100">Servicios üìã</button></li>
                <li><button id="navPackages" class="text-base font-bold py-1 px-3 rounded-full text-gray-700 hover:bg-purple-100">Paquetes üì¶</button></li>
                <!-- Se elimin√≥ el bot√≥n de Rese√±as -->
                <li><button id="navBooking" class="text-base font-bold py-1 px-3 rounded-full text-gray-700 hover:bg-purple-100">Reservar üóìÔ∏è</button></li>
            </ul>
        </nav>
    </header>

    <!-- Resumen del Carrito de Compra (Barra Flotante) -->
    <div id="cartSummary" class="bg-yellow-200 text-purple-800 font-extrabold p-6 text-center rounded-b-lg shadow-lg border-4 border-yellow-400 hidden">
        <p class="text-2xl sm:text-3xl mb-3">
            üõí √çtems seleccionados: <span id="selectedItemsCount" class="text-purple-700">0</span> | Total: <span id="totalPriceDisplay" class="text-pink-700">$0.00</span>
        </p>
        <button id="proceedToBookButton" class="mt-2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-full shadow-md text-base sm:text-lg">
            Proceder a Reservar Ahora! ‚ú®
        </button>
    </div>

    <!-- √Årea de Contenido Principal (donde se cargan las secciones) -->
    <main id="mainContent" class="container mx-auto p-4 flex-grow">
        <!-- El contenido de las secciones (Inicio, Servicios, etc.) ser√° inyectado aqu√≠ por JavaScript -->
    </main>

    <!-- Bot√≥n Flotante de WhatsApp -->
    <a href="https://wa.me/50766677965?text=¬°Hola! Tengo una consulta sobre Diverty Eventos." class="whatsapp-float-button" target="_blank">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/WhatsApp.svg/1200px-WhatsApp.svg.png" alt="Logo de WhatsApp" class="w-8 h-8 object-contain">
    </a>

    <!-- Pie de P√°gina -->
    <footer class="bg-purple-700 text-white py-8 px-4 text-center mt-8 rounded-t-xl shadow-inner w-full">
        <p class="text-lg font-semibold">&copy; 2023 Diverty Eventos. ¬°Hacemos magia! ‚ú®</p>
        <p class="text-sm">Todos los derechos reservados. üéâ</p>
    </footer>

    <!-- Script de JavaScript para la funcionalidad de la p√°gina -->
    <script>
        // --- Gesti√≥n del Estado Global de la Aplicaci√≥n ---
        let appState = {
            activeSection: 'home',
            userId: 'guest_user_' + Math.random().toString(36).substring(2, 9),
            selectedItems: [], // Ahora los √≠tems pueden tener { name, price, quantity }
            triviaBubbleDiscountActive: false,
            monthlyPackageDiscountActive: false,
            selectedLocation: 'Panam√° Centro',
            triviaQuestionsShuffled: [],
            currentTriviaQuestionIndex: 0,
            triviaCorrectAnswers: 0,
            currentTriviaTimer: null,
            currentQuestionTimeout: null,
            hasPlayedTrivia: false,
        };

        // --- Definici√≥n de Datos (Servicios y Paquetes) ---
        const servicesData = [
            { id: '2', name: 'Pintacaritas üé®üëßüë¶', price: 40, description: 'Transforma a los ni√±os en sus personajes favoritos con pinturas hipoalerg√©nicas. Servicio por 1 hora.', color: 'bg-blue-100 border-blue-300 text-blue-800' },
            { id: '3', name: 'Globoflexia üéàüí´', price: 40, description: 'Figuras divertidas y creativas hechas con globos para cada invitado. Servicio por 1 hora.', color: 'bg-green-100 border-green-300 text-green-800' },
            { id: '6', name: 'Show de Burbujas Gigantes ü´ß', price: 135, description: '¬°Burbujas enormes que los ni√±os pueden atrapar y explotar! Servicio por 1 hora. ¬°Un s√∫per show √∫nico en Panam√°!', color: 'bg-teal-100 border-teal-300 text-teal-800' },
            { id: '7', name: 'Decoraciones Tem√°ticas üéàüéâ', price: 120, description: 'Transforma cualquier espacio en un mundo m√°gico con nuestras decoraciones personalizadas.', color: 'bg-fuchsia-100 border-fuchsia-300 text-fuchsia-800' },
            { id: '8', name: 'M√°quinas de Snack Algod√≥n y Pop Corn üçøüç≠', price: 100, description: 'M√°quinas de algod√≥n de az√∫car y palomitas de ma√≠z para endulzar tu evento. Servicio por 3 horas.', color: 'bg-lime-100 border-lime-300 text-lime-800' },
        ];

        const packagesData = [
            { id: 'P1', name: 'Fiesta M√°gica Express üöÄ', price: 75, services: [
                'Payas@ o animad@r ü§°üé§',
                'Animaci√≥n infantil ü•≥üíÉ',
                'Juegos y concursos üé≤üèÜ',
                'Figuras con globos üéàüê∂',
                'Romper la pi√±ata üç¨üéâ'
            ], description: 'Diversi√≥n express de 1.5 horas: Animador, juegos, globos, pi√±ata. ¬°Ideal para fiestas r√°pidas y llenas de alegr√≠a! ü•≥', color: 'bg-pink-100 border-pink-300 text-pink-800' },
            { id: 'P2', name: 'Aventura de Ensue√±o üåà', price: 100, services: [
                'Payas@ o animad@r ü§°üé§',
                'Pintacaritas üé®üëßüë¶',
                'Animaci√≥n infantil ü•≥üíÉ',
                'Juegos y concursos üé≤üèÜ',
                'Figuras con globos üéàüê∂',
                'Romper la pi√±ata üç¨üéâ'
            ], description: 'Aventura completa de 2 horas: Payaso/animador, pintacaritas, animaci√≥n, juegos, globos, pi√±ata. ¬°Todo para una celebraci√≥n inolvidable! üåà', color: 'bg-indigo-100 border-indigo-300 text-indigo-800' },
            { id: 'P3', name: 'Celebraci√≥n Personalizada ‚ú®', price: 135, services: [
                'Payasit@ o animad@r ü§°üé§',
                'Animaci√≥n juegos y concursos ü•≥üé≤',
                'PintaCaritas üé®üëßüë¶',
                'Show de magia C√≥mica ‚ú®ü§£',
                'Asistencia para la pi√±ata üç¨üéâ'
            ], description: 'Celebraci√≥n premium de 2.5 horas: Payaso/animador, juegos, pintacaritas, magia c√≥mica, asistencia de pi√±ata. ¬°Dise√±a tu fiesta perfecta!üíñ', color: 'bg-orange-100 border-orange-300 text-orange-800' },
        ];

        // Recargos por transporte seg√∫n la ubicaci√≥n
        const transportFeesByLocation = {
            'Panam√° Centro': 0,
            'Arraij√°n': 10,
            'La Chorrera': 15,
            'Pacora': 10,
            'Panam√° Norte': 10,
        };

        // Preguntas de la Trivia
        const triviaQuestions = [
            {
                question: "Soy una perrita azul, me encanta jugar con mi hermana Bingo y mis padres. ¬øQui√©n soy?",
                options: ["Bingo", "Chilli", "Bluey", "Bandit"],
                answer: "Bluey"
            },
            {
                question: "Uso lentes y un sombrero naranja, y me encanta explorar lugares divertidos para ni√±os. ¬øQui√©n soy?",
                options: ["Elmo", "Mickey Mouse", "Blippi", "El Pato Donald"],
                answer: "Blippi"
            },
            {
                question: "Soy un payaso h√©roe con una nariz roja y un coraz√≥n grande, que siempre ayuda a los ni√±os. ¬øQui√©n soy?",
                options: ["Bob Esponja", "Plim Plim", "Peppa Pig", "Pocoy√≥"],
                answer: "Plim Plim"
            },
            {
                question: "Soy la hermana de Bluey, y juntas hacemos muchas aventuras imaginarias. Mi color es naranja. ¬øQui√©n soy?",
                options: ["Bluey", "Chilli", "Bingo", "Bandit"],
                answer: "Bingo"
            },
            {
                question: "Me llamo Bandit, soy el pap√° de Bluey y Bingo. ¬øQu√© animal soy?",
                options: ["Perro", "Gato", "Oso", "Conejo"],
                answer: "Perro"
            },
            {
                question: "Visto de naranja y azul, me encanta bailar y ense√±ar sobre el mundo. ¬øQui√©n soy?",
                options: ["Blippi", "Elmo", "JJ de Cocomelon", "Peppa Pig"],
                answer: "Blippi"
            },
            {
                question: "Mi canci√≥n es 'Un mundo m√°gico, un mundo de amor'. Soy un payaso que hace sonre√≠r a todos. ¬øQui√©n soy?",
                options: ["Plim Plim", "Patylu", "El Chavo del 8", "Cantinflas"],
                answer: "Plim Plim"
            },
            {
                question: "Soy la mam√° de Bluey y Bingo, y me llamo Chilli. ¬øQu√© animal soy?",
                options: ["Perro", "Gato", "Pato", "Caballo"],
                answer: "Perro"
            },
            {
                question: "En el mundo de Blippi, soy un amigo peludo con una nariz de payaso. ¬øQui√©n soy?",
                options: ["Buddy", "Gilly", "Squeaky", "Pebbles"],
                answer: "Squeaky"
            },
            {
                question: "Siempre digo '¬°Es hora de la aventura!' y tengo una mochila m√°gica. ¬øQui√©n soy?",
                options: ["Dora la Exploradora", "Mickey Mouse", "Blippi", "Paw Patrol"],
                answer: "Blippi"
            }
        ];

        // --- Funciones de Ayuda ---

        /**
         * Baraja un array de forma aleatoria (Fisher-Yates shuffle).
         * @param {Array} array - El array a barajar.
         * @returns {Array} El array barajado.
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        /**
         * Inyecta el HTML de una secci√≥n en el √°rea de contenido principal.
         * @param {string} sectionHtml - El HTML de la secci√≥n a renderizar.
         */
        function renderSection(sectionHtml) {
            document.getElementById('mainContent').innerHTML = sectionHtml;
        }

        /**
         * Actualiza el resumen del carrito flotante con el n√∫mero de √≠tems y el precio total.
         */
        function updateCartSummary() {
            let currentTotalPrice = appState.selectedItems.reduce((sum, item) => {
                let itemPriceAdjusted = item.price;
                // Determina si el √≠tem es un paquete comparando con los nombres en packagesData
                const isPackage = packagesData.some(p => p.name === item.name);

                // L√≥gica de descuento para "Pintacaritas" si se a√±aden m√°s de 1
                if (item.name === 'Pintacaritas üé®üëßüë¶' && item.quantity > 1) {
                    itemPriceAdjusted = 35; // Precio con descuento por unidad
                }
                // L√≥gica de descuento de trivia para "Show de Burbujas Gigantes"
                if (appState.triviaBubbleDiscountActive && item.name === 'Show de Burbujas Gigantes ü´ß') {
                    itemPriceAdjusted = item.price * 0.90; // 10% de descuento
                }
                // L√≥gica de descuento mensual para paquetes
                else if (appState.monthlyPackageDiscountActive && isPackage) {
                    itemPriceAdjusted = item.price * 0.90; // 10% de descuento
                }
                
                return sum + (itemPriceAdjusted * item.quantity);
            }, 0);

            // A√±adir recargo por transporte basado en la ubicaci√≥n seleccionada
            currentTotalPrice += transportFeesByLocation[appState.selectedLocation] || 0;

            const cartSummaryDiv = document.getElementById('cartSummary');
            const selectedItemsCountSpan = document.getElementById('selectedItemsCount');
            const totalPriceDisplaySpan = document.getElementById('totalPriceDisplay');

            const totalItemsInCart = appState.selectedItems.reduce((total, item) => total + item.quantity, 0);

            if (totalItemsInCart > 0 || currentTotalPrice > 0) {
                cartSummaryDiv.classList.remove('hidden');
                selectedItemsCountSpan.textContent = totalItemsInCart;
                totalPriceDisplaySpan.textContent = `$${currentTotalPrice.toFixed(2)}`;
            } else {
                cartSummaryDiv.classList.add('hidden');
            }
        }

        /**
         * Maneja la adici√≥n/eliminaci√≥n/decremento de √≠tems en el carrito.
         * @param {object} item - El objeto del servicio/paquete a a√±adir/quitar. Debe contener { name, price }.
         * @param {string} actionType - 'add' para a√±adir/incrementar, 'remove_all' para quitar todas las unidades, 'toggle' para alternar (usado en no-repetibles).
         */
        function handleCartAction(item, actionType) {
            const existingItemIndex = appState.selectedItems.findIndex(selected => selected.name === item.name);

            if (actionType === 'add') {
                if (existingItemIndex > -1) {
                    appState.selectedItems[existingItemIndex].quantity++;
                } else {
                    // Si el √≠tem no existe, lo a√±ade con cantidad 1
                    appState.selectedItems.push({ ...item, quantity: 1 });
                }
            } else if (actionType === 'remove_all') {
                // Filtra el √≠tem para eliminar todas sus unidades
                appState.selectedItems = appState.selectedItems.filter(selected => selected.name !== item.name);
            } else if (actionType === 'toggle') { // Para servicios no repetibles (ej: paquetes)
                if (existingItemIndex > -1) {
                    // Si ya est√° seleccionado, lo quita
                    appState.selectedItems = appState.selectedItems.filter(selected => selected.name !== item.name);
                } else {
                    // Si no est√° seleccionado, lo a√±ade con cantidad 1
                    appState.selectedItems.push({ ...item, quantity: 1 });
                }
            }

            // Volver a renderizar la secci√≥n activa para actualizar los botones y precios.
            if (appState.activeSection === 'services') {
                renderServicesSection();
            } else if (appState.activeSection === 'packages') {
                renderPackagesSection();
            } else if (appState.activeSection === 'booking') {
                renderBookingSection();
            }
            updateCartSummary(); // Actualiza la barra flotante del carrito.
        }

        // --- Funciones de Modales (Ventanas Emergentes) ---
        /**
         * Muestra un modal de informaci√≥n gen√©rico.
         * @param {string} message - El mensaje a mostrar en el modal.
         */
        function showInfoModal(message) {
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('infoModal').classList.remove('hidden');
        }

        /**
         * Oculta el modal de informaci√≥n gen√©rico.
         */
        function closeModal() {
            document.getElementById('infoModal').classList.add('hidden');
            document.getElementById('modalMessage').textContent = '';
        }

        /**
         * Muestra el modal de promoci√≥n y activa el descuento mensual.
         * @param {string} message - El mensaje de la promoci√≥n.
         */
        function showPromoInfoModal(message) {
            document.getElementById('promoMessage').textContent = message;
            document.getElementById('promoModal').classList.remove('hidden');
            appState.monthlyPackageDiscountActive = true; 
            updateCartSummary();
            // Re-renderiza las secciones si est√°n activas para mostrar el descuento
            if (appState.activeSection === 'services') renderServicesSection();
            if (appState.activeSection === 'packages') renderPackagesSection();
            if (appState.activeSection === 'booking') renderBookingSection();
        }

        /**
         * Oculta el modal de promoci√≥n.
         */
        function closePromoModal() {
            document.getElementById('promoModal').classList.add('hidden');
            document.getElementById('promoMessage').textContent = '';
        }

        // --- Funciones de Renderizado de Secciones ---

        /**
         * Renderiza la secci√≥n de Inicio.
         */
        function renderHomeSection() {
            const html = `
                <section class="bg-white rounded-3xl shadow-2xl p-4 sm:p-8 my-8 border-8 border-yellow-400 flex items-center justify-center min-h-[60vh]">
                    <div class="bg-yellow-50 p-6 sm:p-10 rounded-2xl shadow-inner border-4 border-yellow-300 max-w-3xl mx-auto text-center">
                        <h1 class="text-3xl sm:text-4xl lg:text-5xl font-extrabold text-purple-800 mb-4 leading-tight text-center">
                            ¬°Tu Fiesta So√±ada Comienza Aqu√≠ con Diverty Eventos! ü•≥‚ú®
                        </h1>
                        <p class="text-base sm:text-lg lg:text-xl text-gray-700 mb-8 px-2">
                            En Diverty Eventos, transformamos celebraciones ordinarias en aventuras extraordinarias.
                            Tenemos todo para que el d√≠a especial de tu hijo sea inolvidable. ¬°Prep√°rate para la diversi√≥n! üöÄ
                        </p>
                        <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4 mt-8">
                            <button id="homeExploreServices" class="bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-8 rounded-full shadow-lg text-base sm:text-lg">
                                ¬°Explora Nuestros Servicios! üéâ
                            </button>
                            <button id="homeExplorePackages" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-8 rounded-full shadow-lg text-base sm:text-lg">
                                ¬°Explora Nuestros Paquetes! üì¶
                            </button>
                        </div>
                        <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4 mt-8">
                            <button id="homePromoButton" class="bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-500 hover:to-orange-600 text-white font-bold py-3 px-8 rounded-full shadow-lg text-base sm:text-lg">
                                üéâ Promoci√≥n del Mes üéâ
                            </button>
                            <button id="homeTriviaButton" 
                                class="bg-gradient-to-r from-green-400 to-teal-500 hover:from-green-500 hover:to-teal-600 text-white font-bold py-3 px-8 rounded-full shadow-lg text-base sm:text-lg ${appState.hasPlayedTrivia ? 'opacity-50 cursor-not-allowed' : ''}"
                                ${appState.hasPlayedTrivia ? 'disabled' : ''}>
                                ${appState.hasPlayedTrivia ? '¬°Trivia Completada! üèÜ' : 'üöÄ ¬°Juega la Trivia y Gana un Descuento! üß†'}
                            </button>
                        </div>
                    </div>
                </section>
            `;
            renderSection(html);

            // Asigna los event listeners a los botones de la secci√≥n de Inicio
            document.getElementById('homeExploreServices').onclick = () => { setActiveSection('services'); };
            document.getElementById('homeExplorePackages').onclick = () => { setActiveSection('packages'); };
            document.getElementById('homePromoButton').onclick = () => {
                showPromoInfoModal('¬°Este mes, disfruta de un 10% de descuento EXCLUSIVO en TODOS nuestros Paquetes! üì¶');
            };
            document.getElementById('homeTriviaButton').onclick = () => { setActiveSection('trivia'); };
        }

        /**
         * Renderiza la secci√≥n de Servicios Individuales.
         */
        function renderServicesSection() {
            // Servicios que pueden tener cantidades m√∫ltiples y, por lo tanto, botones de "A√±adir" y "Quitar Todo".
            const repeatableServices = ['Pintacaritas üé®üëßüë¶', 'Globoflexia üéàüí´', 'Show de Burbujas Gigantes ü´ß'];

            const cardsHtml = servicesData.map(service => {
                const isRepeatableService = repeatableServices.includes(service.name);
                const selectedItemInCart = appState.selectedItems.find(selected => selected.name === service.name);
                const currentQuantity = selectedItemInCart ? selectedItemInCart.quantity : 0;
                
                let displayPriceForCard = service.price;
                let originalPriceHtmlForCard = '';

                // L√≥gica de precio para la tarjeta: si Pintacaritas > 1 o si tiene descuento de burbujas
                if (service.name === 'Pintacaritas üé®üëßüë¶' && currentQuantity > 1) {
                    originalPriceHtmlForCard = `<span class="line-through text-gray-500 text-2xl">$${service.price.toFixed(2)}</span> `;
                    displayPriceForCard = 35; // Precio con descuento por unidad si se a√±ade m√°s de 1
                } else if (appState.triviaBubbleDiscountActive && service.name === 'Show de Burbujas Gigantes ü´ß') {
                    originalPriceHtmlForCard = `<span class="line-through text-gray-500 text-2xl">$${service.price.toFixed(2)}</span> `;
                    displayPriceForCard = service.price * 0.90; // 10% de descuento por trivia
                }

                let buttonsHtml;
                if (isRepeatableService) {
                    // Botones para servicios que se pueden a√±adir varias veces
                    buttonsHtml = `
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mt-auto">
                            <button
                                data-item-name="${service.name}"
                                data-item-price="${service.price}"
                                data-action-type="add"
                                class="add-remove-button flex-grow bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-full shadow-md text-sm transition duration-300">
                                A√±adir ‚ûï ${currentQuantity > 0 ? `(x${currentQuantity})` : ''}
                            </button>
                            ${currentQuantity > 0 ? `
                            <button
                                data-item-name="${service.name}"
                                data-item-price="${service.price}"
                                data-action-type="remove_all"
                                class="add-remove-button flex-grow bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-full shadow-md text-sm transition duration-300">
                                Quitar Todo üóëÔ∏è
                            </button>
                            ` : ''}
                        </div>
                    `;
                } else {
                    // Bot√≥n para servicios no repetibles (a√±adir/quitar)
                    const isSelected = selectedItemInCart ? true : false;
                    const buttonText = isSelected ? 'Quitar del Carrito ‚ûñ' : 'A√±adir al Carrito ‚ûï';
                    const buttonClassColor = isSelected ? 'bg-red-500 hover:bg-red-600' : 'bg-purple-500 hover:bg-purple-600';
                    buttonsHtml = `
                        <button
                            data-item-name="${service.name}"
                            data-item-price="${service.price}"
                            data-action-type="toggle"
                            class="add-remove-button mt-auto font-bold py-2 px-4 rounded-full shadow-md text-sm sm:text-base transition duration-300 ${buttonClassColor} text-white">
                            ${buttonText}
                        </button>
                    `;
                }

                return `
                    <div class="${service.color} rounded-2xl shadow-lg p-4 sm:p-6 flex flex-col justify-between border-4 border-dashed border-opacity-50">
                        <div>
                            <h2 class="text-xl sm:text-2xl font-bold mb-2 sm:mb-3 text-purple-700">${service.name}</h2>
                            <p class="text-sm sm:text-base text-gray-700 mb-3 sm:mb-4">${service.description}</p>
                            <p class="text-3xl sm:text-4xl font-extrabold text-pink-600 mb-3 sm:mb-4">
                                ${originalPriceHtmlForCard}$${displayPriceForCard.toFixed(2)}
                            </p>
                        </div>
                        ${buttonsHtml}
                    </div>
                `;
            }).join('');

            const html = `
                <section class="bg-white rounded-3xl shadow-2xl p-4 sm:p-8 my-8 border-8 border-green-400">
                    <h1 class="text-3xl sm:text-4xl font-extrabold text-purple-700 text-center mb-8 sm:mb-10">Nuestros Servicios Individuales üéâ</h1>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-8">
                        ${cardsHtml}
                    </div>
                </section>
            `;
            renderSection(html);

            // Asigna event listeners a todos los botones de a√±adir/quitar en la secci√≥n de servicios
            document.querySelectorAll('#mainContent .add-remove-button').forEach(button => {
                button.onclick = (event) => {
                    const itemName = event.target.dataset.itemName;
                    const itemPrice = parseFloat(event.target.dataset.itemPrice);
                    const actionType = event.target.dataset.actionType;
                    handleCartAction({ name: itemName, price: itemPrice }, actionType);
                };
            });
        }

        /**
         * Renderiza la secci√≥n de Paquetes.
         */
        function renderPackagesSection() {
            const cardsHtml = packagesData.map(pkg => {
                const selectedItemInCart = appState.selectedItems.find(item => item.name === pkg.name);
                const isSelected = selectedItemInCart ? true : false;

                let buttonText;
                let buttonClassColor;

                if (isSelected) {
                    buttonText = 'Quitar del Carrito ‚ûñ';
                    buttonClassColor = 'bg-red-500 hover:bg-red-600';
                } else {
                    buttonText = 'A√±adir al Carrito ‚ûï';
                    buttonClassColor = 'bg-indigo-500 hover:bg-indigo-600';
                }

                let displayPrice = pkg.price;
                let originalPriceHtml = '';
                
                // L√≥gica de descuento mensual para paquetes
                if (appState.monthlyPackageDiscountActive) {
                    originalPriceHtml = `<span class="line-through text-gray-500 text-2xl">$${pkg.price.toFixed(2)}</span> `;
                    displayPrice = pkg.price * 0.90; // 10% de descuento
                }

                return `
                    <div class="${pkg.color} rounded-2xl shadow-lg p-4 sm:p-6 flex flex-col justify-between border-4 border-dashed border-opacity-50">
                        <div>
                            <h2 class="text-xl sm:text-2xl font-bold mb-2 sm:mb-3 text-indigo-700">${pkg.name}</h2>
                            <p class="text-sm sm:text-base text-gray-700 mb-3 sm:mb-4">${pkg.description}</p>
                            <ul class="list-disc list-inside text-gray-600 mb-3 sm:mb-4 text-sm sm:text-base">
                                ${pkg.services.map(service => `<li>${service}</li>`).join('')}
                            </ul>
                            <p class="text-3xl sm:text-4xl font-extrabold text-purple-600 mb-3 sm:mb-4">
                                ${originalPriceHtml}$${displayPrice.toFixed(2)}
                            </p>
                        </div>
                        <button
                            data-item-name="${pkg.name}"
                            data-item-price="${pkg.price}"
                            data-action-type="toggle"
                            class="add-remove-button mt-auto font-bold py-2 px-4 rounded-full shadow-md text-sm sm:text-base transition duration-300 ${buttonClassColor} text-white">
                            ${buttonText}
                        </button>
                    </div>
                `;
            }).join('');

            const html = `
                <section class="bg-white rounded-3xl shadow-2xl p-4 sm:p-8 my-8 border-8 border-pink-400">
                    <h1 class="text-3xl sm:text-4xl font-extrabold text-purple-700 text-center mb-8 sm:mb-10">Nuestros Paquetes de Diversi√≥n Inolvidable ü•≥</h1>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-8">
                        ${cardsHtml}
                    </div>
                </section>
            `;
            renderSection(html);

            // Asigna event listeners a todos los botones de a√±adir/quitar en la secci√≥n de paquetes
            document.querySelectorAll('#mainContent .add-remove-button').forEach(button => {
                button.onclick = (event) => {
                    const itemName = event.target.dataset.itemName;
                    const itemPrice = parseFloat(event.target.dataset.itemPrice);
                    const actionType = event.target.dataset.actionType;
                    handleCartAction({ name: itemName, price: itemPrice }, actionType);
                };
            });
        }

        /**
         * Renderiza la secci√≥n de Reservas, mostrando los √≠tems seleccionados y el formulario.
         */
        function renderBookingSection() {
            // Genera la lista de √≠tems seleccionados para mostrar en la secci√≥n de reserva
            const selectedItemsListHtml = appState.selectedItems.length === 0
                ? `<p class="text-red-600 text-sm sm:text-base">No has seleccionado ning√∫n servicio. Por favor, vuelve a la secci√≥n de Servicios o Paquetes.</p>`
                : `<ul class="list-disc list-inside text-gray-800 text-sm sm:text-base bg-blue-50 p-3 rounded-md border border-blue-200">
                    ${appState.selectedItems.map((item) => {
                        let displayItemPrice = item.price;
                        let originalItemPrice = null;
                        const isPackage = packagesData.some(p => p.name === item.name); // Verifica si es un paquete

                        // Aplica l√≥gicas de descuento para mostrar el precio en la lista
                        if (item.name === 'Pintacaritas üé®üëßüë¶' && item.quantity > 1) {
                            originalItemPrice = item.price;
                            displayItemPrice = 35; // Precio con descuento por unidad
                        } else if (appState.triviaBubbleDiscountActive && item.name === 'Show de Burbujas Gigantes ü´ß') {
                            originalItemPrice = item.price;
                            displayItemPrice = item.price * 0.90; // Descuento de trivia
                        } else if (appState.monthlyPackageDiscountActive && isPackage) {
                            originalItemPrice = item.price;
                            displayItemPrice = item.price * 0.90; // Descuento mensual de paquete
                        }

                        return `
                            <li>
                                ${item.name} ${item.quantity > 1 ? `(x${item.quantity})` : ''} -
                                ${originalItemPrice !== null ? `
                                    <span class="line-through text-gray-500">$${item.price.toFixed(2)}</span>{' '}
                                    <span class="text-green-700">$${displayItemPrice.toFixed(2)}</span>
                                ` : `$${displayItemPrice.toFixed(2)}`}
                            </li>
                        `;
                    }).join('')}
                </ul>`;

            // Calcula y muestra el recargo por transporte
            const currentTransportFee = transportFeesByLocation[appState.selectedLocation] || 0;
            const transportFeeDisplayHtml = currentTransportFee > 0
                ? `<p class="text-lg font-bold text-gray-700 mt-2">Recargo por Transporte (${appState.selectedLocation}): <span class="text-orange-600">$${currentTransportFee.toFixed(2)}</span></p>`
                : `<p class="text-lg font-bold text-gray-700 mt-2">Recargo por Transporte: <span class="text-green-600">¬°Gratis en Panam√° Centro!</span></p>`;

            // Calcula el precio total final incluyendo descuentos y recargos
            const totalItemsPrice = appState.selectedItems.reduce((sum, item) => {
                let itemPriceForCalculation = item.price;

                if (item.name === 'Pintacaritas üé®üëßüë¶' && item.quantity > 1) {
                    itemPriceForCalculation = 35;
                } else if (appState.triviaBubbleDiscountActive && item.name === 'Show de Burbujas Gigantes ü´ß') {
                    itemPriceForCalculation = item.price * 0.90;
                } else if (packagesData.some(p => p.name === item.name) && appState.monthlyPackageDiscountActive) {
                    itemPriceForCalculation = item.price * 0.90;
                }
                return sum + (itemPriceForCalculation * item.quantity);
            }, 0);
            const finalTotalPrice = totalItemsPrice + currentTransportFee;

            const html = `
                <section class="bg-white rounded-3xl shadow-2xl p-4 sm:p-8 my-8 border-8 border-blue-400">
                    <h1 class="text-3xl sm:text-4xl font-extrabold text-purple-700 text-center mb-8 sm:mb-10">Reserva Tu Evento Fant√°stico Ahora Mismo! üóìÔ∏è‚ú®</h1>
                    <div class="grid grid-cols-1 lg:grid-cols-1 gap-4 sm:gap-12">
                        <h2 class="text-xl sm:text-2xl font-bold text-blue-700 mb-4 sm:mb-6">Completa los Detalles de Tu Reserva üìù</h2>
                        <div class="bg-blue-100 p-4 sm:p-8 rounded-2xl shadow-lg border-4 border-blue-300">
                            <form id="bookingForm" class="space-y-4">
                                <div>
                                    <label htmlFor="selectedItemsDisplay" class="block text-gray-700 font-bold mb-1 sm:mb-2 text-sm sm:text-base">Servicios/Paquetes Seleccionados:üéÅ</label>
                                    ${selectedItemsListHtml}
                                    ${transportFeeDisplayHtml}
                                    <p class="text-lg font-bold text-purple-700 mt-3">Total a Pagar: <span class="text-pink-600">$${finalTotalPrice.toFixed(2)}</span></p>
                                </div>

                                <div class="bg-yellow-50 p-3 rounded-md border border-yellow-300 text-sm sm:text-base text-gray-700 font-semibold mt-4">
                                    <p class="text-orange-700 font-bold mb-2">¬°Importante! Se requiere un abono de $10.</p>
                                    <p>Por favor, realiza un abono de $10 v√≠a Yappy Panam√° a <span class="font-bold">Ailen Camarena</span> al n√∫mero <span class="font-bold">6667-7965</span>.</p>
                                    <p class="mt-2">Nos pondremos en contacto para confirmar tu abono.</p>
                                </div>
                                
                                <div>
                                    <label htmlFor="locationSelect" class="block text-gray-700 font-bold mb-1 sm:mb-2 text-sm sm:text-base">Ubicaci√≥n del Evento (Provincia/Zona):üìç</label>
                                    <select
                                        id="locationSelect"
                                        name="ubicacionEvento"
                                        class="w-full p-2 sm:p-3 border-2 border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base"
                                    >
                                        <option value="Panam√° Centro" ${appState.selectedLocation === 'Panam√° Centro' ? 'selected' : ''}>Panam√° Centro</option>
                                        <option value="Arraij√°n" ${appState.selectedLocation === 'Arraij√°n' ? 'selected' : ''}>Arraij√°n ($10 adicional)</option>
                                        <option value="La Chorrera" ${appState.selectedLocation === 'La Chorrera' ? 'selected' : ''}>La Chorrera ($15 adicional)</option>
                                        <option value="Pacora" ${appState.selectedLocation === 'Pacora' ? 'selected' : ''}>Pacora ($10 adicional)</option>
                                        <option value="Panam√° Norte" ${appState.selectedLocation === 'Panam√° Norte' ? 'selected' : ''}>Panam√° Norte ($10 adicional)</option>
                                    </select>
                                </div>

                                <div>
                                    <label htmlFor="exactLocation" class="block text-gray-700 font-bold mb-1 sm:mb-2 text-sm sm:text-base">Direcci√≥n Exacta del Evento: üó∫Ô∏è</label>
                                    <input
                                        type="text"
                                        id="exactLocation"
                                        name="direccionExacta"
                                        class="w-full p-2 sm:p-3 border-2 border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base"
                                        placeholder="Ej: Calle Principal, Casa #15, Cerca de la escuela..."
                                        required
                                    />
                                </div>

                                <div>
                                    <label htmlFor="bookingDate" class="block text-gray-700 font-bold mb-1 sm:mb-2 text-sm sm:text-base">Fecha del Evento: üìÜ</label>
                                    <input
                                        type="date"
                                        id="bookingDate"
                                        name="fechaEvento"
                                        class="w-full p-2 sm:p-3 border-2 border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base"
                                        min="${new Date().toISOString().split('T')[0]}"
                                        required
                                    />
                                </div>
                                <div>
                                    <label htmlFor="bookingTime" class="block text-gray-700 font-bold mb-1 sm:mb-2 text-sm sm:text-base">Hora del Evento: ‚è∞</label>
                                    <input
                                        type="time"
                                        id="bookingTime"
                                        name="horaEvento"
                                        class="w-full p-2 sm:p-3 border-2 border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base"
                                        required
                                    />
                                </div>
                                <div>
                                    <label htmlFor="customerName" class="block text-gray-700 font-bold mb-1 sm:mb-2 text-sm sm:text-base">Tu Nombre: üë§</label>
                                    <input
                                        type="text"
                                        id="customerName"
                                        name="nombreCliente"
                                        class="w-full p-2 sm:p-3 border-2 border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base"
                                        placeholder="Ej: Juan P√©rez"
                                        required
                                    />
                                </div>
                                <div>
                                    <label htmlFor="customerEmail" class="block text-gray-700 font-bold mb-1 sm:mb-2 text-sm sm:text-base">Tu Email: üìß</label>
                                    <input
                                        type="email"
                                        id="customerEmail"
                                        name="emailCliente"
                                        class="w-full p-2 sm:p-3 border-2 border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base"
                                        placeholder="Ej: tu.email@example.com"
                                        required
                                    />
                                </div>
                                <div>
                                    <label htmlFor="customerPhone" class="block text-gray-700 font-bold mb-1 sm:mb-2 text-sm sm:text-base">Tu Tel√©fono:üìû</label>
                                    <input
                                        type="tel"
                                        id="customerPhone"
                                        name="telefonoCliente"
                                        class="w-full p-2 sm:p-3 border-2 border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base"
                                        placeholder="Ej: 555-1234567"
                                        required
                                    />
                                </div>
                                <div>
                                    <label htmlFor="eventType" class="block text-gray-700 font-bold mb-1 sm:mb-2 text-sm sm:text-base">Tipo de Evento: üéâ</label>
                                    <input
                                        type="text"
                                        id="eventType"
                                        name="tipoEvento"
                                        class="w-full p-2 sm:p-3 border-2 border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base"
                                        placeholder="Ej: Cumplea√±os, Graduaci√≥n"
                                        required
                                    />
                                </div>
                                <div>
                                    <label htmlFor="numKids" class="block text-gray-700 font-bold mb-1 sm:mb-2 text-sm sm:text-base">N√∫mero Estimado de Ni√±os: üëßüë¶</label>
                                    <input
                                        type="number"
                                        id="numKids"
                                        name="numeroNinos"
                                        class="w-full p-2 sm:p-3 border-2 border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base"
                                        placeholder="Ej: 20"
                                        min="1"
                                        required
                                    />
                                </div>
                                <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 sm:py-3 px-4 sm:px-6 rounded-full shadow-lg text-base sm:text-lg mt-4">
                                    ¬°Confirmar Reserva M√°gica! ‚ú®
                                </button>
                            </form>
                        </div>
                    </div>
                </section>
            `;
            renderSection(html);

            // Asigna los event listeners al formulario de reserva y al selector de ubicaci√≥n
            const bookingForm = document.getElementById('bookingForm');
            if (bookingForm) {
                bookingForm.onsubmit = handleBookingSubmit;
                document.getElementById('locationSelect').onchange = (e) => {
                    appState.selectedLocation = e.target.value;
                    updateCartSummary(); // Actualiza el resumen del carrito con el nuevo recargo
                    renderBookingSection(); // Re-renderiza la secci√≥n para mostrar el recargo actualizado
                };
            }
        }

        // --- Funciones de Trivia ---

        /**
         * Inicia el juego de trivia.
         * Verifica si el usuario ya jug√≥ la trivia usando localStorage.
         */
        function startTrivia() {
            // Limpia cualquier temporizador o timeout anterior para evitar solapamientos
            if (appState.currentTriviaTimer) clearInterval(appState.currentTriviaTimer);
            if (appState.currentQuestionTimeout) clearTimeout(appState.currentQuestionTimeout);

            const triviaPlayedStatus = localStorage.getItem('triviaPlayed');
            if (triviaPlayedStatus === 'true') {
                appState.hasPlayedTrivia = true;
                showInfoModal('¬°Ya has participado en la trivia! Solo se permite una participaci√≥n por cliente. üòä');
                setActiveSection('home');
                return;
            }

            // Marca la trivia como jugada en localStorage
            localStorage.setItem('triviaPlayed', 'true');
            appState.hasPlayedTrivia = true; // Actualiza el estado local de la app

            // Baraja las preguntas y selecciona las primeras 10 (o menos si hay menos)
            appState.triviaQuestionsShuffled = shuffleArray([...triviaQuestions]).slice(0, 10); 
            appState.currentTriviaQuestionIndex = 0; // Reinicia el √≠ndice de la pregunta actual
            appState.triviaCorrectAnswers = 0; // Reinicia el contador de respuestas correctas

            showInfoModal('¬°Completa 5 respuestas correctas y gana un 10% de descuento EXCLUSIVO en el Show de Burbujas Gigantes! ü´ß');
            
            // Retrasa la visualizaci√≥n de la primera pregunta para que el usuario lea el modal
            setTimeout(() => {
                displayTriviaQuestion();
            }, 3000);
        }

        /**
         * Muestra la pregunta de trivia actual en la pantalla.
         */
        function displayTriviaQuestion() {
            // Limpia cualquier temporizador o timeout anterior al mostrar una nueva pregunta
            if (appState.currentTriviaTimer) clearInterval(appState.currentTriviaTimer);
            if (appState.currentQuestionTimeout) clearTimeout(appState.currentQuestionTimeout);

            const currentQuestion = appState.triviaQuestionsShuffled[appState.currentTriviaQuestionIndex];
            if (!currentQuestion) {
                // Si no hay m√°s preguntas, termina la trivia
                endTrivia(true);
                return;
            }

            const optionsHtml = currentQuestion.options.map((option) => `
                <button
                    class="trivia-option-button bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-full shadow-md text-lg transition duration-300 w-full sm:w-auto flex-grow"
                    data-option="${option}"
                >
                    ${option}
                </button>
            `).join('');

            const html = `
                <section class="bg-white rounded-3xl shadow-2xl p-4 sm:p-8 my-8 border-8 border-purple-400">
                    <h1 class="text-3xl sm:text-4xl font-extrabold text-purple-700 text-center mb-6 sm:mb-8">
                        Trivia de Programas Infantiles üß†
                    </h1>
                    <div class="bg-purple-50 p-6 rounded-2xl shadow-inner border-4 border-purple-300 text-center">
                        <p class="text-xl sm:text-2xl font-semibold text-gray-800 mb-4">
                            Pregunta ${appState.currentTriviaQuestionIndex + 1} para ganar el descuento:
                        </p>
                        <p class="text-2xl sm:text-3xl font-extrabold text-indigo-700 mb-8">
                            ${currentQuestion.question}
                        </p>
                        <div id="triviaOptions" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            ${optionsHtml}
                        </div>
                        <p id="triviaFeedback" class="text-lg font-bold mt-6 hidden"></p>
                        <p id="triviaTimer" class="text-xl font-bold text-red-600 mt-4">Tiempo restante: 20s</p>
                    </div>
                </section>
            `;
            renderSection(html);

            // Asigna los event listeners a los botones de opci√≥n de la trivia
            document.querySelectorAll('#mainContent .trivia-option-button').forEach(button => {
                button.onclick = (event) => checkTriviaAnswer(event.target.dataset.option);
            });

            // Inicia el temporizador de la pregunta
            let timeLeft = 20;
            const timerDisplay = document.getElementById('triviaTimer');
            timerDisplay.textContent = `Tiempo restante: ${timeLeft}s`;

            appState.currentTriviaTimer = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = `Tiempo restante: ${timeLeft}s`;
                if (timeLeft <= 0) {
                    clearInterval(appState.currentTriviaTimer);
                    handleTimeUp(); // Llama a la funci√≥n de tiempo agotado
                }
            }, 1000);

            // Establece un timeout para la pregunta en caso de que el temporizador no se limpie (seguridad)
            appState.currentQuestionTimeout = setTimeout(() => {
                if (timeLeft > 0) { // Solo si el tiempo no se ha agotado ya por el intervalo
                     handleTimeUp();
                }
            }, 20000);
        }

        /**
         * Maneja el evento de tiempo agotado en una pregunta de trivia.
         */
        function handleTimeUp() {
            // Limpia ambos temporizadores para asegurar que no haya ejecuciones duplicadas
            if (appState.currentTriviaTimer) clearInterval(appState.currentTriviaTimer);
            if (appState.currentQuestionTimeout) clearTimeout(appState.currentQuestionTimeout);

            document.getElementById('triviaFeedback').textContent = '¬°Tiempo agotado! ‚åõ';
            document.getElementById('triviaFeedback').classList.add('text-red-600');
            document.getElementById('triviaFeedback').classList.remove('hidden');

            // Deshabilita los botones de opci√≥n para evitar m√°s interacciones
            document.querySelectorAll('.trivia-option-button').forEach(button => {
                button.disabled = true;
            });

            // Despu√©s de un breve retraso, termina la trivia
            setTimeout(() => {
                endTrivia(false); // Indica que no se gan√≥ el descuento
            }, 2000);
        }

        /**
         * Verifica la respuesta seleccionada por el usuario en la trivia.
         * @param {string} selectedOption - La opci√≥n seleccionada por el usuario.
         */
        function checkTriviaAnswer(selectedOption) {
            // Limpia ambos temporizadores al recibir una respuesta para evitar problemas
            if (appState.currentTriviaTimer) clearInterval(appState.currentTriviaTimer);
            if (appState.currentQuestionTimeout) clearTimeout(appState.currentQuestionTimeout);

            const currentQuestion = appState.triviaQuestionsShuffled[appState.currentTriviaQuestionIndex];
            const triviaFeedback = document.getElementById('triviaFeedback');
            triviaFeedback.classList.remove('hidden', 'text-green-600', 'text-red-600');

            // Deshabilita todos los botones de opci√≥n
            document.querySelectorAll('.trivia-option-button').forEach(button => {
                button.disabled = true;
                // Resalta la respuesta correcta en verde
                if (button.dataset.option === currentQuestion.answer) {
                    button.classList.add('bg-green-600');
                    button.classList.remove('bg-blue-500', 'hover:bg-blue-600');
                }
            });

            if (selectedOption === currentQuestion.answer) {
                appState.triviaCorrectAnswers++;
                triviaFeedback.textContent = '¬°Correcto! ‚úÖ';
                triviaFeedback.classList.add('text-green-600');

                // Verifica si ha ganado el descuento o si hay m√°s preguntas
                if (appState.currentTriviaQuestionIndex + 1 === appState.triviaQuestionsShuffled.length || appState.triviaCorrectAnswers >= 5) {
                    setTimeout(() => {
                        endTrivia(true); // Termina la trivia, indicando que se pudo haber ganado
                    }, 2000);
                } else {
                    setTimeout(() => {
                        appState.currentTriviaQuestionIndex++;
                        displayTriviaQuestion(); // Muestra la siguiente pregunta
                    }, 2000);
                }

            } else {
                triviaFeedback.textContent = `¬°Incorrecto! ‚ùå La respuesta correcta era: ${currentQuestion.answer}`;
                triviaFeedback.classList.add('text-red-600');
                
                // Resalta la opci√≥n incorrecta seleccionada por el usuario en rojo
                document.querySelectorAll('.trivia-option-button').forEach(button => {
                    if (button.dataset.option === selectedOption) {
                        button.classList.add('bg-red-600');
                        button.classList.remove('bg-blue-500', 'hover:bg-blue-600');
                    }
                });

                setTimeout(() => {
                    endTrivia(false); // Termina la trivia, indicando que no se gan√≥ el descuento
                }, 2000);
            }
            triviaFeedback.classList.remove('hidden'); // Asegura que el feedback sea visible
        }

        /**
         * Finaliza la trivia y muestra el resultado.
         * @param {boolean} won - True si el usuario gan√≥ el descuento, False de lo contrario.
         */
        function endTrivia(won = false) {
            // Asegura que los temporizadores se limpien al finalizar
            if (appState.currentTriviaTimer) clearInterval(appState.currentTriviaTimer);
            if (appState.currentQuestionTimeout) clearTimeout(appState.currentQuestionTimeout);

            let message = '';
            // Aplica el descuento si se cumplen las condiciones de victoria
            if (won && appState.triviaCorrectAnswers >= 5) { 
                appState.triviaBubbleDiscountActive = true; 
                message = `¬°Felicidades! üéâ Respondiste ${appState.triviaCorrectAnswers} preguntas correctamente. ¬°Has ganado un 10% de descuento EXCLUSIVO en el Show de Burbujas Gigantes! Este descuento se aplicar√° autom√°ticamente en tu carrito. ü•≥`;
            } else {
                message = `¬°Fin del juego! Respondiste ${appState.triviaCorrectAnswers} preguntas correctamente. Necesitas 5 aciertos para ganar. Sigue practicando para la pr√≥xima vez. No te preocupes, a√∫n puedes aprovechar nuestras otras promociones. üòä`;
                appState.triviaBubbleDiscountActive = false; // Asegura que el descuento no est√© activo si no se gan√≥
            }
            showInfoModal(message); // Muestra el resultado al usuario
            
            // Reinicia el estado de la trivia para futuras sesiones (aunque localStorage evita re-jugar)
            appState.currentTriviaQuestionIndex = 0;
            appState.triviaCorrectAnswers = 0;
            
            setActiveSection('home'); // Regresa a la secci√≥n de inicio
        }

        // --- L√≥gica Principal de la Aplicaci√≥n ---

        /**
         * Establece la secci√≥n activa y actualiza la navegaci√≥n.
         * @param {string} sectionName - El nombre de la secci√≥n a activar ('home', 'services', 'packages', 'trivia', 'booking').
         */
        function setActiveSection(sectionName) {
            appState.activeSection = sectionName;
            // Actualiza los estilos de los botones de navegaci√≥n para indicar la secci√≥n activa
            document.querySelectorAll('header nav button').forEach(button => {
                const buttonId = button.id;
                if ((buttonId === 'navHome' && sectionName === 'home') ||
                    (buttonId === 'navServices' && sectionName === 'services') ||
                    (buttonId === 'navPackages' && sectionName === 'packages') ||
                    (buttonId === 'navBooking' && sectionName === 'booking')) {
                    button.classList.add('bg-purple-500', 'text-white', 'shadow-md');
                    button.classList.remove('text-gray-700', 'hover:bg-purple-100');
                } else {
                    button.classList.remove('bg-purple-500', 'text-white', 'shadow-md');
                    button.classList.add('text-gray-700', 'hover:bg-purple-100');
                }
            });

            // Renderiza la secci√≥n correspondiente
            switch (sectionName) {
                case 'home':
                    renderHomeSection();
                    break;
                case 'services':
                    renderServicesSection();
                    break;
                case 'packages':
                    renderPackagesSection();
                    break;
                case 'trivia':
                    startTrivia(); 
                    break;
                case 'booking':
                    renderBookingSection();
                    break;
                default:
                    renderHomeSection(); // Fallback por defecto
            }
            updateCartSummary(); // Siempre actualiza el resumen del carrito al cambiar de secci√≥n
        }

        // --- Env√≠o del Formulario a Formspree ---
        /**
         * Maneja el env√≠o del formulario de reserva a Formspree.
         * @param {Event} event - El evento de env√≠o del formulario.
         */
        async function handleBookingSubmit(event) {
            event.preventDefault(); // Evita el env√≠o por defecto del formulario

            // ¬°IMPORTANTE! Reemplaza 'https://formspree.io/f/xyzjznaw' con tu endpoint real de Formspree.
            // Para obtener tu endpoint, visita Formspree.io, crea un nuevo formulario y copia la URL.
            const formspreeEndpoint = 'https://formspree.io/f/xyzjznaw'; 

            const formData = new FormData();
            formData.append('Fecha del Evento', document.getElementById('bookingDate').value);
            formData.append('Hora del Evento', document.getElementById('bookingTime').value);
            formData.append('Nombre del Cliente', document.getElementById('customerName').value);
            formData.append('Email del Cliente', document.getElementById('customerEmail').value);
            formData.append('Tel√©fono del Cliente', document.getElementById('customerPhone').value);
            formData.append('Tipo de Evento', document.getElementById('eventType').value);
            formData.append('N√∫mero Estimado de Ni√±os', document.getElementById('numKids').value);
            
            const selectedLocationName = appState.selectedLocation;
            const currentTransportFee = transportFeesByLocation[selectedLocationName] || 0;

            formData.append('Ubicaci√≥n Seleccionada', selectedLocationName);
            formData.append('Recargo por Transporte Aplicado', `$${currentTransportFee.toFixed(2)}`);
            formData.append('Direcci√≥n Exacta del Evento', document.getElementById('exactLocation').value);

            // Genera una cadena con los servicios/paquetes seleccionados y sus precios
            formData.append('Servicios/Paquetes Seleccionados', appState.selectedItems.map(item => {
                let itemPriceForEmail = item.price;
                const isPackage = packagesData.some(p => p.name === item.name); // Verifica si es un paquete

                // Aplica los descuentos para el c√°lculo del precio final en el email
                if (item.name === 'Pintacaritas üé®üëßüë¶' && item.quantity > 1) {
                    itemPriceForEmail = 35;
                } else if (appState.triviaBubbleDiscountActive && item.name === 'Show de Burbujas Gigantes ü´ß') {
                    itemPriceForEmail = item.price * 0.90;
                } else if (appState.monthlyPackageDiscountActive && isPackage) {
                    itemPriceForEmail = item.price * 0.90;
                }
                
                return `${item.name} ${item.quantity > 1 ? `(x${item.quantity})` : ''} ($${itemPriceForEmail.toFixed(2)})`; 
            }).join(', '));
            
            // Calcula el precio total final que se enviar√° en el formulario
            const totalItemsPrice = appState.selectedItems.reduce((sum, item) => {
                let itemPriceForCalculation = item.price;

                if (item.name === 'Pintacaritas üé®üëßüë¶' && item.quantity > 1) {
                    itemPriceForCalculation = 35;
                } else if (appState.triviaBubbleDiscountActive && item.name === 'Show de Burbujas Gigantes ü´ß') {
                    itemPriceForCalculation = item.price * 0.90;
                } else if (packagesData.some(p => p.name === item.name) && appState.monthlyPackageDiscountActive) {
                    itemPriceForCalculation = item.price * 0.90;
                }
                return sum + (itemPriceForCalculation * item.quantity);
            }, 0);
            const finalTotalPrice = totalItemsPrice + currentTransportFee;
            
            formData.append('Precio Total Estimado', finalTotalPrice.toFixed(2));
            
            formData.append('ID de Sesi√≥n (Visitante)', appState.userId);

            // Validaciones b√°sicas antes de enviar el formulario
            if (appState.selectedItems.length === 0) {
                showInfoModal('¬°Por favor, a√±ade al menos un servicio o paquete a tu reserva! üõí');
                return;
            }
            if (!document.getElementById('bookingDate').value || !document.getElementById('bookingTime').value ||
                !document.getElementById('customerName').value || !document.getElementById('customerEmail').value ||
                !document.getElementById('customerPhone').value || !document.getElementById('eventType').value ||
                !document.getElementById('numKids').value || !document.getElementById('exactLocation').value) {
                showInfoModal('¬°Oops! Por favor, completa todos los campos para realizar la reserva. üìù');
                return;
            }

            try {
                const response = await fetch(formspreeEndpoint, {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json'
                    },
                    body: formData
                });

                console.log('Formspree Response Status:', response.status);
                console.log('Formspree Response OK status:', response.ok);

                if (response.ok) {
                    try {
                        const data = await response.json();
                        // console.log("Formspree data:", data); // Para depuraci√≥n, puedes descomentar esto
                    } catch (e) {
                        console.warn("No se pudo parsear la respuesta exitosa de Formspree como JSON. Puede estar vac√≠a o no ser JSON v√°lido.", e);
                    }

                    showInfoModal('¬°Reserva realizada con √©xito! Nos pondremos en contacto contigo pronto. üéâü•≥');
                    document.getElementById('bookingForm').reset(); // Limpia el formulario
                    appState.selectedItems = []; // Limpia los √≠tems seleccionados del carrito
                    appState.selectedLocation = 'Panam√° Centro'; // Restablece la ubicaci√≥n

                    // Vuelve a renderizar la secci√≥n actual para reflejar los cambios
                    setActiveSection(appState.activeSection);
                    updateCartSummary(); // Actualiza el resumen del carrito
                } else {
                    let errorMessage = 'Int√©ntalo de nuevo.';
                    try {
                        const data = await response.json();
                        errorMessage = data.error || data.message || `Error con c√≥digo ${response.status}.`;
                    } catch (e) {
                        console.error("No se pudo parsear la respuesta de error de Formspree como JSON:", e);
                        errorMessage = `Error de red o servidor con c√≥digo ${response.status}.`;
                    }
                    console.error('Error de Formspree:', response.status, errorMessage);
                    showInfoModal(`Hubo un error al enviar tu reserva: ${errorMessage}üò•`);
                }
            } catch (error) {
                console.error("Error al enviar el formulario (error de red o fetch):", error);
                showInfoModal('Hubo un error de red al realizar tu reserva. Por favor, int√©ntalo de nuevo. üò•');
            }
        }

        // --- Inicializaci√≥n ---
        document.addEventListener('DOMContentLoaded', () => {
            // Carga el estado de la trivia desde localStorage al iniciar la p√°gina
            if (localStorage.getItem('triviaPlayed') === 'true') {
                appState.hasPlayedTrivia = true; 
            }

            // Asigna event listeners para los modales
            document.getElementById('closeModalButton').onclick = closeModal;
            document.getElementById('closePromoModalButton').onclick = closePromoModal;

            // Asigna event listeners para los botones de navegaci√≥n
            document.getElementById('navHome').onclick = () => setActiveSection('home');
            document.getElementById('navServices').onclick = () => setActiveSection('services');
            document.getElementById('navPackages').onclick = () => setActiveSection('packages');
            // Se elimin√≥ el event listener para el bot√≥n de Rese√±as
            document.getElementById('navBooking').onclick = () => setActiveSection('booking');
            document.getElementById('proceedToBookButton').onclick = () => setActiveSection('booking');

            // Establece la secci√≥n de inicio por defecto
            setActiveSection('home');
            updateCartSummary(); // Asegura que el resumen del carrito se muestre correctamente al inicio
        });
    </script>
</body>
</html>
