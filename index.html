<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- SEO optimized title: Includes main keywords and location to improve search engine visibility. -->
    <title>Diverty Eventos | Fiestas Infantiles en Panamá | Animación, Shows de Burbujas, Pintacaritas</title>
    <meta name="description" content="Organizamos las mejores fiestas infantiles en Panamá Centro, Arraiján, La Chorrera, Pacora y Panamá Norte. Expertos en animación infantil, shows de burbujas, pintacaritas, globoflexia, personajes temáticos y paquetes de diversión. ¡Haz que la fiesta de tus hijos sea inolvidable con Diverty Eventos en todo Panamá!">
    
    <!-- Open Graph Tags for social media and messaging apps (Facebook, WhatsApp, etc.). -->
    <meta property="og:title" content="Diverty Eventos | Fiestas Infantiles en Panamá">
    <meta property="og:description" content="Organizamos las mejores fiestas infantiles en Panamá. Animación, shows de burbujas, pintacaritas y más. ¡Haz la fiesta soñada de tus hijos con Diverty Eventos!">
    <!-- IMPORTANT! Corrected image URL for Netlify. -->
    <meta property="og:image" content="https://divertypanama.netlify.app/android-chrome-512x512.png"> 
    <meta property="og:image:width" content="512"> 
    <meta property="og:image:height" content="512"> 
    <meta property="og:image:alt" content="Logo de Diverty Eventos, para fiestas infantiles en Panamá">
    <meta property="og:url" content="https://divertypanama.netlify.app/"> <!-- Your actual website URL. -->
    <meta property="og:type" content="website">

    <!-- Google tag (gtag.js) for Google Analytics: Allows tracking of user visits and behavior. -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-R3G3Y0FLVN"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-R3G3Y0FLVN');
    </script>

    <!-- Schema Markup (Structured Data) for LocalBusiness and Organization - SEO: Helps search engines understand your business content. -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": ["LocalBusiness", "Organization"],
      "name": "Diverty Eventos",
      "image": "https://divertypanama.netlify.app/android-chrome-512x512.png", <!-- Main image URL for Schema Markup corrected. -->
      "url": "https://divertypanama.netlify.app/", <!-- Your actual site URL. -->
      "telephone": "+50766677965",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "Tu Dirección Exacta Aquí (Ej: Calle 50, Edificio XYZ)", <!-- IMPORTANT! Replace with your physical address. -->
        "addressLocality": "Panamá Centro",
        "addressRegion": "Panamá",
        "postalCode": "Tu Código Postal Aquí", <!-- Optional, but recommended if you have it. -->
        "addressCountry": "PA"
      },
      "priceRange": "$$",
      "openingHoursSpecification": [
        {
          "@type": "OpeningHoursSpecification",
          "dayOfWeek": [
            "Monday",
            "Tuesday",
            "Wednesday",
            "Thursday",
            "Friday"
          ],
          "opens": "09:00",
          "closes": "18:00"
        },
        {
          "@type": "OpeningHoursSpecification",
          "dayOfWeek": [
            "Saturday",
            "Sunday"
          ],
          "opens": "10:00",
          "closes": "17:00"
        }
      ],
      "hasOfferCatalog": {
        "@type": "OfferCatalog",
        "name": "Catálogo de Servicios y Paquetes de Fiestas Infantiles en Panamá",
        "itemListElement": [
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Pintacaritas para fiestas infantiles",
              "description": "Transforma a los niños en sus personajes favoritos con pinturas hipoalergénicas, un servicio ideal para fiestas infantiles en Panamá."
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Globoflexia para cumpleaños y eventos infantiles",
              "description": "Figuras divertidas y creativas hechas con globos para cada invitado, perfectas para cumpleaños y eventos infantiles en Panamá."
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Show de Burbujas Gigantes en Panamá",
              "description": "¡Burbujas enormes que los niños pueden atrapar y explotar! Un súper show único en Panamá para cualquier fiesta infantil."
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Paquete Fiesta Mágica Express para fiestas infantiles en Panamá",
              "description": "Diversión con animador, juegos, globos y piñata. Ideal para fiestas rápidas y cumpleaños en Panamá."
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Paquete Aventura de Ensueño para fiestas infantiles en Panamá",
              "description": "Servicio completo con payaso, pintacaritas, animación, juegos y piñata para una celebración inolvidable en Panamá."
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Paquete Celebración Personalizada para eventos infantiles en Panamá",
            "description": "Servicio premium con payaso, animación, pintacaritas, show de magia cómica y asistencia para piñata, diseñado para tu fiesta perfecta en Panamá."
          }
        }
        ]
      },
      "slogan": "¡Hacemos magia en tu fiesta infantil en Panamá!",
      "description": "Diverty Eventos ofrece la mejor animación y shows para fiestas infantiles en Panamá Centro, Arraiján, La Chorrera, Pacora y Panamá Norte. Especialistas en shows de burbujas, pintacaritas y paquetes de diversión inolvidable. ¡Organiza la fiesta soñada de tus hijos!"
    }
    </script>
    <!-- Tailwind CSS CDN for styles: Allows fast development and responsive design. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Poppins, Quicksand, Nunito for modern, legible typography. -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Poppins:wght@400;600;700;800&family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons CDN for professional SVG icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        /* Base styles for the page body */
        body {
            font-family: 'Quicksand', sans-serif; 
            margin: 0;
            padding: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%239C92AC' fill-opacity='0.05' fill-rule='evenodd'%3E%3Cpath d='M0 0h3v3H0V0zm3 3h3v3H3V3z'/%3E%3C/g%3E%3C/svg%3E"); /* Lighter pattern */
            background-repeat: repeat;
            background-size: 6px 6px;
            background-attachment: fixed;
        }
        /* Headings using Poppins for a professional touch */
        h1, h2, h3, h4 { 
            font-family: 'Poppins', sans-serif;
            font-weight: 800; /* Extra bold for more impact */
            letter-spacing: -0.03em; /* Slightly tighter letter spacing */
            line-height: 1.2; /* Better line height for headings */
        }
        p {
            line-height: 1.6; /* Improved line height for body text */
        }
        
        /* --- NEW HEADER STYLES --- */
        #mainHeader {
            transition: background-color 0.4s ease-out, box-shadow 0.4s ease-out;
            padding-top: 1rem; /* Increased padding */
            padding-bottom: 1rem; /* Increased padding */
        }
        #mainHeader.scrolled {
            background-color: rgba(255, 255, 255, 0.98); /* More opaque */
            backdrop-filter: blur(12px); /* Stronger blur */
            -webkit-backdrop-filter: blur(12px);
            box-shadow: 0 6px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* Stronger shadow */
        }
        .nav-link {
            transition: color 0.3s ease, border-bottom 0.3s ease, transform 0.2s ease; /* Added transform */
            position: relative;
            padding-bottom: 6px; /* More space for the border */
            font-weight: 600; /* Slightly bolder */
        }
        .nav-link.active {
            color: #db2777; /* Pink-600 */
            font-weight: 700;
            border-bottom: 3px solid #db2777; /* Thicker border */
        }
        .nav-link:hover {
            color: #db2777; /* Pink-600 on hover */
            transform: translateY(-2px); /* Subtle lift on hover */
        }
        
        /* --- NEW MOBILE MENU STYLES --- */
        #mobileMenu {
            position: fixed;
            top: 0;
            right: -100%; 
            width: 85%; /* Slightly wider */
            max-width: 350px; /* Increased max-width */
            height: 100%; 
            background-color: white;
            box-shadow: -15px 0 40px rgba(0,0,0,0.15); /* Stronger shadow */
            transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 100;
            display: flex;
            flex-direction: column;
            padding: 2rem; /* Increased padding */
        }
        #mobileMenu.open {
            right: 0; 
        }
        #mobileMenuOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6); /* Darker overlay */
            z-index: 99;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
        }
        #mobileMenuOverlay.open {
            opacity: 1;
            visibility: visible;
        }
        .mobile-nav-link {
            font-family: 'Quicksand', sans-serif; 
            font-size: 1.25rem; /* Slightly larger */
            padding: 1rem; /* Increased padding */
            border-radius: 0.75rem; /* More rounded */
            transition: background-color 0.2s ease, color 0.2s ease, transform 0.2s ease; /* Added transform */
        }
        .mobile-nav-link:hover, .mobile-nav-link.active {
            background-color: #f3e8ff; 
            color: #7e22ce; 
            transform: translateX(5px); /* Slide effect on hover */
        }

        /* Style for the floating WhatsApp button: Allows quick access to contact. */
        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.7);
            }
            70% {
                transform: scale(1.05);
                box-shadow: 0 0 0 10px rgba(37, 211, 102, 0);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(37, 211, 102, 0);
            }
        }
        .whatsapp-float-button {
            position: fixed;
            bottom: 25px; /* Slightly higher */
            right: 25px; /* Slightly more to the right */
            z-index: 1000;
            width: 60px; /* Slightly larger */
            height: 60px; /* Slightly larger */
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 9999px;
            box-shadow: 0 12px 20px -5px rgba(0, 0, 0, 0.15), 0 6px 10px -3px rgba(0, 0, 0, 0.08); /* Stronger shadow */
            transition: all 0.3s ease;
            background-image: linear-gradient(to bottom right, #25D366, #1DA851); 
            cursor: pointer;
            animation: pulse 2s infinite; 
        }
        .whatsapp-float-button:hover {
            transform: scale(1.12); /* More pronounced scale */
            box-shadow: 0 25px 35px -8px rgba(0, 0, 0, 0.15), 0 12px 15px -6px rgba(0, 0, 0, 0.08); /* Stronger shadow on hover */
            background-image: linear-gradient(to bottom right, #1DA851, #25D366); 
            animation: none; 
        }
        .whatsapp-float-button .lucide {
            color: white;
            width: 2.2rem; /* Slightly larger icon */
            height: 2.2rem; /* Slightly larger icon */
        }

        /* Style for inline validation error messages */
        .error-message {
            color: #ef4444; 
            font-size: 0.9rem; /* Slightly larger font */
            margin-top: 0.35rem; /* More spacing */
            font-weight: 600;
        }
        .input-error {
            border-color: #ef4444 !important; 
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2); /* Red ring on error */
        }
        /* Style for Lucide icons to ensure consistent sizing and alignment */
        .lucide {
            width: 1em;
            height: 1em;
            vertical-align: -0.15em; /* Better alignment */
            margin-right: 0.5em; /* More spacing */
            flex-shrink: 0;
        }
        button .lucide {
            margin-right: 0.6rem; /* More spacing */
        }
        
        /* Animations for elements appearing on screen */
        @keyframes slideUpFadeIn {
            from {
                opacity: 0;
                transform: translateY(30px); /* More pronounced slide */
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-slide-up-fade-in {
            animation: slideUpFadeIn 0.7s ease-out forwards; /* Slightly longer duration */
            opacity: 0; 
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fade-in {
            animation: fadeIn 0.9s ease-out forwards; /* Slightly longer duration */
        }

        /* Toast Notification Styles */
        #toastNotification {
            position: fixed;
            top: 25px; /* Slightly lower */
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000;
            padding: 14px 24px; /* More padding */
            border-radius: 9999px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25); /* Stronger shadow */
            color: white;
            font-weight: 700; /* Bolder text */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out, transform 0.3s ease-in-out;
            display: flex;
            align-items: center;
            gap: 10px; /* More gap */
        }
        #toastNotification.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }
        #toastNotification.success { background-color: #10B981; }
        #toastNotification.info { background-color: #3B82F6; }
        #toastNotification.error { background-color: #EF4444; }
        #toastNotification .lucide { width: 1.3em; height: 1.3em; margin-right: 0; }

        /* Hero Banner Specific Styles */
        .hero-banner {
            background-image: linear-gradient(to bottom right, #F8F4FF, #E0D4FF); /* Softer, richer purple gradient */
            background-size: cover;
            background-position: center;
            min-height: 80vh; /* Taller */
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            overflow: hidden;
            border-radius: 2.5rem; /* More rounded */
            box-shadow: 0 25px 40px -8px rgba(0, 0, 0, 0.15), 0 12px 20px -6px rgba(0, 0, 0, 0.08); /* Stronger, softer shadow */
            padding: 2rem; /* Ensure padding */
        }
        .hero-banner-content {
            position: relative;
            z-index: 2;
            color: #3A006F; /* Deeper purple text for contrast */
            padding: 2rem;
            max-width: 1000px; /* Wider content area */
            width: 100%; 
            margin: 0 auto; 
        }
        .hero-banner-content h2, .hero-banner-content p {
            color: #3A006F; 
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1); /* Subtle text shadow */
        }
        .hero-banner-content button {
            color: white; 
        }

        /* Modern card styles */
        .modern-card {
            border-style: solid; 
            border-width: 3px; /* Slightly thinner, more refined border */
            border-radius: 1.75rem; /* More rounded */
            box-shadow: 0 12px 20px -5px rgba(0, 0, 0, 0.1), 0 6px 10px -3px rgba(0, 0, 0, 0.05); /* Softer shadow */
            transition: transform 0.3s ease, box-shadow 0.3s ease; 
        }
        .modern-card:hover {
            transform: translateY(-8px) scale(1.03); /* More pronounced lift and scale */
            box-shadow: 0 25px 40px -8px rgba(0, 0, 0, 0.15), 0 12px 20px -6px rgba(0, 0, 0, 0.08); /* Stronger, softer shadow on hover */
        }

        /* Modern button styles */
        .modern-button {
            font-weight: 700; 
            padding: 0.9rem 1.8rem; /* More generous padding */
            border-radius: 9999px; 
            box-shadow: 0 5px 10px -2px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06); /* Subtle shadow */
            transition: all 0.3s ease; 
            border-width: 2px; 
            border-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1); /* Subtle text shadow on buttons */
        }
        .modern-button:hover {
            transform: translateY(-3px) scale(1.04); /* More pronounced lift and scale */
            box-shadow: 0 12px 20px -5px rgba(0, 0, 0, 0.15), 0 6px 10px -3px rgba(0, 0, 0, 0.08); /* Stronger shadow on hover */
        }
        .modern-button.remove-button {
            background-image: linear-gradient(to right, #EF4444, #DC2626); 
            border-color: #EF4444; 
        }
        .modern-button.remove-button:hover {
            background-image: linear-gradient(to right, #DC2626, #EF4444);
        }

        /* Form input focus styles */
        input[type="text"], input[type="email"], input[type="tel"], input[type="number"], input[type="date"], input[type="time"], select {
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        input[type="text"]:focus, input[type="email"]:focus, input[type="tel"]:focus, input[type="number"]:focus, input[type="date"]:focus, input[type="time"]:focus, select:focus {
            outline: none;
            border-color: #8B5CF6; /* Purple-500 for focus */
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3); /* Ring on focus */
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50 text-gray-800 flex flex-col">

    <!-- MODALS -->
    <div id="infoModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 p-4 hidden" role="dialog" aria-modal="true" aria-labelledby="modalMessage" aria-hidden="true">
        <div id="infoModalContent" tabindex="-1" class="bg-gradient-to-br from-purple-600 to-purple-800 text-white rounded-xl shadow-2xl p-6 max-w-sm w-full text-center border-4 border-purple-500 transform transition-all duration-300 scale-95 opacity-0">
            <p id="modalMessage" class="text-xl font-bold mb-4 text-white"></p>
            <button id="closeModalButton" class="bg-gradient-to-br from-purple-600 via-purple-400 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white font-bold py-2 px-5 rounded-full shadow-xl transition duration-300 border-2 border-white cursor-pointer flex items-center justify-center mx-auto" aria-label="Entendido, cerrar mensaje">
                ¡Entendido! <i data-lucide="check-circle" class="lucide"></i>
            </button>
        </div>
    </div>
    <div id="promoModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 p-4 hidden" role="dialog" aria-modal="true" aria-labelledby="promoMessage" aria-hidden="true">
        <div id="promoModalContent" tabindex="-1" class="bg-gradient-to-br from-pink-600 to-pink-800 text-white rounded-xl shadow-2xl p-6 max-w-md w-full text-center border-4 border-pink-500 transform transition-all duration-300 scale-95 opacity-0">
            <h2 class="text-3xl font-extrabold text-white mb-4">¡Promoción del Mes! <i data-lucide="star" class="lucide inline-block"></i></h2>
            <p id="promoMessage" class="text-lg text-gray-100 mb-4"></p>
            <p id="promoCountdown" class="text-2xl font-extrabold text-yellow-300 mb-6"></p> <!-- Added for countdown -->
            <button id="closePromoModalButton" class="bg-gradient-to-br from-pink-600 via-pink-400 to-pink-700 hover:from-pink-700 hover:to-pink-800 text-white font-bold py-2 px-5 rounded-full shadow-xl transition duration-300 border-2 border-white cursor-pointer flex items-center justify-center mx-auto" aria-label="Genial, cerrar promoción">
                ¡Genial! <i data-lucide="party-popper" class="lucide"></i>
            </button>
        </div>
    </div>
    <div id="bookingWarningModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 p-4 hidden" role="dialog" aria-modal="true" aria-labelledby="bookingWarningTitle" aria-hidden="true">
        <div id="bookingWarningModalContent" tabindex="-1" class="bg-gradient-to-br from-purple-600 to-purple-800 text-white rounded-xl shadow-2xl p-6 max-w-md w-full text-center border-4 border-purple-500 transform transition-all duration-300 scale-95 opacity-0">
            <h2 id="bookingWarningTitle" class="text-3xl font-extrabold text-white mb-4">¡Importante antes de Reservar! <i data-lucide="alert-triangle" class="lucide inline-block"></i></h2>
            <p class="text-lg text-gray-100 mb-6">
                Para asegurar la disponibilidad de la fecha y hora de tu evento, te recomendamos
                <span class="font-bold text-purple-200">verificar primero con nosotros vía WhatsApp</span>.
                ¡Así garantizamos la magia de tu día! <i data-lucide="sparkles" class="lucide inline-block"></i>
            </p>
            <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                <a href="https://wa.me/50766677965?text=¡Hola! Quiero consultar la disponibilidad de una fecha para un evento."
                   target="_blank"
                   class="bg-gradient-to-br from-green-500 via-green-400 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-6 rounded-full shadow-xl transition duration-300 flex items-center justify-center border-2 border-white cursor-pointer" aria-label="Contactar por WhatsApp para verificar disponibilidad">
                    <i data-lucide="message-circle"></i> Contactar por WhatsApp
                </a>
                <button id="closeBookingWarningModalButton" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-6 rounded-full shadow-md transition duration-300 cursor-pointer" aria-label="Continuar con el formulario de reserva">
                    Continuar con el Formulario
                </button>
            </div>
        </div>
    </div>
    <div id="miniCartModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 p-4 hidden" role="dialog" aria-modal="true" aria-labelledby="miniCartTitle" aria-hidden="true">
        <div id="miniCartModalContent" tabindex="-1" class="bg-gradient-to-br from-purple-600 to-purple-800 text-white rounded-xl shadow-2xl p-6 max-w-sm w-full text-center border-4 border-purple-500 transform transition-all duration-300 scale-95 opacity-0">
            <h2 id="miniCartTitle" class="text-2xl font-extrabold text-white mb-4">Tu Carrito de Diversión <i data-lucide="shopping-cart"></i></h2>
            <div id="miniCartItems" class="max-h-60 overflow-y-auto text-left mb-4 p-2 bg-purple-100 rounded-lg border border-purple-200 text-gray-800">
                <!-- Cart items will be loaded here dynamically -->
            </div>
            <div class="text-right font-bold text-white mb-4">
                <p class="text-xl text-pink-200">Total: <span id="miniCartTotalPrice">$0.00</span></p>
            </div>
            <div class="flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-3">
                <button id="closeMiniCartModalButton" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-5 rounded-full shadow-md transition duration-300 cursor-pointer flex items-center justify-center" aria-label="Cerrar carrito de compras">
                    Cerrar
                </button>
                <button id="miniCartProceedToBookButton" class="bg-gradient-to-br from-cyan-500 via-blue-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white font-bold py-2 px-5 rounded-full shadow-xl transition duration-300 border-2 border-white cursor-pointer flex items-center justify-center" aria-label="Proceder a reservar los elementos seleccionados">
                    Reservar Ahora <i data-lucide="sparkles"></i>
                </button>
            </div>
            <button id="clearCartButton" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-5 rounded-full shadow-md transition duration-300 cursor-pointer flex items-center justify-center mx-auto mt-4" aria-label="Vaciar todo el carrito">
                Vaciar Carrito <i data-lucide="trash-2"></i>
            </button>
        </div>
    </div>
    <div id="imageModal" class="fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center z-50 p-4 hidden" role="dialog" aria-modal="true" aria-labelledby="imageModalTitle" aria-hidden="true">
        <div id="imageModalContent" tabindex="-1" class="relative bg-white rounded-lg shadow-2xl p-2 max-w-full max-h-full overflow-hidden flex flex-col items-center justify-center transform transition-all duration-300 scale-95 opacity-0">
            <button id="closeImageModalButton" class="absolute top-2 right-2 bg-red-500 hover:bg-red-700 text-white rounded-full p-2 text-lg font-bold transition duration-300 z-10 w-8 h-8 flex items-center justify-center" aria-label="Cerrar imagen ampliada">
                &times;
            </button>
            <img id="modalImage" src="" alt="Imagen ampliada del servicio" class="max-w-full max-h-[80vh] object-contain rounded-lg">
        </div>
    </div>

    <!-- NEW HEADER -->
    <header id="mainHeader" class="py-4 px-6 w-full sticky top-0 z-40">
        <div class="container mx-auto flex justify-between items-center">
            <!-- Logo and Title -->
            <div class="flex items-center">
                <!-- Increased logo size significantly -->
                <img src="https://divertypanama.netlify.app/android-chrome-512x512.png" alt="Logo de Diverty Eventos" class="w-24 h-24 sm:w-28 sm:h-28 mr-3 rounded-full object-cover border-2 border-pink-400 shadow-md" loading="eager">
                <h1 class="text-3xl sm:text-4xl lg:text-5xl font-extrabold text-purple-900">
                    Diverty Eventos
                </h1>
            </div>

            <!-- Desktop Navigation -->
            <nav class="hidden lg:flex items-center space-x-6" aria-label="Navegación Principal">
                <button id="navHome" role="menuitem" class="nav-link text-gray-600 hover:text-pink-600 font-semibold flex items-center"><i data-lucide="home"></i> Inicio</button>
                <button id="navServices" role="menuitem" class="nav-link text-gray-600 hover:text-pink-600 font-semibold flex items-center"><i data-lucide="sparkles"></i> Servicios</button>
                <button id="navAnimatorPackages" role="menuitem" class="nav-link text-gray-600 hover:text-pink-600 font-semibold flex items-center"><i data-lucide="user-check"></i> Animadores</button>
                <button id="navClownPackages" role="menuitem" class="nav-link text-gray-600 hover:text-pink-600 font-semibold flex items-center"><i data-lucide="clown"></i> Payasos</button>
                <button id="navBubblePackages" role="menuitem" class="nav-link text-gray-600 hover:text-pink-600 font-semibold flex items-center"><i data-lucide="wind"></i> Burbujas</button>
                <button id="navTestimonials" role="menuitem" class="nav-link text-gray-600 hover:text-pink-600 font-semibold flex items-center"><i data-lucide="message-square"></i> Testimonios</button>
                <button id="navGallery" role="menuitem" class="nav-link text-gray-600 hover:text-pink-600 font-semibold flex items-center"><i data-lucide="image"></i> Galería</button>
                <button id="navBooking" class="bg-gradient-to-br from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white font-bold py-2 px-5 rounded-full shadow-lg transition duration-300 transform hover:scale-105 flex items-center">
                    <i data-lucide="calendar-check"></i> ¡Reserva Ahora!
                </button>
            </nav>

            <!-- Mobile Menu Toggle Button (Hamburger) -->
            <button id="mobileMenuToggle" class="lg:hidden p-2 rounded-md text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-purple-500 cursor-pointer" aria-controls="mobileMenu" aria-expanded="false" aria-label="Abrir menú de navegación">
                <i data-lucide="menu" class="h-7 w-7"></i>
            </button>
        </div>
    </header>

    <!-- NEW MOBILE MENU -->
    <div id="mobileMenuOverlay" aria-hidden="true"></div>
    <nav id="mobileMenu" aria-label="Navegación Móvil">
        <div class="flex justify-between items-center mb-6"> 
            <h2 class="text-2xl font-bold text-purple-800">Menú</h2>
            <button id="closeMobileMenuButton" class="p-2 text-gray-600 hover:text-purple-800" aria-label="Cerrar menú de navegación">
                <i data-lucide="x" class="h-8 w-8"></i> <!-- Larger icon -->
            </button>
        </div>
        <div class="flex flex-col space-y-3 overflow-y-auto flex-grow"> 
            <button id="mobileNavHome" class="mobile-nav-link text-gray-700 font-semibold flex items-center" role="menuitem"><i data-lucide="home"></i> Inicio</button>
            <button id="mobileNavServices" class="mobile-nav-link text-gray-700 font-semibold flex items-center" role="menuitem"><i data-lucide="sparkles"></i> Servicios</button>
            <button id="mobileNavAnimatorPackages" class="mobile-nav-link text-gray-700 font-semibold flex items-center" role="menuitem"><i data-lucide="user-check"></i> Paquetes Animadores</button>
            <button id="mobileNavClownPackages" class="mobile-nav-link text-gray-700 font-semibold flex items-center" role="menuitem"><i data-lucide="clown"></i> Paquetes Payasos</button>
            <button id="mobileNavBubblePackages" class="mobile-nav-link text-gray-700 font-semibold flex items-center" role="menuitem"><i data-lucide="wind"></i> Paquetes de Burbujas</button>
            <button id="mobileNavTestimonials" class="mobile-nav-link text-gray-700 font-semibold flex items-center" role="menuitem"><i data-lucide="message-square"></i> Testimonios</button>
            <button id="mobileNavGallery" class="mobile-nav-link text-gray-700 font-semibold flex items-center" role="menuitem"><i data-lucide="image"></i> Galería</button>
            <button id="mobileNavBooking" class="mt-6 w-full bg-gradient-to-br from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white font-bold py-3 px-5 rounded-full shadow-lg transition duration-300 flex items-center justify-center" role="menuitem"> 
                <i data-lucide="calendar-check"></i> ¡Reserva Ahora!
            </button>
        </div>
    </nav>
    
    <!-- Shopping Cart Summary (Floating Bar): Displays the number of items and the selected total. -->
    <div id="cartSummary" class="bg-gradient-to-br from-purple-200 to-purple-300 text-purple-800 font-extrabold p-4 text-center rounded-b-3xl shadow-xl border-b-4 border-purple-400 hidden sticky top-[76px] lg:top-[72px] z-30 transition-all duration-300 ease-in-out flex flex-col sm:flex-row justify-between items-center" role="status" aria-live="polite">
        <p class="text-xl sm:text-2xl mb-2 sm:mb-0 flex items-center">
            <i data-lucide="shopping-cart"></i> Ítems: <span id="selectedItemsCount" class="text-purple-700 ml-2">0</span> | Total: <span id="totalPriceDisplay" class="text-pink-700 ml-2">$0.00</span>
        </p>
        <div class="flex space-x-3">
            <button id="viewCartDetailsButton" class="bg-gradient-to-br from-purple-500 via-purple-400 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-2 px-4 rounded-full shadow-md text-sm transition duration-300 border-2 border-white cursor-pointer flex items-center justify-center" aria-label="Ver detalles del carrito">
                Ver Detalles <i data-lucide="shopping-cart"></i>
            </button>
            <button id="proceedToBookButton" class="bg-gradient-to-br from-cyan-500 via-blue-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white font-bold py-2 px-4 rounded-full shadow-xl text-sm transition duration-300 border-2 border-white cursor-pointer flex items-center justify-content-center" aria-label="Proceder a la reserva">
                Reservar <i data-lucide="sparkles"></i>
            </button>
        </div>
    </div>

    <!-- Main Content Area: Section content (Home, Services, etc.) will be dynamically loaded here. -->
    <main id="mainContent" class="container mx-auto p-4 flex-grow">
        <!-- Section content (Home, Services, etc.) will be injected here by JavaScript. -->
    </main>

    <!-- Floating WhatsApp Button: Quick access to contact via WhatsApp. -->
    <a href="https://wa.me/50766677965?text=¡Hola! Tengo una consulta sobre Diverty Eventos." class="whatsapp-float-button" target="_blank" aria-label="Contactar por WhatsApp">
        <i data-lucide="message-circle"></i> <!-- Changed to message-circle icon -->
    </a>

    <!-- Footer: Copyright information and slogan. -->
    <footer class="bg-purple-700 text-white py-8 px-4 text-center mt-8 rounded-t-xl shadow-inner w-full">
        <div class="container mx-auto grid grid-cols-1 md:grid-cols-3 gap-8 items-start">
            <!-- Contact Info -->
            <div class="flex flex-col items-center md:items-start">
                <h3 class="text-xl font-bold mb-3 flex items-center"><i data-lucide="phone" class="mr-2"></i> Contáctanos</h3>
                <p class="text-lg mb-2">Teléfono: <a href="tel:+50766677965" class="hover:underline">+507 6667-7965</a></p>
                <p class="text-lg mb-2">Email: <a href="mailto:divertypty@gmail.com" class="hover:underline">divertypty@gmail.com</a></p>
            </div>

            <!-- Social Media -->
            <div class="flex flex-col items-center">
                <h3 class="text-xl font-bold mb-3 flex items-center"><i data-lucide="share-2" class="mr-2"></i> Síguenos</h3>
                <div class="flex space-x-4">
                    <a href="https://www.facebook.com/DivertyEventosPty" target="_blank" class="text-white hover:text-blue-400 transition-colors duration-300" aria-label="Visita nuestra página de Facebook">
                        <i data-lucide="facebook" class="w-8 h-8"></i>
                    </a>
                    <a href="https://www.instagram.com/diverty_eventos_pty" target="_blank" class="text-white hover:text-pink-400 transition-colors duration-300" aria-label="Visita nuestro perfil de Instagram">
                        <i data-lucide="instagram" class="w-8 h-8"></i>
                    </a>
                    <a href="https://wa.me/50766677965" target="_blank" class="text-white hover:text-green-400 transition-colors duration-300" aria-label="Chatea con nosotros en WhatsApp">
                        <i data-lucide="message-circle" class="w-8 h-8"></i>
                    </a>
                </div>
            </div>

            <!-- Legal/Slogan -->
            <div class="flex flex-col items-center md:items-end">
                <h3 class="text-xl font-bold mb-3 flex items-center"><i data-lucide="sparkles" class="mr-2"></i> Nuestra Promesa</h3>
                <p class="text-lg font-semibold mb-2">&copy; 2023 Diverty Eventos.</p>
                <p class="text-base">¡Hacemos magia en cada fiesta infantil en Panamá!</p>
                <a href="#" class="text-sm text-gray-300 hover:underline mt-2">Política de Privacidad</a>
            </div>
        </div>
        <p class="text-sm mt-6">Todos los derechos reservados. Servicios de <strong>animación infantil</strong> y <strong>shows para fiestas</strong> en todo Panamá.</p>
    </footer>

    <!-- Toast Notification Container -->
    <div id="toastNotification" role="status" aria-live="polite"></div>

    <!-- JavaScript script for page functionality. -->
    <script>
        // --- Global Application State Management ---
        // 'appState' contains all state variables that control application behavior.
        let appState = {
            activeSection: 'home', // Currently visible section ('home', 'services', 'animatorPackages', 'clownPackages', 'bubblePackages', 'booking').
            userId: 'guest_user_' + Math.random().toString(36).substring(2, 9), // Unique ID for the guest user.
            selectedItems: [], // Array to store selected services/packages in the cart.
            promotedPackages: [], // Array to store the names of packages on promotion.
            selectedLocation: 'Panamá Centro', // Selected location for calculating transport surcharge.
            hasShownBookingWarning: false, // Indicates if the booking warning modal has already been shown in the session.
            infoModalCallback: null, // Callback to execute a function when the info modal closes.
            bookingFormData: { // Object to store booking form data, useful for persistence.
                bookingDate: '',
                bookingTime: '',
                customerName: '',
                customerEmail: '',
                customerPhone: '',
                eventType: '',
                numKids: '',
                exactLocation: '',
                selectedLocation: 'Panamá Centro' 
            },
            lastFocusedElement: null, // To store the element that had focus before a modal opened.
            promoEndDate: null, // New: End date for the promotion.
            countdownInterval: null // New: Interval ID for the countdown timer.
        };

        // --- Data Definition (Services and Packages) ---
        // Arrays of objects defining available services and packages, including prices and descriptions.
        const servicesData = [
            { id: '2', name: 'Pintacaritas', price: 45, description: 'Transforma a los niños en sus personajes favoritos con pinturas hipoalergénicas. Servicio por 1 hora, incluye mesa de maquillaje y silla profesional.', color: 'bg-gradient-to-br from-purple-100 to-purple-200 border-purple-300 text-purple-800', imageUrl: 'https://i.ibb.co/Kj8pkBJP/IMG-20250711-211956.jpg', icon: 'palette' },
            { id: '3', name: 'Globoflexia', price: 40, description: 'Figuras divertidas y creativas hechas con globos para cada invitado. Servicio por 1 hora.', color: 'bg-gradient-to-br from-pink-100 to-pink-200 border-pink-300 text-pink-800', imageUrl: 'https://i.ibb.co/21gCBMm3/IMG-20230423-173048-1.jpg', icon: 'balloon' },
            { 
                id: '7', 
                name: 'Decoraciones Temáticas', 
                price: 100, // Price updated to 100
                description: 'Transforma cualquier espacio en un mundo mágico con nuestras decoraciones personalizadas. ¡Elige tu temática favorita!', 
                color: 'bg-gradient-to-br from-pink-200 to-pink-300 border-pink-400 text-pink-800',
                type: 'theme_selection', // New type to handle theme selection
                imageUrl: 'https://i.ibb.co/p61CY7CW/IMG-20250624-WA0000.jpg', // Updated image URL here
                icon: 'sparkles',
                themes: {
                    ninas: [
                        'Barbie', 'Sirenita', 'Cenicienta', 'Moana grande', 'Moana bebé', 'Abejita',
                        'Luly Pampin', 'Stitch', 'Stitch y Ángela', 'Capivara', 'Minnie roja',
                        'Plim Plim rosa', 'Sirenita otro modelo nuevo', 'Rosita fresita', 'Masha y el oso',
                        'Unicornio', 'Frozen', 'Monster In', 'Granja rosa', 'Skay', 'Princesas bebé',
                        'Princesa grande', 'Bluey', 'Minnie bebé', 'Mariposas', 'Bebé Llorones',
                        'Minnie rosada', 'Gatita Marie', 'Pebells', 'Pollo Party', 'Abeja Maya',
                        'Bely y Beto', 'La Bella y la Bestia', 'Hello Kitty', 'Peppa', 'Harley Kuin',
                        'Merlina', 'Minnie Poll Party', 'Princesa Pich'
                    ],
                    ninos: [
                        'Real Madrid', 'Plaza Sésamo', 'Hot Wheels', 'Bebe Fin', 'Sonic', 'Bomberos',
                        'Legos', 'Dinosaurios', 'Dinosaurios animados', 'Plim Plim Safary',
                        'Inter de Miami', 'Batman', 'Granja', 'Fútbol', 'Mickey Safary', 'Chuchugua',
                        'Blippi', 'Minicraft', 'Plim Plim', 'Cars', 'Spiderman', 'Paw Patrol',
                        'Jefes en Pañales', 'Bam Bam', 'Safary', 'La Granja de Zenón', 'Mario Bros',
                        'Mickey Principe', 'Avengers', 'Cristiano', 'Coco Melón', 'Messi',
                        'Plim Plim piscina', 'Carritos', 'Aeroman', 'Constructor', 'Free Fires',
                        'Caballito', 'Rugrats', 'Barca'
                    ]
                }
            },
            // Thematic characters service (price updated to 75)
            {
                id: '9',
                name: 'Personajes Temáticos',
                price: 75, // Base price for one character, updated to $75
                description: '¡Sorprende a todos con la visita de tu personaje favorito! Elige entre Mickey, Minnie y Mario Bros. Servicio por 1 hora.',
                color: 'bg-gradient-to-br from-indigo-200 to-indigo-300 border-indigo-400 text-indigo-800',
                type: 'character_selection', // Special type to handle character selection
                imageUrl: 'https://i.ibb.co/nqvDyb7Y/IMG-20250623-WA0019.jpg', 
                icon: 'users',
                characters: [
                    { id: 'mickey', name: 'Mickey Mouse' },
                    { id: 'minnie', name: 'Minnie Mouse' },
                    { id: 'mario', name: 'Mario Bros.' }
                ]
            },
            { 
                id: '10', 
                name: 'Mini Taller de Manualidades', 
                price: 12.50, // Price per child, updated to $12.50
                description: 'Taller creativo con 2 manualidades, mobiliario (mesas y sillas), 1 recreadora encargada del taller, materiales, música y figuras con globos. ¡Diversión garantizada por niño!', 
                color: 'bg-gradient-to-br from-yellow-100 to-yellow-200 border-yellow-300 text-yellow-800',
                type: 'manualidades_workshop', // New type for this specific service
                imageUrl: 'https://i.ibb.co/ynXVt81f/IMG-20250709-164447.jpg',
                icon: 'scissors'
            },
            { id: '8', name: 'Máquinas de Snack Algodón y Pop Corn', price: 100, description: 'Máquinas de algodón de azúcar y palomitas de maíz para endulzar tu evento. Servicio por 3 horas.', color: 'bg-gradient-to-br from-purple-100 to-purple-200 border-purple-300 text-purple-800', icon: 'popcorn' } // Removed imageUrl
        ];

        // Data for Animator Packages
        const animatorPackagesData = [
            { id: 'P1', name: 'Plan Básico (Animador)', price: 80, services: [
                'Animador profesional',
                'Animación infantil',
                'Juegos y concursos',
                'Figuras con globos',
                'Romper la piñata'
            ], description: '1.5h de diversión: Animador, juegos, globos, piñata. ¡Rápido y alegre!', color: 'bg-gradient-to-br from-pink-200 to-pink-300 border-pink-400 text-pink-800', icon: 'rocket' }, // Removed imageUrl
            { id: 'P2', name: 'Plan Recreativo (Animador)', price: 100, services: [
                'Animador profesional',
                'Pintacaritas (1 hora)',
                'Animación infantil (1 hora)',
                'Juegos y concursos',
                'Figuras con globos',
                'Romper la piñata'
            ], description: '2h de aventura: Animador, pintacaritas, animación, juegos, globos, piñata. ¡Inolvidable!', color: 'bg-gradient-to-br from-indigo-200 to-indigo-300 border-indigo-400 text-indigo-800', icon: 'rainbow' } // Removed imageUrl
        ];

        // Data for Clown Packages
        const clownPackagesData = [
            { id: 'C1', name: 'Paquete Circo Divertido', price: 90, services: [ // Renamed from 'Paquete Payaso Risitas'
                'Payaso profesional',
                'Integración de niños y adultos', // Added
                'Juegos y concursos', // Added
                'Figuras básicas con globos',
                'Canto de cumpleaños', // Added
                'Romper la piñata'
            ], description: '1.5h de risas garantizadas con nuestro Payaso Risitas, lleno de juegos y humor para los más pequeños.', color: 'bg-gradient-to-br from-yellow-200 to-yellow-300 border-yellow-400 text-yellow-800', icon: 'smile' }, // Removed imageUrl
            // Removed 'C2' Paquete Circo Divertido
            { id: 'P3', name: 'Plan Magic (Payaso)', price: 135, services: [
                'Payaso profesional',
                'Animación, juegos y concursos (1.5 horas)',
                'Pintacaritas (1 hora)',
                'Show de magia cómica',
                'Asistencia para la piñata'
            ], description: '2.5h premium: Payaso, juegos, pintacaritas, magia cómica, asistencia de piñata. ¡Tu fiesta perfecta!', color: 'bg-gradient-to-br from-purple-200 to-purple-300 border-purple-400 text-purple-800', icon: 'magic-wand' }, // Removed imageUrl
            { 
                id: 'P4', 
                name: 'Plan Diverty (Payaso)', 
                price: 210, 
                services: [
                    'Payaso profesional',
                    'Juegos y concursos',
                    'Pintacaritas',
                    'Globoflexia',
                    'Show de Burbujas o Magia Cómica',
                    'Asistencia en la piñata'
                ], 
                description: '3h de diversión completa: Payaso, juegos, pintacaritas, globoflexia, show de burbujas o magia, y asistencia piñata. ¡La magia garantizada!', 
                color: 'bg-gradient-to-br from-green-200 to-green-300 border-green-400 text-green-800', icon: 'party-popper' // Removed imageUrl
            }
        ];

        // New array for Bubble Packages
        const bubblePackagesData = [
            {
                id: 'B2',
                name: 'Paquete Fiesta Burbuja Completa',
                price: 190, 
                services: [
                    'Animación infantil',
                    'Juegos y concursos',
                    'Payasito o Animador',
                    'Show de Burbujas Gigantes',
                    'Romper la piñata'
                ],
                description: '2 horas de diversión completa con animación, juegos, payasito, show de burbujas gigantes y asistencia en la piñata. ¡La fiesta burbuja soñada!',
                color: 'bg-gradient-to-br from-indigo-200 to-indigo-300 border-indigo-400 text-indigo-900', 
                imageUrl: 'https://i.ibb.co/p6gZT5JD/d8f8cf5e-4117-4f65-990e-43730827aa41-20250412-012526-0000.jpg',
                icon: 'sparkles'
            },
            {
                id: 'BS1',
                name: 'Show de Burbujas Premium', // Renamed from "Show Básico 🫧"
                price: 150,
                services: [
                    'Burbujas gigantes',
                    'Humo',
                    'Burbujas LED',
                    'Interacción con el público',
                    'Fotos dentro de la burbuja gigante', // New service
                    'Trucos con burbujas', // New service
                    'Burbujas de espuma' // New service
                ],
                description: '1 hora de show con burbujas gigantes, humo, burbujas LED, interacción con el público, fotos dentro de la burbuja gigante, trucos con burbujas y burbujas de espuma.', // Updated description
                color: 'bg-gradient-to-br from-blue-100 to-blue-200 border-blue-300 text-blue-800', /* Changed from green to blue for bubble packages */
                imageUrl: 'https://i.ibb.co/MJQgpHx/IMG-20250706-172005.jpg',
                icon: 'droplets'
            },
            {
                id: 'BS3',
                name: 'Show Corporativo/Especial',
                price: 220, // "Desde $220" implies a base price, using 220 as the base.
                services: [
                    'Show personalizado para centros comerciales, colegios o eventos grandes',
                    'Luces especiales'
                ],
                description: '1 hora de show personalizable (ajustable) para eventos corporativos, centros comerciales, colegios o eventos grandes, con luces especiales.',
                color: 'bg-gradient-to-br from-red-100 to-red-200 border-red-300 text-red-800', 
                imageUrl: 'https://i.ibb.co/qLdys8KJ/IMG-20250711-195845.jpg',
                icon: 'building'
            }
        ];

        // New data for company references
        const companyReferencesData = [
            { name: 'Royal Decameron', imageUrl: 'https://i.ibb.co/dFHJR2p/Burbujas-gigantes-en-el-royal-decameron-fyp-espect-culos-showdeburbujas-burbujas-parati-payasitos-an.jpg' },
            { name: 'Hotel Westin Playa Bonita', imageUrl: 'https://i.ibb.co/BHwfMchP/IMG-20250710-125312-157.jpg' },
            { name: 'Feria del Bebé 2025', imageUrl: 'https://i.ibb.co/qLdys8KJ/IMG-20250711-195845.jpg' },
            { name: 'Canal de Panamá', imageUrl: 'https://i.ibb.co/5g1gk7jM/Show-de-burbujas-gigantes-en-el-canal-de-panama-JPG.jpg' },
            { name: 'Santa María', imageUrl: 'https://i.ibb.co/8gFr1NqL/smcountryclub-3604355087222851995-JPG.jpg' }
        ];

        // New data for testimonials
        const testimonialsData = [
            {
                name: 'María G.',
                role: 'Mamá de Sofía',
                review: '¡La fiesta de Sofía fue mágica! Los pintacaritas y el show de burbujas fueron un éxito total. ¡Diverty Eventos superó nuestras expectativas!',
                imageUrl: 'https://placehold.co/100x100/A78BFA/FFFFFF?text=MG'
            },
            {
                name: 'Carlos R.',
                role: 'Papá de Mateo',
                review: 'Contratamos el Plan Diverty y fue la mejor decisión. El animador mantuvo a todos los niños entretenidos. ¡Profesionales y divertidos!',
                imageUrl: 'https://placehold.co/100x100/F472B6/FFFFFF?text=CR'
            },
            {
                name: 'Ana S.',
                role: 'Organizadora de Eventos',
                review: 'Para nuestros eventos corporativos, Diverty Eventos es siempre la primera opción. Su show de burbujas es espectacular y muy bien recibido por las familias.',
                imageUrl: 'https://placehold.co/100x100/60A5FA/FFFFFF?text=AS'
            }
        ];

        // New data for gallery
        const galleryData = [
            { imageUrl: 'https://i.ibb.co/Kj8pkBJP/IMG-20250711-211956.jpg', alt: 'Pintacaritas en acción' },
            { imageUrl: 'https://i.ibb.co/21gCBMm3/IMG-20230423-173048-1.jpg', alt: 'Figuras de globoflexia' },
            { imageUrl: 'https://i.ibb.co/p61CY7CW/IMG-20250624-WA0000.jpg', alt: 'Decoración temática de fiesta' },
            { imageUrl: 'https://i.ibb.co/nqvDyb7Y/IMG-20250623-WA0019.jpg', alt: 'Personaje temático en evento' },
            { imageUrl: 'https://i.ibb.co/ynXVt81f/IMG-20250709-164447.jpg', alt: 'Taller de manualidades para niños' },
            { imageUrl: 'https://i.ibb.co/p6gZT5JD/d8f8cf5e-4117-4f65-990e-43730827aa41-20250412-012526-0000.jpg', alt: 'Show de burbujas gigantes' },
            { imageUrl: 'https://i.ibb.co/MJQgpHx/IMG-20250706-172005.jpg', alt: 'Burbujas premium con luces LED' },
            { imageUrl: 'https://i.ibb.co/qLdys8KJ/IMG-20250711-195845.jpg', alt: 'Evento corporativo con show de burbujas' }
        ];


        // Transport surcharges by event location.
        const transportFeesByLocation = {
            'Panamá Centro': 0,
            'Arraiján': 10,
            'La Chorrera': 15,
            'Pacora': 10,
            'Panamá Norte': 10,
        };

        // --- Helper Functions ---

        /**
         * Injects the HTML of a section into the main content area.
         * @param {string} sectionHtml - The HTML of the section to render.
         */
        function renderSection(sectionHtml) {
            try {
                const mainContentElement = document.getElementById('mainContent');
                if (mainContentElement) {
                    mainContentElement.innerHTML = sectionHtml;
                    // After rendering, ensure Lucide icons are created
                    lucide.createIcons();
                    console.log('renderSection: Contenido inyectado y iconos creados.');
                } else {
                    console.error('renderSection: Elemento #mainContent no encontrado.');
                }
            } catch (error) {
                console.error('renderSection: Error al renderizar la sección:', error);
            }
        }

        /**
         * Sets the active section of the application and renders it.
         * @param {string} sectionName - The name of the section to activate ('home', 'services', 'animatorPackages', 'clownPackages', 'bubblePackages', 'booking', 'testimonials', 'gallery').
         */
        function setActiveSection(sectionName) {
            console.log(`setActiveSection: Cambiando a la sección: ${sectionName}`);
            appState.activeSection = sectionName;
            // Hide mobile menu if open
            toggleMobileMenu(false);

            // Update active state for navigation links
            document.querySelectorAll('.nav-link, .mobile-nav-link').forEach(link => {
                link.classList.remove('active');
            });

            // Add active class to the current section's button
            const desktopNavButton = document.getElementById(`nav${sectionName.charAt(0).toUpperCase() + sectionName.slice(1)}`);
            const mobileNavButton = document.getElementById(`mobileNav${sectionName.charAt(0).toUpperCase() + sectionName.slice(1)}`);

            if (desktopNavButton) desktopNavButton.classList.add('active');
            if (mobileNavButton) mobileNavButton.classList.add('active');

            // Render the selected section
            if (sectionName === 'home') {
                renderHomeSection();
            } else if (sectionName === 'services') {
                renderServicesSection();
            } else if (sectionName === 'animatorPackages') { // Now for Animator Packages
                renderAnimatorPackagesSection();
            } else if (sectionName === 'clownPackages') { // NEW for Clown Packages
                renderClownPackagesSection();
            } else if (sectionName === 'bubblePackages') {
                renderBubblePackagesSection();
                // Also render company references below bubble packages
                renderCompanyReferencesSection();
            } else if (sectionName === 'testimonials') { // NEW
                renderTestimonialsSection();
            } else if (sectionName === 'gallery') { // NEW
                renderGallerySection();
            }
            else if (sectionName === 'booking') {
                renderBookingSection();
                // Show booking warning only once per session
                if (!appState.hasShownBookingWarning) {
                    showBookingWarningModal();
                    appState.hasShownBookingWarning = true;
                }
            }
            updateCartSummary(); // Update cart summary visibility based on active section
        }

        /**
         * Calculates the total cost for a given item's quantity, applying special pricing logic.
         * For 'Pintacaritas', the first hour is $45, subsequent hours are $40.
         * @param {object} item - The item object (service or package) with properties like name, price, quantity.
         * @returns {number} The total cost of the item for the given quantity.
         */
        function getAdjustedItemPrice(item) {
            if (item.quantity <= 0) {
                return 0; // If quantity is 0 or less, the total cost for this item is 0.
            }

            if (item.name === 'Pintacaritas') { // Changed name to match data
                if (item.quantity === 1) {
                    return 45; // First hour is $45.
                } else {
                    // Calculate total cost: first hour at $45, subsequent hours at $40.
                    return 45 + (item.quantity - 1) * 40;
                }
            }
            // Monthly discount logic for promoted packages.
            else if (appState.promotedPackages.includes(item.name)) {
                return item.price * item.quantity * 0.90; // 10% discount on total.
            }
            // For all other services/packages, calculate total based on unit price * quantity.
            return item.price * item.quantity;
        }

        /**
         * Updates the floating cart summary with the number of items and total price.
         * Applies discount logic if active.
         */
        function updateCartSummary() {
            const cartSummaryDiv = document.getElementById('cartSummary');
            // If the active section is 'booking', ensure the cart is hidden and do nothing else.
            if (appState.activeSection === 'booking') {
                if (cartSummaryDiv) cartSummaryDiv.classList.add('hidden');
                return; 
            }

            let currentTotalPrice = appState.selectedItems.reduce((sum, item) => {
                // Sum the total price of each item (calculated by getAdjustedItemPrice).
                return sum + getAdjustedItemPrice(item);
            }, 0);

            // Add transport surcharge based on the selected location.
            currentTotalPrice += transportFeesByLocation[appState.selectedLocation] || 0;

            const selectedItemsCountSpan = document.getElementById('selectedItemsCount');
            const totalPriceDisplaySpan = document.getElementById('totalPriceDisplay');

            if (selectedItemsCountSpan && totalPriceDisplaySpan && cartSummaryDiv) {
                const totalItemsInCart = appState.selectedItems.reduce((total, item) => total + item.quantity, 0);
                if (totalItemsInCart > 0 || currentTotalPrice > 0) {
                    cartSummaryDiv.classList.remove('hidden');
                    selectedItemsCountSpan.textContent = totalItemsInCart;
                    totalPriceDisplaySpan.textContent = `$${currentTotalPrice.toFixed(2)}`;
                } else {
                    cartSummaryDiv.classList.add('hidden');
                }
            }
        }

        /**
         * Handles adding/removing/decrementing items in the cart.
         * @param {object} item - The service/package object to add/remove. Must contain { name, price }.
         * @param {string} actionType - 'add' to add/increment, 'remove_all' to remove all units, 'toggle' to toggle (used for non-repeatable items).
         * @param {number} [quantity=1] - The quantity to add or set.
         */
        function handleCartAction(item, actionType, quantity = 1) {
            console.log(`handleCartAction called: item=${item.name}, actionType=${actionType}, quantity=${quantity}`);
            console.log('appState.selectedItems BEFORE:', JSON.stringify(appState.selectedItems));

            const existingItemIndex = appState.selectedItems.findIndex(selected => selected.name === item.name);
            let message = '';
            let toastType = 'info';

            if (actionType === 'add') {
                if (existingItemIndex > -1) {
                    appState.selectedItems[existingItemIndex].quantity += quantity;
                    message = `Se añadió 1 unidad más de "${item.name}".`;
                } else {
                    appState.selectedItems.push({ ...item, quantity: quantity });
                    message = `"${item.name}" añadido al carrito.`;
                }
                toastType = 'success';
            } else if (actionType === 'set_quantity') { // New action type for direct quantity setting
                if (quantity <= 0) { // If quantity is 0 or less, remove item
                    appState.selectedItems = appState.selectedItems.filter(selected => selected.name !== item.name);
                    message = `"${item.name}" eliminado del carrito.`;
                    toastType = 'info';
                } else if (existingItemIndex > -1) {
                    appState.selectedItems[existingItemIndex].quantity = quantity;
                    message = `Cantidad de "${item.name}" actualizada a ${quantity}.`;
                    toastType = 'success';
                } else {
                    appState.selectedItems.push({ ...item, quantity: quantity });
                    message = `"${item.name}" añadido al carrito (x${quantity}).`;
                    toastType = 'success';
                }
            } else if (actionType === 'remove_all') {
                // Filter out the item to remove all its units.
                appState.selectedItems = appState.selectedItems.filter(selected => selected.name !== item.name);
                message = `"${item.name}" eliminado del carrito.`;
                toastType = 'info';
            } else if (actionType === 'toggle') { // For non-repeatable services (e.g., packages).
                if (existingItemIndex > -1) {
                    // If already selected, remove it.
                    appState.selectedItems = appState.selectedItems.filter(selected => selected.name !== item.name);
                    message = `"${item.name}" eliminado del carrito.`;
                    toastType = 'info';
                } else {
                    // If not selected, add it with quantity 1.
                    appState.selectedItems.push({ ...item, quantity: 1 });
                    message = `"${item.name}" añadido al carrito.`;
                    toastType = 'success';
                }
            }
            console.log('appState.selectedItems AFTER:', JSON.stringify(appState.selectedItems));

            // Re-render the active section to update buttons and prices.
            if (appState.activeSection === 'services') {
                renderServicesSection();
            } else if (appState.activeSection === 'home') {
                renderHomeSection();
            } else if (appState.activeSection === 'animatorPackages') {
                renderAnimatorPackagesSection();
            } else if (appState.activeSection === 'clownPackages') {
                renderClownPackagesSection();
            } else if (appState.activeSection === 'bubblePackages') {
                renderBubblePackagesSection();
            } else if (appState.activeSection === 'booking') {
                renderBookingSection();
            }
            updateCartSummary(); // Update the floating cart bar.
            saveBookingFormData(); // Save cart state after each action.

            // Show toast notification
            showToast(message, toastType);
        }

        /**
         * Handles adding or changing a thematic character in the cart.
         * Allows adding multiple characters, incrementing the quantity if already in the cart.
         * @param {object} service - The "Thematic Characters" service object (base).
         * @param {object} character - The selected character object ({ id, name }).
         * @param {string} action - 'add' to add or 'remove_all' to remove.
         */
        function updateCharacterInCart(service, character, action) {
            const fullCharacterName = `${service.name}: ${character.name}`;
            const existingItemIndex = appState.selectedItems.findIndex(selected => selected.name === fullCharacterName);
            let message = '';
            let toastType = 'info';

            if (action === 'add') {
                if (existingItemIndex > -1) {
                    // If the character already exists, increment its quantity
                    appState.selectedItems[existingItemIndex].quantity++;
                    message = `Se añadió 1 unidad más de "${character.name}".`;
                } else {
                    // Add a new character with the base price of the service
                    appState.selectedItems.push({
                        id: `${service.id}-${character.id}`,
                        name: fullCharacterName,
                        price: service.price, // Use the base price of the character service
                        quantity: 1
                    });
                    message = `"${character.name}" añadido al carrito.`;
                }
                toastType = 'success';
            } else if (action === 'remove_all') {
                // Remove all instances of a specific character from the cart.
                appState.selectedItems = appState.selectedItems.filter(item => item.name !== fullCharacterName);
                message = `"${character.name}" eliminado del carrito.`;
                toastType = 'info';
            }
            // Re-render the services section and update the cart summary
            renderServicesSection();
            updateCartSummary();
            saveBookingFormData(); // Save cart state after each action.
            showToast(message, toastType);
        }

        /**
         * Handles adding or changing a theme in the cart.
         * Allows adding multiple themes, incrementing the quantity if already in the cart.
         * @param {object} service - The "Thematic Decorations" service object (base).
         * @param {string} themeName - The name of the selected theme.
         * @param {string} action - 'add' to add or 'remove_all' to remove.
         */
        function updateThemeInCart(service, themeName, action) {
            const fullThemeName = `${service.name}: ${themeName}`;
            const existingItemIndex = appState.selectedItems.findIndex(selected => selected.name === fullThemeName);
            let message = '';
            let toastType = 'info';

            if (action === 'add') {
                if (existingItemIndex > -1) {
                    appState.selectedItems[existingItemIndex].quantity++;
                    message = `Se añadió 1 unidad más de "${themeName}".`;
                } else {
                    appState.selectedItems.push({
                        id: `${service.id}-${themeName.replace(/\s+/g, '-')}`, // Generate a simple ID
                        name: fullThemeName,
                        price: service.price, // Use the base price of the decoration service
                        quantity: 1
                    });
                    message = `"${themeName}" añadido al carrito.`;
                }
                toastType = 'success';
            } else if (action === 'remove_all') {
                appState.selectedItems = appState.selectedItems.filter(item => item.name !== fullThemeName);
                message = `"${themeName}" eliminado del carrito.`;
                toastType = 'info';
            }
            renderServicesSection();
            updateCartSummary();
            saveBookingFormData(); // Save cart state after each action.
            showToast(message, toastType);
        }

        /**
         * Returns the image URL for a given item name.
         * @param {string} itemName - The name of the item.
         * @returns {string} The URL of the item's image, or a placeholder if not found.
         */
        function getItemImageUrl(itemName) {
            // Check servicesData
            const service = servicesData.find(s => s.name === itemName || itemName.startsWith(s.name + ':'));
            if (service && service.imageUrl) {
                return service.imageUrl;
            }
            // Check animatorPackagesData (Animators) - NO IMAGE FOR THESE SECTIONS
            // const animatorPkg = animatorPackagesData.find(p => p.name === itemName);
            // if (animatorPkg && animatorPkg.imageUrl) {
            //     return animatorPkg.imageUrl;
            // }
            // Check clownPackagesData (Clowns) - NO IMAGE FOR THESE SECTIONS
            // const clownPkg = clownPackagesData.find(p => p.name === itemName);
            // if (clownPkg && clownPkg.imageUrl) {
            //     return clownPkg.imageUrl;
            // }
            // Check bubblePackagesData
            const bubblePkg = bubblePackagesData.find(bp => bp.name === itemName);
            if (bubblePkg && bubblePkg.imageUrl) {
                return bubblePkg.imageUrl;
            }
            // Default placeholder if no specific image is found
            return 'https://placehold.co/40x40/E0F2F7/000000?text=Item';
        }


        // --- Modal Functions (Pop-up Windows) ---
        /**
         * Manages modal visibility and accessibility.
         * @param {HTMLElement} modalElement - The main modal container element.
         * @param {HTMLElement} modalContentElement - The modal content element (with tabindex="-1").
         * @param {boolean} show - True to show, false to hide.
         * @param {function} [callback] - Optional callback for when the modal closes.
         */
        function toggleModal(modalElement, modalContentElement, show, callback = null) {
            if (!modalElement || !modalContentElement) {
                console.error("Error: Modal elements not found.");
                return;
            }

            if (show) {
                appState.lastFocusedElement = document.activeElement; // Store the currently focused element
                modalElement.classList.remove('hidden');
                modalElement.setAttribute('aria-hidden', 'false');
                document.body.style.overflow = 'hidden'; // Prevent scrolling background
                setTimeout(() => {
                    modalContentElement.classList.remove('scale-95', 'opacity-0');
                    modalContentElement.classList.add('scale-100', 'opacity-100');
                    modalContentElement.focus(); // Set focus to the modal content
                }, 10);
                // Add event listener for Escape key
                document.addEventListener('keydown', handleEscapeKey);
                appState.infoModalCallback = callback; // For infoModal specific callback
            } else {
                modalContentElement.classList.remove('scale-100', 'opacity-100');
                modalContentElement.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    modalElement.classList.add('hidden');
                    modalElement.setAttribute('aria-hidden', 'true');
                    document.body.style.overflow = ''; // Restore scrolling
                    if (appState.lastFocusedElement) {
                        appState.lastFocusedElement.focus(); // Restore focus
                        appState.lastFocusedElement = null;
                    }
                    document.removeEventListener('keydown', handleEscapeKey); // Remove Escape key listener
                    if (callback) { // For general modal callbacks
                        callback();
                    }
                    if (appState.infoModalCallback) { // For infoModal specific callback
                        appState.infoModalCallback();
                        appState.infoModalCallback = null;
                    }
                }, 300); // Duration of the CSS transition
            }
        }

        /**
         * Handles the Escape key press to close the active modal.
         * @param {KeyboardEvent} event - The keyboard event.
         */
        function handleEscapeKey(event) {
            if (event.key === 'Escape') {
                const infoModal = document.getElementById('infoModal');
                const promoModal = document.getElementById('promoModal');
                const bookingWarningModal = document.getElementById('bookingWarningModal');
                const miniCartModal = document.getElementById('miniCartModal');
                const imageModal = document.getElementById('imageModal');

                if (!infoModal.classList.contains('hidden')) {
                    closeModal();
                } else if (!promoModal.classList.contains('hidden')) {
                    closePromoModal();
                } else if (!bookingWarningModal.classList.contains('hidden')) {
                    closeBookingWarningModal();
                } else if (!miniCartModal.classList.contains('hidden')) {
                    closeMiniCartModal();
                } else if (!imageModal.classList.contains('hidden')) {
                    closeImageModal();
                }
            }
        }

        /**
         * Displays a generic information modal.
         * @param {string} message - The message to display in the modal.
         * @param {function} [callback] - Function to execute when the modal closes.
         */
        function showInfoModal(message, callback = null) {
            const modal = document.getElementById('infoModal');
            const modalContent = document.getElementById('infoModalContent');
            const modalMessage = document.getElementById('modalMessage');
            if (modalMessage) modalMessage.innerHTML = message; // Use innerHTML for icons
            toggleModal(modal, modalContent, true, callback);
        }

        /**
         * Hides the generic information modal.
         */
        function closeModal() {
            const modal = document.getElementById('infoModal');
            const modalContent = document.getElementById('infoModalContent');
            const modalMessage = document.getElementById('modalMessage');
            if (modalMessage) modalMessage.textContent = ''; // Clear message on close
            toggleModal(modal, modalContent, false);
        }

        /**
         * Displays the promotion modal and activates the monthly discount.
         * @param {string} message - The promotion message.
         */
        function showPromoInfoModal(message) {
            const promoModal = document.getElementById('promoModal');
            const promoModalContent = document.getElementById('promoModalContent');
            const promoMessage = document.getElementById('promoMessage');
            const promoCountdown = document.getElementById('promoCountdown');

            // Set promotion end date (e.g., 7 days from now)
            const endDate = new Date();
            endDate.setDate(endDate.getDate() + 7); // Set to 7 days from today
            appState.promoEndDate = endDate;

            // Format end date for display
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            const formattedEndDate = endDate.toLocaleDateString('es-ES', options);

            if (promoMessage) promoMessage.innerHTML = `${message}<br>Oferta válida hasta el <strong>${formattedEndDate}</strong>.`;
            
            // Set all bubble packages for promotion
            appState.promotedPackages = bubblePackagesData.map(pkg => pkg.name);

            updateCartSummary();
            // Re-render sections if active to show the discount.
            if (appState.activeSection === 'services') renderServicesSection();
            if (appState.activeSection === 'home') renderHomeSection();
            if (appState.activeSection === 'animatorPackages') renderAnimatorPackagesSection();
            if (appState.activeSection === 'clownPackages') renderClownPackagesSection();
            if (appState.activeSection === 'bubblePackages') renderBubblePackagesSection();
            if (appState.activeSection === 'booking') renderBookingSection();

            toggleModal(promoModal, promoModalContent, true);

            // Start countdown
            if (appState.countdownInterval) {
                clearInterval(appState.countdownInterval);
            }
            updateCountdown(); // Initial call
            appState.countdownInterval = setInterval(updateCountdown, 1000);
        }

        /**
         * Updates the countdown timer in the promotion modal.
         */
        function updateCountdown() {
            const promoCountdown = document.getElementById('promoCountdown');
            if (!promoCountdown || !appState.promoEndDate) {
                if (appState.countdownInterval) clearInterval(appState.countdownInterval);
                return;
            }

            const now = new Date().getTime();
            const distance = appState.promoEndDate.getTime() - now;

            if (distance < 0) {
                clearInterval(appState.countdownInterval);
                promoCountdown.textContent = "¡Oferta Finalizada!";
                // Optionally, remove the discount if the promotion has truly ended.
                // appState.promotedPackages = []; 
                // updateCartSummary();
                // if (appState.activeSection === 'packages') renderPackagesSection();
                // if (appState.activeSection === 'bubblePackages') renderBubblePackagesSection();
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            promoCountdown.textContent = `¡Quedan ${days}d ${hours}h ${minutes}m ${seconds}s!`;
        }

        /**
         * Hides the promotion modal.
         */
        function closePromoModal() {
            const modal = document.getElementById('promoModal');
            const modalContent = document.getElementById('promoModalContent');
            const promoMessage = document.getElementById('promoMessage');
            const promoCountdown = document.getElementById('promoCountdown');

            if (promoMessage) promoMessage.textContent = ''; // Clear message on close
            if (promoCountdown) promoCountdown.textContent = ''; // Clear countdown on close

            toggleModal(modal, modalContent, false);
            // Clear the countdown interval when the modal is closed
            if (appState.countdownInterval) {
                clearInterval(appState.countdownInterval);
                appState.countdownInterval = null;
            }
            // Promoted packages are not cleared so the discount persists during the session.
            updateCartSummary();
            if (appState.activeSection === 'home') renderHomeSection();
            if (appState.activeSection === 'animatorPackages') renderAnimatorPackagesSection();
            if (appState.activeSection === 'clownPackages') renderClownPackagesSection();
            if (appState.activeSection === 'bubblePackages') renderBubblePackagesSection();
        }

        /**
         * Displays the booking warning modal.
         */
        function showBookingWarningModal() {
            const modal = document.getElementById('bookingWarningModal');
            const modalContent = document.getElementById('bookingWarningModalContent');
            toggleModal(modal, modalContent, true);
        }

        /**
         * Hides the booking warning modal.
         */
        function closeBookingWarningModal() {
            const modal = document.getElementById('bookingWarningModal');
            const modalContent = document.getElementById('bookingWarningModalContent');
            toggleModal(modal, modalContent, false);
        }

        /**
         * Displays the mini-cart modal with details of selected items.
         */
        function showMiniCartModal() {
            const miniCartModal = document.getElementById('miniCartModal');
            const miniCartModalContent = document.getElementById('miniCartModalContent');
            const miniCartItemsDiv = document.getElementById('miniCartItems');
            const miniCartTotalPriceSpan = document.getElementById('miniCartTotalPrice');
            
            if (!miniCartModal || !miniCartModalContent || !miniCartItemsDiv || !miniCartTotalPriceSpan) {
                console.error("Error: One or more essential mini-cart modal elements not found. Cannot display modal.");
                return;
            }

            if (appState.selectedItems.length === 0) {
                miniCartItemsDiv.innerHTML = '<p class="text-gray-600 text-center">Tu carrito está vacío. ¡Añade algo de magia!</p>';
            } else {
                miniCartItemsDiv.innerHTML = appState.selectedItems.map(item => {
                    const itemTotalPrice = getAdjustedItemPrice(item);
                    const itemImageUrl = getItemImageUrl(item.name); // Get image URL for the item
                    
                    let strikethroughHtml = '';
                    if (item.name === 'Pintacaritas' && item.quantity > 1) {
                        strikethroughHtml = `<span class="line-through text-gray-500 text-xs">$${item.price.toFixed(2)}</span> `;
                    } else if (item.name !== 'Pintacaritas' && appState.promotedPackages.includes(item.name)) {
                        strikethroughHtml = `<span class="line-through text-gray-500 text-xs">$${item.price.toFixed(2)}</span> `;
                    }

                    return `
                        <div class="flex justify-between items-center py-1 border-b border-gray-100 last:border-b-0">
                            <div class="flex items-center">
                                <img src="${itemImageUrl}" alt="Imagen de ${item.name}" class="w-10 h-10 object-cover rounded-md mr-2" loading="lazy">
                                <span class="font-semibold text-gray-800 text-sm">${item.name} ${item.quantity > 1 ? `(x${item.quantity})` : ''}</span>
                            </div>
                            <div class="flex items-center flex-shrink-0 ml-4">
                                ${strikethroughHtml}
                                <span class="font-bold text-pink-600 text-base whitespace-nowrap">$${itemTotalPrice.toFixed(2)}</span>
                                <button class="remove-item-from-minicart-button text-red-500 hover:text-red-700 font-bold ml-2 transition duration-200 cursor-pointer" data-item-name="${item.name}" aria-label="Quitar ${item.name}"><i data-lucide="x-circle"></i></button>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            const totalItemsPrice = appState.selectedItems.reduce((sum, item) => {
                return sum + getAdjustedItemPrice(item);
            }, 0);
            
            miniCartTotalPriceSpan.textContent = `$${totalItemsPrice.toFixed(2)}`;

            toggleModal(miniCartModal, miniCartModalContent, true);

            // Add event listeners for individual remove buttons in the mini-cart
            document.querySelectorAll('#miniCartModal .remove-item-from-minicart-button').forEach(button => {
                button.onclick = (event) => {
                    const itemName = event.currentTarget.dataset.itemName;
                    const itemToRemove = appState.selectedItems.find(item => item.name === itemName);
                    if (itemToRemove) {
                        handleCartAction(itemToRemove, 'remove_all'); // Use remove_all for simplicity here
                        showMiniCartModal(); // Re-render mini-cart to reflect changes
                        showToast(`"${itemName}" eliminado del carrito.`, 'info');
                    }
                };
            });
            lucide.createIcons(); // Re-create icons for new buttons
        }

        /**
         * Hides the mini-cart modal.
         */
        function closeMiniCartModal() {
            const modal = document.getElementById('miniCartModal');
            const modalContent = document.getElementById('miniCartModalContent');
            toggleModal(modal, modalContent, false);
        }

        /**
         * Clears all items from the cart.
         */
        function clearCart() {
            appState.selectedItems = [];
            updateCartSummary();
            saveBookingFormData(); // Save empty cart
            // Re-render current section to update button states if needed
            if (appState.activeSection === 'services') renderServicesSection();
            if (appState.activeSection === 'home') renderHomeSection();
            if (appState.activeSection === 'animatorPackages') renderAnimatorPackagesSection();
            if (appState.activeSection === 'clownPackages') renderClownPackagesSection();
            if (appState.activeSection === 'bubblePackages') renderBubblePackagesSection();
            showToast('Carrito vaciado.', 'info');
        }

        /**
         * Displays the image modal with a specific image.
         * @param {string} imageUrl - The URL of the image to display.
         * @param {string} altText - The alt text for the image.
         */
        function showImageModal(imageUrl, altText) {
            const imageModal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const imageModalContent = document.getElementById('imageModalContent');

            if (modalImage) {
                modalImage.src = imageUrl;
                modalImage.alt = altText;
            }
            toggleModal(imageModal, imageModalContent, true);
        }

        /**
         * Hides the image modal.
         */
        function closeImageModal() {
            const imageModal = document.getElementById('imageModal');
            const imageModalContent = document.getElementById('imageModalContent');
            toggleModal(imageModal, imageModalContent, false, () => {
                const modalImage = document.getElementById('modalImage');
                if (modalImage) modalImage.src = ''; // Clear image source after closing
            });
        }

        /**
         * Displays a toast notification.
         * @param {string} message - The message to display.
         * @param {'success'|'info'|'error'} type - The type of toast (for styling).
         */
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toastNotification');
            if (!toast) return;

            toast.className = 'show';
            toast.classList.add(type);
            
            toast.innerHTML = ''; // Clear previous content

            const iconElement = document.createElement('i');
            iconElement.classList.add('lucide');
            iconElement.setAttribute('data-lucide', type === 'success' ? 'check-circle' : (type === 'error' ? 'x-circle' : 'info'));
            toast.appendChild(iconElement);

            const textNode = document.createTextNode(message);
            toast.appendChild(textNode);

            lucide.createIcons();

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }


        // --- Section Rendering Functions ---

        /**
         * Helper function to generate HTML for package cards.
         * @param {Array<Object>} packagesArray - Array of package data.
         * @param {string} sectionTitle - Title for the section.
         * @param {string} sectionIcon - Lucide icon name for the section title.
         * @param {boolean} includeImage - Whether to include the package image.
         * @returns {string} HTML string for the package section.
         */
        function generatePackageCardsHtml(packagesArray, sectionTitle, sectionIcon, includeImage = true) {
            const cardsHtml = packagesArray.map((pkg, index) => {
                const isSelected = appState.selectedItems.some(item => item.name === pkg.name);
                let buttonText, buttonClassColor;

                if (isSelected) {
                    buttonText = 'Quitar del Carrito <i data-lucide="minus"></i>';
                    buttonClassColor = 'modern-button remove-button'; // Use modern-button and remove-button classes
                } else {
                    // Extract the base color (e.g., 'pink', 'indigo', 'yellow', 'orange', 'green') from pkg.color
                    const baseColorMatch = pkg.color.match(/border-(\w+)-/);
                    const baseColor = baseColorMatch ? baseColorMatch[1] : 'purple'; // Default to purple if not found
                    buttonText = 'Añadir al Carrito <i data-lucide="plus"></i>';
                    buttonClassColor = `modern-button bg-gradient-to-br from-${baseColor}-600 via-${baseColor}-400 to-${baseColor}-700 text-white`;
                }

                let displayPrice = getAdjustedItemPrice({ ...pkg, quantity: 1 });
                let originalPriceHtml = '';
                if (appState.promotedPackages.includes(pkg.name) && Math.abs(displayPrice - pkg.price) > 0.001) {
                    originalPriceHtml = `<span class="line-through text-gray-500 text-2xl">$${pkg.price.toFixed(2)}</span> `;
                }
                // Conditionally include the image
                const packageImageHtml = includeImage && pkg.imageUrl ? `<img src="${pkg.imageUrl}" alt="Imagen de ${pkg.name}" class="w-full h-40 object-cover rounded-t-2xl mb-4 border-b-2 border-gray-300 shadow-sm cursor-pointer service-image" loading="lazy">` : '';

                return `
                    <div class="${pkg.color} modern-card animate-slide-up-fade-in" style="animation-delay: ${index * 100}ms;">
                        ${packageImageHtml}
                        <div class="p-6 sm:p-8 flex flex-col flex-grow">
                            <h4 class="text-xl sm:text-2xl font-bold mb-3 sm:mb-4 ${pkg.color.split(' ').find(cls => cls.startsWith('text-'))}">${pkg.name} <i data-lucide="${pkg.icon}"></i></h4>
                            <p class="text-sm sm:text-base text-gray-700 mb-4 sm:mb-5 flex-grow">${pkg.description}</p>
                            <ul class="list-disc list-inside text-gray-600 mb-4 sm:mb-5 text-sm sm:text-base">
                                ${pkg.services.map(service => `<li>${service}</li>`).join('')}
                            </ul>
                            <p class="text-3xl sm:text-4xl font-extrabold text-pink-600 mb-4 sm:mb-5">
                                ${originalPriceHtml}$${displayPrice.toFixed(2)}
                            </p>
                        </div>
                        <div class="p-6 pt-0">
                            <button data-item-name="${pkg.name}" data-item-price="${pkg.price}" data-action-type="toggle" class="add-remove-button w-full mt-auto ${buttonClassColor}" aria-label="${isSelected ? `Quitar ${pkg.name} del carrito` : `Añadir ${pkg.name} al carrito`}">
                                ${buttonText}
                            </button>
                        </div>
                    </div>`;
            }).join('');

            // Extract border and text color from the first package for the section border/text, or use a default
            const sectionBorderColorClass = packagesArray.length > 0 ? packagesArray[0].color.split(' ').find(cls => cls.startsWith('border-')) : 'border-purple-400';
            const sectionTextColorClass = packagesArray.length > 0 ? packagesArray[0].color.split(' ').find(cls => cls.startsWith('text-')) : 'text-purple-700';

            return `
                <section class="bg-gradient-to-br from-white to-gray-50 rounded-3xl shadow-2xl p-6 sm:p-10 my-12 border-4 ${sectionBorderColorClass} animate-fade-in">
                    <h2 class="text-3xl sm:text-4xl font-extrabold ${sectionTextColorClass} text-center mb-10 sm:mb-12">
                        ${sectionTitle} <i data-lucide="${sectionIcon}"></i>
                    </h2>
                    <p class="text-lg text-gray-700 text-center mb-10">
                        Descubre nuestros planes de <strong>${sectionTitle.toLowerCase()} para eventos infantiles en Panamá</strong>. ¡La opción perfecta para tu celebración!
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 sm:gap-12">
                        ${cardsHtml}
                    </div>
                </section>
            `;
        }

        /**
         * Renders the Home section.
         */
        function renderHomeSection() {
            try {
                const html = `
                    <section class="hero-banner my-12 animate-slide-up-fade-in">
                        <div class="hero-banner-content w-full mx-auto">
                            <h2 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold mb-6 leading-tight text-center drop-shadow-lg">
                                🎉 ¡Hacemos que tu fiesta sea inolvidable! 🎈
                            </h2>
                            <p class="text-lg sm:text-xl lg:text-2xl mb-10 px-4 drop-shadow-md">
                                Animación infantil, shows de burbujas gigantes y más en Panamá. ¡La magia comienza aquí!
                            </p>
                            <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-6 mt-10">
                                <button id="homeExploreServices" class="modern-button bg-gradient-to-br from-pink-600 via-pink-400 to-pink-700">
                                    ¡Explora Nuestros Servicios! <i data-lucide="sparkles"></i>
                                </button>
                                <button id="homeExploreAnimatorPackages" class="modern-button bg-gradient-to-br from-purple-600 via-purple-400 to-purple-700">
                                    ¡Paquetes de Animadores! <i data-lucide="user-check"></i>
                                </button>
                            </div>
                            <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-6 mt-6">
                                <button id="homeExploreClownPackages" class="modern-button bg-gradient-to-br from-orange-600 via-orange-400 to-orange-700">
                                    ¡Paquetes de Payasos! <i data-lucide="clown"></i>
                                </button>
                                <button id="homeExploreBubblePackages" class="modern-button bg-gradient-to-br from-blue-600 via-blue-400 to-blue-700">
                                    ¡Paquetes de Burbujas! <i data-lucide="wind"></i>
                                </button>
                            </div>
                            <div class="flex justify-center mt-6">
                                <button id="homePromoButton" class="modern-button bg-gradient-to-br from-pink-500 via-purple-400 to-purple-600">
                                    <i data-lucide="award"></i> Promoción del Mes <i data-lucide="award"></i>
                                </button>
                            </div>
                        </div>
                    </section>
                `;
                renderSection(html);

                // Assign event listeners to the Home section buttons.
                document.getElementById('homeExploreServices').onclick = () => { setActiveSection('services'); };
                document.getElementById('homeExploreAnimatorPackages').onclick = () => { setActiveSection('animatorPackages'); };
                document.getElementById('homeExploreClownPackages').onclick = () => { setActiveSection('clownPackages'); };
                document.getElementById('homeExploreBubblePackages').onclick = () => { setActiveSection('bubblePackages'); };
                document.getElementById('homePromoButton').onclick = () => {
                    showPromoInfoModal('¡Este mes, disfruta de un 10% de descuento EXCLUSIVO en todos nuestros paquetes de burbujas! 🫧');
                };
                console.log('renderHomeSection: Event listeners para la sección Home asignados.');
            } catch (error) {
                console.error('renderHomeSection: Error al renderizar la sección Home:', error);
            }
        }

        /**
         * Renders the Individual Services section.
         */
        function renderServicesSection() {
            try {
                const repeatableServices = ['Pintacaritas', 'Globoflexia', 'Máquinas de Snack Algodón y Pop Corn'];
                
                const cardsHtml = servicesData.map((service, index) => {
                    // Only include image if imageUrl exists for the service
                    const serviceImageHtml = service.imageUrl ? `<img src="${service.imageUrl}" alt="Imagen de ${service.name}" class="w-full h-40 object-cover rounded-t-2xl mb-4 border-b-2 border-gray-300 shadow-sm cursor-pointer service-image" loading="lazy">` : '';

                    // Extract base color from service.color for button styling
                    const baseColorMatch = service.color.match(/border-(\w+)-/);
                    const baseColor = baseColorMatch ? baseColorMatch[1] : 'purple';

                    if (service.type === 'character_selection') {
                        const selectedCharacterItems = appState.selectedItems.filter(item => item.name.startsWith(service.name + ':'));
                        const optionsHtml = service.characters.map(char => {
                            const fullCharName = `${service.name}: ${char.name}`;
                            const isCharacterAlreadyAdded = selectedCharacterItems.some(item => item.name === fullCharName);
                            return `<option value="${char.id}" ${isCharacterAlreadyAdded ? 'disabled' : ''}>${char.name} ${isCharacterAlreadyAdded ? '(Añadido)' : ''}</option>`;
                        }).join('');
                        return `
                            <div class="${service.color} modern-card animate-slide-up-fade-in" style="animation-delay: ${index * 100}ms;">
                                ${serviceImageHtml}
                                <div class="p-6 sm:p-8 flex flex-col flex-grow">
                                    <h2 class="text-xl sm:text-2xl font-bold mb-3 sm:mb-4 text-indigo-700">${service.name} <i data-lucide="user-round-plus"></i></h2>
                                    <p class="text-sm sm:text-base text-gray-700 mb-4 sm:mb-5">${service.description}</p>
                                    <p class="text-3xl sm:text-4xl font-extrabold text-pink-600 mb-4 sm:mb-5">$${service.price.toFixed(2)}</p>
                                    <div class="mb-4">
                                        <label for="characterSelect-${service.id}" class="block text-gray-700 font-bold mb-2">Elige tu personaje:</label>
                                        <select id="characterSelect-${service.id}" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500 text-sm sm:text-base cursor-pointer transition duration-150 ease-in-out" aria-label="Selecciona un personaje temático">
                                            <option value="">Selecciona un personaje</option>
                                            ${optionsHtml}
                                        </select>
                                    </div>
                                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mt-auto">
                                        <button data-service-id="${service.id}" data-action="add_character" class="character-action-button flex-grow modern-button bg-gradient-to-br from-${baseColor}-600 via-${baseColor}-400 to-${baseColor}-700 disabled:opacity-50 disabled:cursor-not-allowed" aria-label="Añadir personaje seleccionado">
                                            Añadir Seleccionado <i data-lucide="plus"></i>
                                        </button>
                                    </div>
                                    <div id="selectedCharactersList-${service.id}" class="mt-4">
                                        ${selectedCharacterItems.length > 0 ? `<p class="font-semibold text-gray-700 mb-2">Personajes en tu carrito:</p>` : ''}
                                        ${selectedCharacterItems.map(item => `
                                            <div class="flex justify-between items-center bg-purple-100 p-2 rounded-lg mb-2 shadow-sm border border-purple-200">
                                                <span>${item.name.replace(service.name + ': ', '')} (x${item.quantity})</span>
                                                <button class="remove-specific-character-button text-red-500 hover:text-red-700 font-bold ml-2 transition duration-200 cursor-pointer" data-full-name="${item.name}" aria-label="Quitar ${item.name}"><i data-lucide="trash-2"></i></button>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>`;
                    } else if (service.type === 'theme_selection') {
                        const selectedThemeItems = appState.selectedItems.filter(item => item.name.startsWith(service.name + ':'));
                        let themeOptionsHtml = '<option value="">Selecciona una temática</option><optgroup label="Niña">';
                        service.themes.ninas.forEach(theme => {
                            const fullThemeName = `${service.name}: ${theme}`;
                            const isThemeAlreadyAdded = selectedThemeItems.some(item => item.name === fullThemeName);
                            themeOptionsHtml += `<option value="${theme}" ${isThemeAlreadyAdded ? 'disabled' : ''}>${theme} ${isThemeAlreadyAdded ? '(Añadida)' : ''}</option>`;
                        });
                        themeOptionsHtml += '</optgroup><optgroup label="Niño">';
                        service.themes.ninos.forEach(theme => {
                            const fullThemeName = `${service.name}: ${theme}`;
                            const isThemeAlreadyAdded = selectedThemeItems.some(item => item.name === fullThemeName);
                            themeOptionsHtml += `<option value="${theme}" ${isThemeAlreadyAdded ? 'disabled' : ''}>${theme} ${isThemeAlreadyAdded ? '(Añadida)' : ''}</option>`;
                        });
                        themeOptionsHtml += '</optgroup>';
                        return `
                            <div class="${service.color} modern-card animate-slide-up-fade-in" style="animation-delay: ${index * 100}ms;">
                                ${serviceImageHtml}
                                <div class="p-6 sm:p-8 flex flex-col flex-grow">
                                    <h2 class="text-xl sm:text-2xl font-bold mb-3 sm:mb-4 text-pink-700">${service.name} <i data-lucide="palette"></i></h2>
                                    <p class="text-sm sm:text-base text-gray-700 mb-4 sm:mb-5">${service.description}</p>
                                    <p class="text-3xl sm:text-4xl font-extrabold text-pink-600 mb-4 sm:mb-5">$${service.price.toFixed(2)}</p>
                                    <div class="mb-4">
                                        <label for="themeSelect-${service.id}" class="block text-gray-700 font-bold mb-2">Elige tu temática:</label>
                                        <select id="themeSelect-${service.id}" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500 text-sm sm:text-base cursor-pointer transition duration-150 ease-in-out" aria-label="Selecciona una temática de decoración">${themeOptionsHtml}</select>
                                    </div>
                                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mt-auto">
                                        <button data-service-id="${service.id}" data-action="add_theme" class="theme-action-button flex-grow modern-button bg-gradient-to-br from-${baseColor}-600 via-${baseColor}-400 to-${baseColor}-700 disabled:opacity-50 disabled:cursor-not-allowed" aria-label="Añadir temática seleccionada">
                                            Añadir Seleccionado <i data-lucide="plus"></i>
                                        </button>
                                    </div>
                                    <div id="selectedThemesList-${service.id}" class="mt-4">
                                        ${selectedThemeItems.length > 0 ? `<p class="font-semibold text-gray-700 mb-2">Temáticas en tu carrito:</p>` : ''}
                                        ${selectedThemeItems.map(item => `
                                            <div class="flex justify-between items-center bg-pink-100 p-2 rounded-lg mb-2 shadow-sm border border-pink-200">
                                                <span>${item.name.replace(service.name + ': ', '')} (x${item.quantity})</span>
                                                <button class="remove-specific-theme-button text-red-500 hover:text-red-700 font-bold ml-2 transition duration-200 cursor-pointer" data-full-name="${item.name}" aria-label="Quitar ${item.name}"><i data-lucide="trash-2"></i></button>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>`;
                    } else if (service.type === 'manualidades_workshop') {
                        const selectedItemInCart = appState.selectedItems.find(selected => selected.name === service.name);
                        // If the item is in the cart, use its quantity, otherwise default to 10.
                        const currentQuantity = selectedItemInCart ? selectedItemInCart.quantity : 10; 
                        return `
                            <div class="${service.color} modern-card animate-slide-up-fade-in" style="animation-delay: ${index * 100}ms;">
                                ${serviceImageHtml}
                                <div class="p-6 sm:p-8 flex flex-col flex-grow">
                                    <h2 class="text-xl sm:text-2xl font-bold mb-3 sm:mb-4 text-yellow-700">${service.name} <i data-lucide="scissors"></i></h2>
                                    <p class="text-sm sm:text-base text-gray-700 mb-4 sm:mb-5">${service.description}</p>
                                    <p class="text-3xl sm:text-4xl font-extrabold text-pink-600 mb-4 sm:mb-5">$${service.price.toFixed(2)} <span class="text-lg text-gray-600">/ niño</span></p>
                                    <div class="mb-4">
                                        <label for="manualidadesQuantity-${service.id}" class="block text-gray-700 font-bold mb-2">Cantidad de Niños (Mín. 10):</label>
                                        <input type="number" id="manualidadesQuantity-${service.id}" name="manualidadesQuantity-${service.id}" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500 text-sm sm:text-base transition duration-150 ease-in-out" value="${currentQuantity}" min="10" aria-describedby="manualidadesQuantityError-${service.id}"/>
                                        <span id="manualidadesQuantityError-${service.id}" class="error-message hidden"></span>
                                    </div>
                                    <p class="text-lg font-semibold text-gray-700">Subtotal: <span id="manualidadesSubtotal-${service.id}">$${(service.price * currentQuantity).toFixed(2)}</span></p>
                                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mt-auto">
                                        <button data-service-id="${service.id}" data-service-name="${service.name}" data-service-price="${service.price}" class="update-manualidades-quantity-button flex-grow modern-button bg-gradient-to-br from-${baseColor}-600 via-${baseColor}-400 to-${baseColor}-700" aria-label="Actualizar cantidad de niños para el taller de manualidades">
                                            Actualizar Cantidad <i data-lucide="refresh-cw"></i>
                                        </button>
                                        ${selectedItemInCart ? `
                                        <button data-service-id="${service.id}" data-service-name="${service.name}" data-action-type="remove_all" class="add-remove-button flex-grow modern-button remove-button" aria-label="Quitar taller de manualidades del carrito">
                                            Quitar Taller <i data-lucide="trash-2"></i>
                                        </button>` : ''}
                                    </div>
                                </div>
                            </div>`;
                    } else {
                        const isRepeatableService = repeatableServices.includes(service.name);
                        const selectedItemInCart = appState.selectedItems.find(selected => selected.name === service.name);
                        const currentQuantity = selectedItemInCart ? selectedItemInCart.quantity : 0;
                        
                        let displayPriceHtml;
                        if (service.name === 'Pintacaritas') {
                            displayPriceHtml = `<p class="text-3xl sm:text-4xl font-extrabold text-pink-600 mb-4 sm:mb-5">
                                $${service.price.toFixed(2)} <span class="text-lg text-gray-600">x 1 Hora</span><br>
                                <span class="text-xl text-gray-700">Horas adicionales: $40</span>
                            </p>`;
                        } else {
                            let displayPriceForCard = service.price;
                            let originalPriceHtmlForCard = '';
                            if (appState.promotedPackages.includes(service.name)) {
                                originalPriceHtmlForCard = `<span class="line-through text-gray-500 text-2xl">$${service.price.toFixed(2)}</span> `;
                                displayPriceForCard = service.price * 0.90;
                            }
                            displayPriceHtml = `<p class="text-3xl sm:text-4xl font-extrabold text-pink-600 mb-4 sm:mb-5">
                                ${originalPriceHtmlForCard}$${displayPriceForCard.toFixed(2)}
                            </p>`;
                        }

                        let buttonsHtml;
                        if (isRepeatableService) {
                            buttonsHtml = `
                                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mt-auto p-6 pt-0">
                                    <button data-item-name="${service.name}" data-item-price="${service.price}" data-action-type="add" class="add-remove-button flex-grow modern-button bg-gradient-to-br from-${baseColor}-600 via-${baseColor}-400 to-${baseColor}-700" aria-label="Añadir ${service.name} al carrito">
                                        Añadir <i data-lucide="plus"></i> ${currentQuantity > 0 ? `(x${currentQuantity})` : ''}
                                    </button>
                                    ${currentQuantity > 0 ? `
                                    <button data-item-name="${service.name}" data-item-price="${service.price}" data-action-type="remove_all" class="add-remove-button flex-grow modern-button remove-button" aria-label="Quitar todas las unidades de ${service.name} del carrito">
                                        Quitar Todo <i data-lucide="trash-2"></i>
                                    </button>` : ''}
                                </div>`;
                        } else {
                            const isSelected = !!selectedItemInCart;
                            const buttonClassColor = isSelected ? 'modern-button remove-button' : `modern-button bg-gradient-to-br from-${baseColor}-600 via-${baseColor}-400 to-${baseColor}-700`;
                            buttonsHtml = `
                                <div class="p-6 pt-0">
                                    <button data-item-name="${service.name}" data-item-price="${service.price}" data-action-type="toggle" class="add-remove-button w-full mt-auto ${buttonClassColor}" aria-label="${isSelected ? `Quitar ${service.name} del carrito` : `Añadir ${service.name} al carrito`}">
                                        ${isSelected ? 'Quitar del Carrito <i data-lucide="minus"></i>' : 'Añadir al Carrito <i data-lucide="plus"></i>'}
                                    </button>
                                </div>`;
                        }

                        return `
                            <div class="${service.color} modern-card animate-slide-up-fade-in" style="animation-delay: ${index * 100}ms;">
                                ${serviceImageHtml}
                                <div class="p-6 sm:p-8 flex flex-col flex-grow">
                                    <h2 class="text-xl sm:text-2xl font-bold mb-3 sm:mb-4 ${service.color.split(' ').find(cls => cls.startsWith('text-'))}">${service.name} <i data-lucide="${service.icon}"></i></h2>
                                    <p class="text-sm sm:text-base text-gray-700 mb-4 sm:mb-5 flex-grow">${service.description}</p>
                                    ${displayPriceHtml}
                                </div>
                                ${buttonsHtml}
                            </div>`;
                    }
                }).join('');

                const sectionBorderColorClass = servicesData.length > 0 ? servicesData[0].color.split(' ').find(cls => cls.startsWith('border-')) : 'border-purple-400';
                const sectionTextColorClass = servicesData.length > 0 ? servicesData[0].color.split(' ').find(cls => cls.startsWith('text-')) : 'text-purple-700';

                const html = `
                    <section class="bg-gradient-to-br from-white to-gray-50 rounded-3xl shadow-2xl p-6 sm:p-10 my-12 border-4 ${sectionBorderColorClass} animate-fade-in">
                        <h2 class="text-3xl sm:text-4xl font-extrabold ${sectionTextColorClass} text-center mb-10 sm:mb-12">Nuestros Servicios <i data-lucide="sparkles"></i></h2>
                        <p class="text-lg text-gray-700 text-center mb-10">
                            Servicios de animación para fiestas infantiles en Panamá. ¡Hacemos tu evento mágico e inolvidable!
                        </p>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 sm:gap-12">
                            ${cardsHtml}
                        </div>
                    </section>
                `;
                renderSection(html);

                // Assign event listeners
                document.querySelectorAll('#mainContent .add-remove-button').forEach(button => {
                    button.onclick = () => {
                        const itemName = button.dataset.itemName;
                        const itemPrice = parseFloat(button.dataset.itemPrice);
                        const actionType = button.dataset.actionType;
                        handleCartAction({ name: itemName, price: itemPrice }, actionType);
                    };
                });
                document.querySelectorAll('#mainContent .character-action-button').forEach(button => {
                    button.onclick = () => {
                        const serviceId = button.dataset.serviceId;
                        const selectElement = document.getElementById(`characterSelect-${serviceId}`);
                        const selectedCharacterId = selectElement.value;
                        if (selectedCharacterId) {
                            const characterService = servicesData.find(s => s.id === serviceId);
                            const selectedChar = characterService.characters.find(c => c.id === selectedCharacterId);
                            if (selectedChar) {
                                updateCharacterInCart(characterService, selectedChar, 'add');
                                selectElement.value = ""; // Clear selection after adding
                            }
                        } else {
                            showInfoModal('Por favor, selecciona un personaje antes de añadirlo.');
                        }
                    };
                });
                document.querySelectorAll('#mainContent .remove-specific-character-button').forEach(button => {
                    button.onclick = () => {
                        const fullCharacterName = button.dataset.fullName;
                        const characterService = servicesData.find(s => s.type === 'character_selection');
                        const charNameOnly = fullCharacterName.replace(characterService.name + ': ', '');
                        const characterToRemove = characterService.characters.find(c => c.name === charNameOnly); // Corrected to use name for lookup
                        if (characterService && characterToRemove) {
                            updateCharacterInCart(characterService, characterToRemove, 'remove_all');
                        }
                    };
                });
                document.querySelectorAll('#mainContent select[id^="characterSelect-"]').forEach(select => {
                    select.onchange = () => {
                        const serviceId = select.id.split('-')[1];
                        const selectedCharacterId = select.value;
                        const addButton = document.querySelector(`.character-action-button[data-service-id="${serviceId}"]`);
                        if (selectedCharacterId) {
                            const characterService = servicesData.find(s => s.id === serviceId);
                            const selectedChar = characterService.characters.find(c => c.id === selectedCharacterId);
                            const fullCharName = `${characterService.name}: ${selectedChar.name}`;
                            const existingInCart = appState.selectedItems.find(item => item.name === fullCharName);
                            if (existingInCart) {
                                addButton.innerHTML = `Añadir uno más de ${selectedChar.name} <i data-lucide="plus"></i> (x${existingInCart.quantity + 1})`;
                            } else {
                                addButton.innerHTML = `Añadir ${selectedChar.name} al Carrito <i data-lucide="plus"></i>`;
                            }
                            addButton.disabled = false;
                        } else {
                            addButton.innerHTML = `Añadir Seleccionado <i data-lucide="plus"></i>`;
                            addButton.disabled = true;
                        }
                        lucide.createIcons();
                    };
                });
                document.querySelectorAll('#mainContent .theme-action-button').forEach(button => {
                    button.onclick = () => {
                        const serviceId = button.dataset.serviceId;
                        const selectElement = document.getElementById(`themeSelect-${serviceId}`);
                        const selectedThemeName = selectElement.value;
                        if (selectedThemeName) {
                            const themeService = servicesData.find(s => s.id === serviceId);
                            updateThemeInCart(themeService, selectedThemeName, 'add');
                            selectElement.value = ""; // Clear selection after adding
                        } else {
                            showInfoModal('Por favor, selecciona una temática antes de añadirla.');
                        }
                    };
                });
                document.querySelectorAll('#mainContent .remove-specific-theme-button').forEach(button => {
                    button.onclick = () => {
                        const fullThemeName = button.dataset.fullName;
                        const themeService = servicesData.find(s => s.type === 'theme_selection');
                        const themeNameOnly = fullThemeName.replace(themeService.name + ': ', '');
                        updateThemeInCart(themeService, themeNameOnly, 'remove_all');
                    };
                });
                document.querySelectorAll('#mainContent select[id^="themeSelect-"]').forEach(select => {
                    select.onchange = () => {
                        const serviceId = select.id.split('-')[1];
                        const selectedThemeName = select.value;
                        const addButton = document.querySelector(`.theme-action-button[data-service-id="${serviceId}"]`);
                        if (selectedThemeName) {
                            const themeService = servicesData.find(s => s.id === serviceId);
                            const fullThemeName = `${themeService.name}: ${selectedThemeName}`;
                            const existingInCart = appState.selectedItems.find(item => item.name === fullThemeName);
                            if (existingInCart) {
                                addButton.innerHTML = `Añadir una más de ${selectedThemeName} <i data-lucide="plus"></i> (x${existingInCart.quantity + 1})`;
                            } else {
                                addButton.innerHTML = `Añadir ${selectedThemeName} al Carrito <i data-lucide="plus"></i>`;
                            }
                            addButton.disabled = false;
                        } else {
                            addButton.innerHTML = `Añadir Seleccionado <i data-lucide="plus"></i>`;
                            addButton.disabled = true;
                        }
                        lucide.createIcons();
                    };
                });
                document.querySelectorAll('#mainContent .update-manualidades-quantity-button').forEach(button => {
                    button.onclick = () => {
                        const serviceId = button.dataset.serviceId;
                        const serviceName = button.dataset.serviceName;
                        const servicePrice = parseFloat(button.dataset.servicePrice);
                        const quantityInput = document.getElementById(`manualidadesQuantity-${serviceId}`);
                        const errorSpan = document.getElementById(`manualidadesQuantityError-${serviceId}`);
                        let quantity = parseInt(quantityInput.value, 10);

                        if (isNaN(quantity) || quantity < 10) {
                            errorSpan.textContent = 'La cantidad mínima es 10 niños.';
                            errorSpan.classList.remove('hidden');
                            quantityInput.classList.add('input-error');
                            showInfoModal('La cantidad mínima para el Mini Taller de Manualidades es 10 niños.');
                            quantityInput.value = 10; // Reset to minimum
                            quantity = 10; // Use minimum for calculation
                        } else {
                            errorSpan.classList.add('hidden');
                            quantityInput.classList.remove('input-error');
                        }
                        handleCartAction({ id: serviceId, name: serviceName, price: servicePrice }, 'set_quantity', quantity);
                    };
                });
                document.querySelectorAll('#mainContent input[id^="manualidadesQuantity-"]').forEach(input => {
                    input.oninput = () => {
                        const serviceId = input.id.split('-')[1];
                        const service = servicesData.find(s => s.id === serviceId);
                        if (!service) return;
                        const servicePrice = service.price;
                        const quantity = parseInt(input.value, 10);
                        const subtotalSpan = document.getElementById(`manualidadesSubtotal-${service.id}`);
                        const errorSpan = document.getElementById(`manualidadesQuantityError-${service.id}`);

                        if (isNaN(quantity) || quantity < 10) {
                            errorSpan.textContent = 'Mínimo 10 niños.';
                            errorSpan.classList.remove('hidden');
                            input.classList.add('input-error');
                            if (subtotalSpan) subtotalSpan.textContent = `$${(servicePrice * 10).toFixed(2)}`; // Show subtotal for 10
                        } else {
                            errorSpan.classList.add('hidden');
                            input.classList.remove('input-error');
                            if (subtotalSpan) subtotalSpan.textContent = `$${(servicePrice * quantity).toFixed(2)}`;
                        }
                    };
                });
                document.querySelectorAll('.service-image').forEach(img => {
                    img.onclick = (event) => {
                        showImageModal(event.target.src, event.target.alt);
                    };
                });
                console.log('renderServicesSection: Event listeners para la sección Servicios asignados.');
            } catch (error) {
                console.error('renderServicesSection: Error al renderizar la sección Servicios:', error);
            }
        }

        /**
         * Renders the Animator Packages section.
         */
        function renderAnimatorPackagesSection() {
            try {
                // Pass includeImage = false to hide images for this section
                const html = generatePackageCardsHtml(animatorPackagesData, 'Paquetes de Animadores', 'user-check', false);
                renderSection(html);

                document.querySelectorAll('#mainContent .add-remove-button').forEach(button => {
                    button.onclick = () => {
                        const itemName = button.dataset.itemName;
                        const itemPrice = parseFloat(button.dataset.itemPrice);
                        const actionType = button.dataset.actionType;
                        handleCartAction({ name: itemName, price: itemPrice }, actionType);
                    };
                });
                // No image click listener needed as images are removed
                console.log('renderAnimatorPackagesSection: Event listeners para la sección Paquetes de Animadores asignados.');
            } catch (error) {
                console.error('renderAnimatorPackagesSection: Error al renderizar la sección Paquetes de Animadores:', error);
            }
        }

        /**
         * Renders the Clown Packages section.
         */
        function renderClownPackagesSection() {
            try {
                // Pass includeImage = false to hide images for this section
                const html = generatePackageCardsHtml(clownPackagesData, 'Paquetes de Payasos', 'clown', false);
                renderSection(html);

                document.querySelectorAll('#mainContent .add-remove-button').forEach(button => {
                    button.onclick = () => {
                        const itemName = button.dataset.itemName;
                        const itemPrice = parseFloat(button.dataset.itemPrice);
                        const actionType = button.dataset.actionType;
                        handleCartAction({ name: itemName, price: itemPrice }, actionType);
                    };
                });
                // No image click listener needed as images are removed
                console.log('renderClownPackagesSection: Event listeners para la sección Paquetes de Payasos asignados.');
            } catch (error) {
                console.error('renderClownPackagesSection: Error al renderizar la sección Paquetes de Payasos:', error);
            }
        }


        /**
         * Renders the Bubble Packages section.
         */
        function renderBubblePackagesSection() {
            try {
                const cardsHtml = bubblePackagesData.map((pkg, index) => {
                    const isSelected = appState.selectedItems.some(item => item.name === pkg.name);
                    let buttonText, buttonClassColor;

                    if (isSelected) {
                        buttonText = 'Quitar del Carrito <i data-lucide="minus"></i>';
                        buttonClassColor = 'modern-button remove-button';
                    } else {
                        // Extract the base color (e.g., 'blue') from pkg.color
                        const baseColorMatch = pkg.color.match(/border-(\w+)-/);
                        const baseColor = baseColorMatch ? baseColorMatch[1] : 'blue'; // Default to blue
                        buttonText = 'Añadir al Carrito <i data-lucide="plus"></i>';
                        buttonClassColor = `modern-button bg-gradient-to-br from-${baseColor}-600 via-${baseColor}-400 to-${baseColor}-700 text-white`;
                    }

                    let displayPrice = getAdjustedItemPrice({ ...pkg, quantity: 1 });
                    let originalPriceHtml = '';
                    if (appState.promotedPackages.includes(pkg.name) && Math.abs(displayPrice - pkg.price) > 0.001) {
                        originalPriceHtml = `<span class="line-through text-gray-500 text-2xl">$${pkg.price.toFixed(2)}</span> `;
                    }
                    const bubblePackageImageHtml = pkg.imageUrl ? `<img src="${pkg.imageUrl}" alt="Imagen de ${pkg.name}" class="w-full h-40 object-cover rounded-t-2xl mb-4 border-b-2 border-gray-300 shadow-sm cursor-pointer service-image" loading="lazy">` : '';

                    return `
                        <div class="${pkg.color} modern-card animate-slide-up-fade-in" style="animation-delay: ${index * 100}ms;">
                            ${bubblePackageImageHtml}
                            <div class="p-6 sm:p-8 flex flex-col flex-grow">
                                <h2 class="text-xl sm:text-2xl font-bold mb-3 sm:mb-4 ${pkg.color.split(' ').find(cls => cls.startsWith('text-'))}">${pkg.name} <i data-lucide="${pkg.icon}"></i></h2>
                                <p class="text-sm sm:text-base text-gray-700 mb-4 sm:mb-5 flex-grow">${pkg.description}</p>
                                <ul class="list-disc list-inside text-gray-600 mb-4 sm:mb-5 text-sm sm:text-base">
                                    ${pkg.services.map(service => `<li>${service}</li>`).join('')}
                               </ul>
                                <p class="text-3xl sm:text-4xl font-extrabold text-pink-600 mb-4 sm:mb-5">
                                    ${originalPriceHtml}$${displayPrice.toFixed(2)}
                                </p>
                            </div>
                            <div class="p-6 pt-0">
                                <button data-item-name="${pkg.name}" data-item-price="${pkg.price}" data-action-type="toggle" class="add-remove-button w-full mt-auto ${buttonClassColor}" aria-label="${isSelected ? `Quitar ${pkg.name} del carrito` : `Añadir ${pkg.name} al carrito`}">
                                    ${buttonText}
                                </button>
                            </div>
                        </div>`;
                }).join('');

                const sectionBorderColorClass = bubblePackagesData.length > 0 ? bubblePackagesData[0].color.split(' ').find(cls => cls.startsWith('border-')) : 'border-blue-400';
                const sectionTextColorClass = bubblePackagesData.length > 0 ? bubblePackagesData[0].color.split(' ').find(cls => cls.startsWith('text-')) : 'text-blue-700';

                const html = `
                    <section class="bg-gradient-to-br from-white to-gray-50 rounded-3xl shadow-2xl p-6 sm:p-10 my-12 border-4 ${sectionBorderColorClass} animate-fade-in">
                        <h2 class="text-3xl sm:text-4xl font-extrabold ${sectionTextColorClass} text-center mb-10 sm:mb-12">Nuestros Paquetes de Burbujas <i data-lucide="wind"></i></h2>
                        <p class="text-lg text-gray-700 text-center mb-10">
                            ¡Sumérgete en la diversión con nuestros increíbles paquetes de shows de burbujas gigantes en Panamá!
                        </p>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 sm:gap-12">
                            ${cardsHtml}
                        </div>
                    </section>`;
                renderSection(html);

                document.querySelectorAll('#mainContent .add-remove-button').forEach(button => {
                    button.onclick = () => {
                        const itemName = button.dataset.itemName;
                        const itemPrice = parseFloat(button.dataset.itemPrice);
                        const actionType = button.dataset.actionType;
                        handleCartAction({ name: itemName, price: itemPrice }, actionType);
                    };
                });
                document.querySelectorAll('.service-image').forEach(img => {
                    img.onclick = (event) => {
                        showImageModal(event.target.src, event.target.alt);
                    };
                });
                console.log('renderBubblePackagesSection: Event listeners para la sección Burbujas asignados.');
            } catch (error) {
                console.error('renderBubblePackagesSection: Error al renderizar la sección Burbujas:', error);
            }
        }

        /**
         * Renders the Company References section.
         */
        function renderCompanyReferencesSection() {
            try {
                const cardsHtml = companyReferencesData.map((company, index) => `
                    <div class="bg-white modern-card flex flex-col items-center justify-center p-6 border-gray-200 animate-slide-up-fade-in" style="animation-delay: ${index * 100}ms;">
                        <img src="${company.imageUrl}" alt="Logo de ${company.name}" class="w-full h-32 object-cover rounded-xl mb-4 border-b-2 border-gray-300 shadow-sm cursor-pointer service-image" loading="lazy">
                        <h3 class="text-lg sm:text-xl font-bold text-gray-800 text-center">${company.name}</h3>
                    </div>
                `).join('');

                const html = `
                    <section class="bg-gradient-to-br from-white to-gray-50 rounded-3xl shadow-2xl p-6 sm:p-10 my-12 border-4 border-green-400 animate-fade-in">
                        <h2 class="text-3xl sm:text-4xl font-extrabold text-green-700 text-center mb-10 sm:mb-12">Nuestros Clientes Corporativos <i data-lucide="building"></i></h2>
                        <p class="text-lg text-gray-700 text-center mb-10">
                            Hemos llevado la magia de las burbujas gigantes a eventos de grandes empresas y organizaciones en Panamá. ¡Confía en nuestra experiencia!
                        </p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-8 sm:gap-12">
                            ${cardsHtml}
                        </div>
                    </section>
                `;
                // Use insertAdjacentHTML to add this section *after* the bubble packages, not replace mainContent
                document.getElementById('mainContent').insertAdjacentHTML('beforeend', html);
                document.querySelectorAll('#mainContent .service-image').forEach(img => {
                    img.onclick = (event) => {
                        showImageModal(event.target.src, event.target.alt);
                    };
                });
                console.log('renderCompanyReferencesSection: Sección Clientes Corporativos añadida.');
            } catch (error) {
                console.error('renderCompanyReferencesSection: Error al renderizar la sección Clientes Corporativos:', error);
            }
        }

        /**
         * Renders the Testimonials section.
         */
        function renderTestimonialsSection() {
            try {
                const testimonialsHtml = testimonialsData.map((testimonial, index) => `
                    <div class="bg-white modern-card p-6 sm:p-8 flex flex-col items-center text-center border-pink-200 animate-slide-up-fade-in" style="animation-delay: ${index * 100}ms;">
                        <img src="${testimonial.imageUrl}" alt="Foto de ${testimonial.name}" class="w-24 h-24 rounded-full object-cover mb-4 border-4 border-pink-400 shadow-md" loading="lazy">
                        <p class="text-gray-700 text-base sm:text-lg italic mb-4">"${testimonial.review}"</p>
                        <p class="font-bold text-purple-700 text-lg">${testimonial.name}</p>
                        <p class="text-gray-500 text-sm">${testimonial.role}</p>
                    </div>
                `).join('');

                const html = `
                    <section class="bg-gradient-to-br from-white to-gray-50 rounded-3xl shadow-2xl p-6 sm:p-10 my-12 border-4 border-pink-400 animate-fade-in">
                        <h2 class="text-3xl sm:text-4xl font-extrabold text-purple-700 text-center mb-10 sm:mb-12">Lo Que Dicen Nuestros Clientes <i data-lucide="message-square"></i></h2>
                        <p class="text-lg text-gray-700 text-center mb-10">
                            La felicidad de nuestros clientes es nuestra mayor recompensa. Lee sus experiencias con Diverty Eventos.
                        </p>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 sm:gap-12">
                            ${testimonialsHtml}
                        </div>
                    </section>
                `;
                renderSection(html);
                console.log('renderTestimonialsSection: Sección Testimonios añadida.');
            } catch (error) {
                console.error('renderTestimonialsSection: Error al renderizar la sección Testimonios:', error);
            }
        }

        /**
         * Renders the Gallery section.
         */
        function renderGallerySection() {
            try {
                const galleryImagesHtml = galleryData.map((image, index) => `
                    <div class="relative group rounded-xl overflow-hidden shadow-lg border-2 border-gray-200 transition duration-300 hover:scale-[1.02] hover:shadow-xl animate-slide-up-fade-in" style="animation-delay: ${index * 100}ms;">
                        <img src="${image.imageUrl}" alt="${image.alt}" class="w-full h-48 object-cover transition duration-300 group-hover:opacity-80 cursor-pointer gallery-image" loading="lazy">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-4">
                            <p class="text-white text-sm font-semibold">${image.alt}</p>
                        </div>
                    </div>
                `).join('');

                const html = `
                    <section class="bg-gradient-to-br from-white to-gray-50 rounded-3xl shadow-2xl p-6 sm:p-10 my-12 border-4 border-blue-400 animate-fade-in">
                        <h2 class="text-3xl sm:text-4xl font-extrabold text-purple-700 text-center mb-10 sm:mb-12">Nuestra Galería de Momentos Mágicos <i data-lucide="image"></i></h2>
                        <p class="text-lg text-gray-700 text-center mb-10">
                            Explora la alegría y la diversión de nuestros eventos. ¡Capturamos sonrisas inolvidables!
                        </p>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 sm:gap-8">
                            ${galleryImagesHtml}
                        </div>
                        <div class="text-center mt-10">
                            <a href="https://www.instagram.com/diverty_eventos_pty?igsh=MWI3bmt4cTVmdXZreg==" target="_blank" class="inline-flex items-center bg-gradient-to-br from-pink-600 via-pink-400 to-pink-700 hover:from-pink-700 hover:to-pink-800 text-white font-bold py-3 px-8 rounded-full shadow-xl text-base sm:text-lg transition duration-300 transform hover:scale-105 border-2 border-white cursor-pointer" aria-label="Ver más fotos en Instagram">
                                <i data-lucide="instagram"></i> Ver más en Instagram
                            </a>
                        </div>
                    </section>
                `;
                renderSection(html);
                document.querySelectorAll('.gallery-image').forEach(img => {
                    img.onclick = (event) => {
                        showImageModal(event.target.src, event.target.alt);
                    };
                });
                console.log('renderGallerySection: Sección Galería añadida.');
            } catch (error) {
                console.error('renderGallerySection: Error al renderizar la sección Galería:', error);
            }
        }


        /**
         * Renders the Booking section, displaying selected items and the form.
         */
        function renderBookingSection() {
            try {
                const selectedItemsListHtml = appState.selectedItems.length === 0
                    ? `<p class="text-red-600 text-sm sm:text-base text-center">No has seleccionado ningún servicio. Por favor, vuelve a la sección de Servicios o Paquetes.</p>`
                    : `<div class="space-y-3">
                        ${appState.selectedItems.map((item) => {
                            const itemTotalForJotForm = getAdjustedItemPrice(item);
                            const itemImageUrl = getItemImageUrl(item.name); // Get image URL for the item
                            let strikethroughHtml = '';
                            if (item.name === 'Pintacaritas' && item.quantity > 1) {
                                strikethroughHtml = `<span class="line-through text-gray-500 text-xs">$${item.price.toFixed(2)}</span> `;
                            } else if (item.name !== 'Pintacaritas' && appState.promotedPackages.includes(item.name)) {
                                strikethroughHtml = `<span class="line-through text-gray-500 text-xs">$${item.price.toFixed(2)}</span> `;
                            }
                            return `
                                <div class="flex items-center justify-between bg-white p-3 rounded-lg shadow-sm border border-gray-200">
                                    <div class="flex items-center flex-grow min-w-0">
                                        <img src="${itemImageUrl}" alt="Imagen de ${item.name}" class="w-12 h-12 object-cover rounded-md mr-3" loading="lazy">
                                        <span class="font-semibold text-gray-800 text-sm sm:text-base">${item.name} ${item.quantity > 0 ? `(x${item.quantity})` : ''}</span>
                                    </div>
                                    <div class="flex items-center flex-shrink-0 ml-4">
                                        ${strikethroughHtml}
                                        <span class="font-bold text-pink-600 text-lg sm:text-xl whitespace-nowrap">$${itemTotalForJotForm.toFixed(2)}</span>
                                    </div>
                                </div>`;
                        }).join('')}
                    </div>`;

                const currentTransportFee = transportFeesByLocation[appState.selectedLocation] || 0;
                const transportFeeDisplayHtml = currentTransportFee > 0
                    ? `<p class="text-lg font-bold text-gray-700 mt-4">Recargo por Transporte (${appState.selectedLocation}): <span class="text-orange-600">$${currentTransportFee.toFixed(2)}</span></p>`
                    : `<p class="text-lg font-bold text-gray-700 mt-4">Recargo por Transporte: <span class="text-green-600">¡Gratis en Panamá Centro!</span></p>`;

                const totalItemsPrice = appState.selectedItems.reduce((sum, item) => sum + getAdjustedItemPrice(item), 0);
                const finalTotalPrice = totalItemsPrice + currentTransportFee;

                const html = `
                    <section class="bg-gradient-to-br from-white to-gray-50 rounded-3xl shadow-2xl p-6 sm:p-10 my-12 border-4 border-purple-400 animate-fade-in">
                        <h2 class="text-3xl sm:text-4xl font-extrabold text-purple-700 text-center mb-10 sm:mb-12">Reserva tu Evento <i data-lucide="calendar-check"></i></h2>
                        <p class="text-lg text-gray-700 text-center mb-10">
                            ¡Reserva tu <strong>fiesta infantil en Panamá</strong>! Completa este formulario para asegurar la magia de tu evento.
                        </p>
                        <div class="grid grid-cols-1 lg:grid-cols-1 gap-6 sm:gap-16">
                            <div class="bg-gradient-to-br from-purple-100 to-purple-200 p-6 sm:p-10 rounded-3xl shadow-2xl border-4 border-purple-400">
                                <form id="bookingForm" class="space-y-6" novalidate>
                                    <div class="bg-gradient-to-br from-pink-50 to-pink-100 p-6 rounded-2xl shadow-xl border-4 border-pink-300 mb-6">
                                        <h4 class="text-lg font-bold text-pink-700 mb-4">Tu Selección:</h4>
                                        ${selectedItemsListHtml}
                                        ${transportFeeDisplayHtml}
                                        <p class="text-xl font-bold text-purple-700 mt-4">Total a Pagar: <span class="text-pink-600">$${finalTotalPrice.toFixed(2)}</span></p>
                                    </div>
                                    
                                    <div>
                                        <label for="locationSelect" class="block text-gray-700 font-bold mb-2 sm:mb-3 text-sm sm:text-base">Ubicación del Evento:</label>
                                        <select id="locationSelect" name="ubicacionEvento" class="w-full p-3 sm:p-4 border-2 border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500 text-sm sm:text-base cursor-pointer transition duration-150 ease-in-out" aria-label="Selecciona la ubicación del evento">
                                            <option value="Panamá Centro" ${appState.bookingFormData.selectedLocation === 'Panamá Centro' ? 'selected' : ''}>Panamá Centro</option>
                                            <option value="Arraiján" ${appState.bookingFormData.selectedLocation === 'Arraiján' ? 'selected' : ''}>Arraiján ($10 adicional)</option>
                                            <option value="La Chorrera" ${appState.bookingFormData.selectedLocation === 'La Chorrera' ? 'selected' : ''}>La Chorrera ($15 adicional)</option>
                                            <option value="Pacora" ${appState.bookingFormData.selectedLocation === 'Pacora' ? 'selected' : ''}>Pacora ($10 adicional)</option>
                                            <option value="Panamá Norte" ${appState.bookingFormData.selectedLocation === 'Panamá Norte' ? 'selected' : ''}>Panamá Norte ($10 adicional)</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="exactLocation" class="block text-gray-700 font-bold mb-2 sm:mb-3 text-sm sm:text-base">Dirección Exacta:</label>
                                        <input type="text" id="exactLocation" name="direccionExacta" class="w-full p-3 sm:p-4 border-2 border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500 text-sm sm:text-base transition" placeholder="Ej: Calle Principal, Casa #15..." value="${appState.bookingFormData.exactLocation || ''}" required aria-describedby="error-exactLocation" autocomplete="street-address"/>
                                        <span id="error-exactLocation" class="error-message hidden"></span>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label for="bookingDate" class="block text-gray-700 font-bold mb-2 sm:mb-3 text-sm sm:text-base">Fecha del Evento:</label>
                                            <input type="date" id="bookingDate" name="fechaEvento" class="w-full p-3 sm:p-4 border-2 border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" min="${new Date().toISOString().split('T')[0]}" value="${appState.bookingFormData.bookingDate || ''}" required aria-describedby="error-bookingDate"/>
                                            <span id="error-bookingDate" class="error-message hidden"></span>
                                        </div>
                                        <div>
                                            <label for="bookingTime" class="block text-gray-700 font-bold mb-2 sm:mb-3 text-sm sm:text-base">Hora del Evento:</label>
                                            <input type="time" id="bookingTime" name="horaEvento" class="w-full p-3 sm:p-4 border-2 border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" value="${appState.bookingFormData.bookingTime || ''}" required aria-describedby="error-bookingTime"/>
                                            <span id="error-bookingTime" class="error-message hidden"></span>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="customerName" class="block text-gray-700 font-bold mb-2 sm:mb-3 text-sm sm:text-base">Tu Nombre:</label>
                                        <input type="text" id="customerName" name="nombreCliente" class="w-full p-3 sm:p-4 border-2 border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" placeholder="Ej: Juan Pérez" value="${appState.bookingFormData.customerName || ''}" required aria-describedby="error-customerName" autocomplete="name"/>
                                        <span id="error-customerName" class="error-message hidden"></span>
                                    </div>
                                    <div>
                                        <label for="customerEmail" class="block text-gray-700 font-bold mb-2 sm:mb-3 text-sm sm:text-base">Tu Email:</label>
                                        <input type="email" id="customerEmail" name="emailCliente" class="w-full p-3 sm:p-4 border-2 border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" placeholder="Ej: tu.email@example.com" value="${appState.bookingFormData.customerEmail || ''}" required aria-describedby="error-customerEmail" autocomplete="email"/>
                                        <span id="error-customerEmail" class="error-message hidden"></span>
                                    </div>
                                    <div>
                                        <label for="customerPhone" class="block text-gray-700 font-bold mb-2 sm:mb-3 text-sm sm:text-base">Tu Teléfono:</label>
                                        <input type="tel" id="customerPhone" name="telefonoCliente" class="w-full p-3 sm:p-4 border-2 border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" placeholder="Ej: 555-1234567" value="${appState.bookingFormData.customerPhone || ''}" required aria-describedby="error-customerPhone" autocomplete="tel"/>
                                        <span id="error-customerPhone" class="error-message hidden"></span>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label for="eventType" class="block text-gray-700 font-bold mb-2 sm:mb-3 text-sm sm:text-base">Tipo de Evento:</label>
                                            <input type="text" id="eventType" name="tipoEvento" class="w-full p-3 sm:p-4 border-2 border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" placeholder="Ej: Cumpleaños" value="${appState.bookingFormData.eventType || ''}" required aria-describedby="error-eventType"/>
                                            <span id="error-eventType" class="error-message hidden"></span>
                                        </div>
                                        <div>
                                            <label for="numKids" class="block text-gray-700 font-bold mb-2 sm:mb-3 text-sm sm:text-base"># Estimado de Niños:</label>
                                            <input type="number" id="numKids" name="numeroNinos" class="w-full p-3 sm:p-4 border-2 border-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" placeholder="Ej: 20" min="1" value="${appState.bookingFormData.numKids || ''}" required aria-describedby="error-numKids"/>
                                            <span id="error-numKids" class="error-message hidden"></span>
                                        </div>
                                    </div>
                                    <button type="submit" class="w-full bg-gradient-to-br from-cyan-500 via-blue-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white font-bold py-3 sm:py-4 px-4 sm:px-6 rounded-full shadow-xl text-base sm:text-lg mt-6 transition duration-300 transform hover:scale-105 border-2 border-white cursor-pointer flex items-center justify-center">
                                        ¡Confirmar Reserva Mágica! <i data-lucide="sparkles"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </section>
                `;
                renderSection(html);
                lucide.createIcons();

                const bookingForm = document.getElementById('bookingForm');
                if (bookingForm) {
                    bookingForm.onsubmit = handleBookingSubmit;
                    const locationSelect = document.getElementById('locationSelect');
                    if (locationSelect) {
                        locationSelect.onchange = (e) => {
                            appState.bookingFormData.selectedLocation = e.target.value;
                            appState.selectedLocation = e.target.value;
                            updateCartSummary(); 
                            renderBookingSection(); // Re-render to update transport fee display
                        };
                    }

                    // Add real-time validation for required fields
                    const requiredFields = ['exactLocation', 'bookingDate', 'bookingTime', 'customerName', 'customerEmail', 'customerPhone', 'eventType', 'numKids'];
                    requiredFields.forEach(fieldId => {
                        const inputElement = document.getElementById(fieldId);
                        if (inputElement) {
                            inputElement.onblur = () => validateField(fieldId);
                            inputElement.oninput = () => validateField(fieldId, true); // Clear error on input, but don't show new error until blur
                        }
                    });
                    // Specific email validation on input
                    const emailInput = document.getElementById('customerEmail');
                    if (emailInput) {
                        emailInput.oninput = () => {
                            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailInput.value.trim())) {
                                showFieldError('customerEmail', 'Por favor, introduce un email válido.');
                            } else {
                                clearFieldError('customerEmail');
                            }
                        };
                    }
                }
                console.log('renderBookingSection: Event listeners para la sección Reserva asignados.');
            } catch (error) {
                console.error('renderBookingSection: Error al renderizar la sección Reserva:', error);
            }
        }

        // --- Functions to save and load booking form data ---
        function saveBookingFormData() {
            const bookingForm = document.getElementById('bookingForm');
            if (bookingForm) {
                appState.bookingFormData = {
                    bookingDate: bookingForm.elements.bookingDate?.value || '',
                    bookingTime: bookingForm.elements.bookingTime?.value || '',
                    customerName: bookingForm.elements.customerName?.value || '',
                    customerEmail: bookingForm.elements.customerEmail?.value || '',
                    customerPhone: bookingForm.elements.customerPhone?.value || '',
                    eventType: bookingForm.elements.eventType?.value || '',
                    numKids: bookingForm.elements.numKids?.value || '',
                    exactLocation: bookingForm.elements.exactLocation?.value || '',
                    selectedLocation: bookingForm.elements.locationSelect?.value || 'Panamá Centro'
                };
                localStorage.setItem('bookingFormData', JSON.stringify(appState.bookingFormData));
                localStorage.setItem('selectedItems', JSON.stringify(appState.selectedItems));
                console.log('saveBookingFormData: Datos de reserva y carrito guardados en localStorage.');
            }
        }

        function loadBookingFormData() {
            try {
                const savedFormData = localStorage.getItem('bookingFormData');
                if (savedFormData) {
                    appState.bookingFormData = JSON.parse(savedFormData);
                    appState.selectedLocation = appState.bookingFormData.selectedLocation;
                    console.log('loadBookingFormData: Datos de formulario de reserva cargados.');
                }
                const savedSelectedItems = localStorage.getItem('selectedItems');
                if (savedSelectedItems) {
                    appState.selectedItems = JSON.parse(savedSelectedItems);
                    console.log('loadBookingFormData: Ítems seleccionados cargados.');
                }
            } catch (e) {
                console.error("Error loading data from localStorage:", e);
                localStorage.removeItem('bookingFormData');
                localStorage.removeItem('selectedItems');
                console.log('loadBookingFormData: Datos de localStorage limpiados debido a un error.');
            }
        }

        // --- Form Validation Helper Functions ---
        function clearFormErrors() {
            document.querySelectorAll('.error-message').forEach(span => span.classList.add('hidden'));
            document.querySelectorAll('.input-error').forEach(input => input.classList.remove('input-error'));
            console.log('clearFormErrors: Errores de formulario limpiados.');
        }

        function showFieldError(fieldId, message) {
            const errorSpan = document.getElementById(`error-${fieldId}`);
            const inputElement = document.getElementById(fieldId);
            if (errorSpan && inputElement) {
                errorSpan.textContent = message;
                errorSpan.classList.remove('hidden');
                inputElement.classList.add('input-error');
                console.log(`showFieldError: Error mostrado para ${fieldId}: ${message}`);
            }
        }

        function clearFieldError(fieldId) {
            const errorSpan = document.getElementById(`error-${fieldId}`);
            const inputElement = document.getElementById(fieldId);
            if (errorSpan && inputElement) {
                errorSpan.classList.add('hidden');
                inputElement.classList.remove('input-error');
                console.log(`clearFieldError: Error limpiado para ${fieldId}.`);
            }
        }

        function validateField(fieldId, isInputEvent = false) {
            const inputElement = document.getElementById(fieldId);
            if (!inputElement) {
                console.warn(`validateField: Elemento de entrada no encontrado para ID: ${fieldId}`);
                return true;
            }

            const value = inputElement.value.trim();
            let isValid = true;
            let errorMessage = '';

            if (inputElement.hasAttribute('required') && !value) {
                isValid = false;
                errorMessage = 'Este campo es obligatorio.';
            } else if (fieldId === 'customerEmail' && value && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
                isValid = false;
                errorMessage = 'Por favor, introduce un email válido.';
            } else if (fieldId === 'numKids' && value && (parseInt(value, 10) < 1 || isNaN(parseInt(value, 10)))) {
                isValid = false;
                errorMessage = 'Debe ser un número mayor a 0.';
            }

            if (isValid) {
                clearFieldError(fieldId);
            } else if (!isInputEvent) { // Only show error on blur or initial submit, not on every input keystroke
                showFieldError(fieldId, errorMessage);
            }
            return isValid;
        }

        async function handleBookingSubmit(event) {
            event.preventDefault();
            console.log('handleBookingSubmit: Intento de envío de formulario.');
            clearFormErrors();

            if (appState.selectedItems.length === 0) {
                showInfoModal('¡Por favor, añade al menos un servicio o paquete a tu reserva! <i data-lucide="shopping-cart"></i>');
                console.log('handleBookingSubmit: Carrito vacío, deteniendo envío.');
                return;
            }
            const miniTallerItem = appState.selectedItems.find(item => item.name === 'Mini Taller de Manualidades');
            if (miniTallerItem && miniTallerItem.quantity < 10) {
                showInfoModal('El "Mini Taller de Manualidades" requiere un mínimo de 10 niños. Por favor, ajusta la cantidad. <i data-lucide="scissors"></i>');
                console.log('handleBookingSubmit: Cantidad de taller de manualidades insuficiente, deteniendo envío.');
                return;
            }

            const requiredFields = ['exactLocation', 'bookingDate', 'bookingTime', 'customerName', 'customerEmail', 'customerPhone', 'eventType', 'numKids'];
            let formIsValid = true;
            for (const fieldId of requiredFields) {
                if (!validateField(fieldId)) { // Validate each field and collect errors
                    formIsValid = false;
                }
            }

            if (!formIsValid) {
                showInfoModal('¡Oops! Por favor, completa todos los campos requeridos correctamente. <i data-lucide="clipboard-list"></i>');
                console.log('handleBookingSubmit: Formulario inválido, deteniendo envío.');
                return;
            }

            saveBookingFormData();
            showInfoModal('¡Redirigiendo a JotForm para finalizar tu reserva! <i data-lucide="sparkles"></i> Haz clic en "¡Entendido!" para continuar.', () => {
                const { bookingDate, bookingTime, customerName, customerEmail, customerPhone, eventType, numKids, exactLocation } = appState.bookingFormData;
                const [year, month, day] = bookingDate.split('-'); 
                const selectedLocationName = appState.selectedLocation;
                const currentTransportFee = transportFeesByLocation[selectedLocationName] || 0;
                const selectedItemsString = appState.selectedItems.map(item => `${item.name} ${item.quantity > 0 ? `(x${item.quantity})` : ''} ($${getAdjustedItemPrice(item).toFixed(2)})`).join(', ');
                const finalTotalPrice = appState.selectedItems.reduce((sum, item) => sum + getAdjustedItemPrice(item), 0) + currentTransportFee;

                const jotformBaseUrl = 'https://form.jotform.com/251611549526054'; 
                const params = new URLSearchParams({
                    'fechaDelEvento[year]': year,
                    'fechaDelEvento[month]': month,
                    'fechaDelEvento[day]': day,
                    'horaDelEvento': bookingTime,
                    'nombreDelCliente': customerName,
                    'emailDelCliente': customerEmail,
                    'telefonoDelCliente': customerPhone,
                    'tipoDeEvento': eventType,
                    'numeroEstimadoDeNinos': numKids,
                    'ubicacionSeleccionada': selectedLocationName,
                    'recargoPorTransporte': `$${currentTransportFee.toFixed(2)}`,
                    'direccionExactaDelEvento': exactLocation,
                    'serviciosPaquetesSeleccionados': selectedItemsString,
                    'precioTotalEstimado': `$${finalTotalPrice.toFixed(2)}`,
                    'idDeSesionVisitante': appState.userId
                });
                const jotformUrl = `${jotformBaseUrl}?${params.toString()}`;
                console.log('handleBookingSubmit: Redirigiendo a JotForm:', jotformUrl);
                const newWindow = window.open(jotformUrl, '_blank');
                if (!newWindow) {
                    window.location.href = jotformUrl; 
                }
            });
        }
        
        // --- NEW: Mobile Menu Toggle Function ---
        function toggleMobileMenu(show) {
            const mobileMenu = document.getElementById('mobileMenu');
            const overlay = document.getElementById('mobileMenuOverlay');
            const toggleButton = document.getElementById('mobileMenuToggle');

            if (show) {
                appState.lastFocusedElement = document.activeElement; // Store focus before opening menu
                overlay.classList.add('open');
                mobileMenu.classList.add('open');
                toggleButton.setAttribute('aria-expanded', 'true');
                document.body.style.overflow = 'hidden';
                mobileMenu.focus(); // Focus the mobile menu when opened
                console.log('toggleMobileMenu: Menú móvil abierto.');
            } else {
                overlay.classList.remove('open');
                mobileMenu.classList.remove('open');
                toggleButton.setAttribute('aria-expanded', 'false');
                document.body.style.overflow = '';
                if (appState.lastFocusedElement) {
                    appState.lastFocusedElement.focus(); // Restore focus
                    appState.lastFocusedElement = null;
                }
                console.log('toggleMobileMenu: Menú móvil cerrado.');
            }
        }

        // --- NEW: Header Scroll Effect ---
        function handleHeaderScroll() {
            const header = document.getElementById('mainHeader');
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        }

        // --- Application Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOMContentLoaded: El DOM ha sido completamente cargado y parseado.');
            try {
                loadBookingFormData(); 

                // Event listeners for modals
                document.getElementById('closeModalButton').onclick = closeModal;
                document.getElementById('closePromoModalButton').onclick = closePromoModal;
                document.getElementById('closeBookingWarningModalButton').onclick = closeBookingWarningModal;
                document.getElementById('closeMiniCartModalButton').onclick = closeMiniCartModal;
                document.getElementById('closeImageModalButton').onclick = closeImageModal;
                document.getElementById('clearCartButton').onclick = clearCart; // New: Clear cart button
                console.log('DOMContentLoaded: Listeners de modales asignados.');

                // --- NEW: Mobile Menu Event Listeners ---
                document.getElementById('mobileMenuToggle').onclick = () => toggleMobileMenu(true);
                document.getElementById('closeMobileMenuButton').onclick = () => toggleMobileMenu(false);
                document.getElementById('mobileMenuOverlay').onclick = () => toggleMobileMenu(false);
                console.log('DOMContentLoaded: Listeners de menú móvil asignados.');

                // --- NEW: Scroll Listener for Header ---
                window.addEventListener('scroll', handleHeaderScroll);
                console.log('DOMContentLoaded: Listener de scroll para el encabezado asignado.');

                // Navigation button event listeners (for both desktop and mobile)
                const navActions = {
                    Home: () => setActiveSection('home'),
                    Services: () => setActiveSection('services'),
                    AnimatorPackages: () => setActiveSection('animatorPackages'), // Direct to animator packages page
                    ClownPackages: () => setActiveSection('clownPackages'), // Direct to clown packages page
                    BubblePackages: () => setActiveSection('bubblePackages'),
                    Testimonials: () => setActiveSection('testimonials'), // NEW
                    Gallery: () => setActiveSection('gallery'), // NEW
                    Booking: () => setActiveSection('booking')
                };

                ['Home', 'Services', 'AnimatorPackages', 'ClownPackages', 'BubblePackages', 'Testimonials', 'Gallery', 'Booking'].forEach(section => {
                    const desktopBtn = document.getElementById(`nav${section}`);
                    const mobileBtn = document.getElementById(`mobileNav${section}`);
                    if (desktopBtn) desktopBtn.onclick = navActions[section];
                    if (mobileBtn) mobileBtn.onclick = navActions[section];
                });
                console.log('DOMContentLoaded: Listeners de navegación asignados.');

                // Cart buttons
                document.getElementById('proceedToBookButton').onclick = () => setActiveSection('booking');
                document.getElementById('miniCartProceedToBookButton').onclick = () => {
                    closeMiniCartModal();
                    setActiveSection('booking');
                };
                document.getElementById('viewCartDetailsButton').onclick = showMiniCartModal;
                console.log('DOMContentLoaded: Listeners de carrito asignados.');

                setActiveSection('home');
                updateCartSummary();
                lucide.createIcons(); // Initial icon creation
                console.log('DOMContentLoaded: Inicialización completa. Sección Home cargada.');
            } catch (error) {
                console.error('DOMContentLoaded: Error durante la inicialización de la aplicación:', error);
            }
        });
    </script>
</body>
</html>
