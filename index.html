<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Fiestas Infantiles en Panam√° | Animaci√≥n y Shows | Diverty Eventos</title>
    <meta name="description" content="Organizamos las mejores fiestas infantiles en Panam√° Centro, Panam√° Este, Arraij√°n, La Chorrera, Anc√≥n, Pacora y Panam√° Norte. Expertos en animaci√≥n infantil, shows de burbujas, pintacaritas, globoflexia y personajes tem√°ticos.">
    
    <!-- SEO, PWA, and other meta tags -->
    <meta name="keywords" content="fiestas infantiles panama, animacion infantil panama centro, payasos panama, shows burbujas panama, pintacaritas arraijan, globoflexia la chorrera, eventos infantiles pacora, animadores panama norte, cumpleanos panama, entretenimiento infantil panama, decoraciones fiestas panama, personajes tematicos panama, magos panama, recreacion infantil panama, fiestas infantiles ancon, fiestas infantiles panama este">
    <meta name="geo.region" content="PA">
    <meta name="geo.placename" content="Panama City">
    <meta name="geo.position" content="8.9824;-79.5199">
    <meta name="ICBM" content="8.9824, -79.5199">
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <link rel="canonical" href="https://divertyeventos.online/">
    <meta property="og:title" content="Diverty Eventos | Las Mejores Fiestas Infantiles en Panam√°">
    <meta property="og:description" content="Especialistas en fiestas infantiles en Panam√° Centro, Panam√° Este, Arraij√°n, La Chorrera, Anc√≥n, Pacora y Panam√° Norte. Shows de burbujas, animaci√≥n, pintacaritas y m√°s. ¬°M√°s de 500 fiestas realizadas!">
    <meta property="og:image" content="https://divertyeventos.online/android-chrome-512x512.png">
    <meta property="og:url" content="https://divertyeventos.online/">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiRGl2ZXJ0eSBFdmVudG9zIiwic2hvcnRfbmFtZSI6IkRpdmVydHkiLCJzdGFydF91cmwiOiIvIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiI2ZmZmZmZiIsInRoZW1lX2NvbG9yIjoiIzc5MjJjZSIsImljb25zIjpbeyJzcmMiOiJodHRwczovL2RpdmVydHlldmVudG9zLm9ubGluZS9hbmRyb2lkLWNocm9tZS01MTJ4NTEyLnBuZyIsInNpemVzIjoiNTEyeDUxMiIsInR5cGUiOiJpbWFnZS9wbmcifV19">
    <meta name="theme-color" content="#7922ce">

    <!-- Preload critical resources for faster loading -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&family=Poppins:wght@400;600;700;800&family=Quicksand:wght@400;600;700&display=swap" as="style">
    <link rel="preload" href="https://divertyeventos.online/android-chrome-512x512.png" as="image">

    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&family=Poppins:wght@400;600;700;800&family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js" defer></script>
    
    <!-- Structured Data (Schema.org) will be added dynamically by app.js -->
    <script type="application/ld+json" id="schema-event-planner"></script>
    <script type="application/ld+json" id="schema-faq"></script>
    <script type="application/ld+json" id="schema-products"></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SBYYJTHTEF"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-SBYYJTHTEF');
    </script>
    
    <!-- Google Tag Manager -->
    <script>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GT-NCTBXSPZ');
    </script>
    <!-- End Google Tag Manager -->

    <!-- 
    ================================================================
    |                        STYLES (CSS)                          |
    ================================================================
    -->
    <style>
        :root{--primary-purple:#7c3aed;--primary-pink:#db2777;--primary-blue:#3b82f6;--primary-orange:#f97316;--gradient-primary:linear-gradient(135deg, #667eea 0%, #764ba2 100%);--gradient-secondary:linear-gradient(135deg, #f093fb 0%, #f5576c 100%);--gradient-tertiary:linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);--shadow-soft:0 10px 25px rgba(0,0,0,0.1);--shadow-medium:0 15px 35px rgba(0,0,0,0.15);--shadow-strong:0 20px 40px rgba(0,0,0,0.2);--bg-light:#f5f7fa}
        *{box-sizing:border-box}
        html{scroll-behavior:smooth}
        body{font-family:'Quicksand',sans-serif;background-color:var(--bg-light);background-attachment:fixed;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;line-height:1.7;cursor:none}
        .btn-premium,a,button{cursor:none}
        h2,h3,h4,.font-poppins{font-family:'Poppins',sans-serif}
        h1,.font-nunito{font-family:'Nunito',sans-serif;font-weight:800}
        @media (max-width:1024px){body{padding-bottom:64px}}
        @media (max-width:768px){body{font-size:16px}h1{font-size:1.75rem!important}h2{font-size:1.5rem!important}h3{font-size:1.25rem!important}.container{padding:0 1rem}}
        #mainHeader{transition:all .4s cubic-bezier(.25,.46,.45,.94);background:rgba(255,255,255,0);border-bottom:1px solid rgba(255,255,255,0)}
        #mainHeader.scrolled{background:rgba(255,255,255,.9);backdrop-filter:blur(20px);box-shadow:var(--shadow-medium);border-bottom:1px solid rgba(124,58,237,.1)}
        .nav-link{transition:all .3s ease;position:relative;padding:.75rem 1rem;border-radius:12px;font-weight:600;text-decoration:none;display:inline-flex;align-items:center}
        .nav-link::before{content:'';position:absolute;bottom:0;left:50%;width:0;height:3px;background:var(--gradient-secondary);transition:all .3s ease;transform:translateX(-50%);border-radius:2px}
        .nav-link.active::before,.nav-link:hover::before{width:80%}
        .nav-link.active,.nav-link:hover{color:var(--primary-pink);background:rgba(219,39,119,.1);transform:translateY(-2px)}
        #mobileMenu{position:fixed;top:0;right:-100%;width:90%;max-width:380px;height:100vh;background:linear-gradient(135deg,#fff 0%,#f8fafc 100%);box-shadow:-20px 0 60px rgba(0,0,0,.2);transition:right .3s cubic-bezier(.25,.46,.45,.94);z-index:1000;display:flex;flex-direction:column;overflow-y:auto}
        #mobileMenu.open{right:0}
        .mobile-menu-header{background:var(--gradient-primary);color:#fff;padding:2rem 1.5rem;position:relative;overflow:hidden}
        .mobile-nav-link{padding:.75rem 1.5rem;margin:.1rem 1rem;border-radius:12px;transition:all .3s ease;display:flex;align-items:center;font-weight:600;gap:1rem;position:relative;overflow:hidden;text-decoration:none}
        .mobile-nav-link:hover,.mobile-nav-link.active{color:#fff;transform:translateX(8px) scale(1.02);box-shadow:var(--shadow-soft);background:var(--gradient-secondary)}
        .floating-buttons{position:fixed;bottom:80px;right:20px;z-index:998;display:flex;flex-direction:column;gap:1rem}
        .floating-btn{width:64px;height:64px;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:var(--shadow-medium);cursor:none;transition:all .4s cubic-bezier(.25,.46,.45,.94);position:relative;overflow:hidden}
        .floating-btn:hover{transform:scale(1.15) rotate(5deg);box-shadow:var(--shadow-strong)}
        .whatsapp-btn{background:linear-gradient(45deg,#25d366,#128c7e);animation:pulse-whatsapp 2.5s infinite cubic-bezier(.66,0,0,1)}
        .chat-btn{background:var(--gradient-primary)}
        @keyframes pulse-whatsapp{0%{box-shadow:0 0 0 0 rgba(37,211,102,.5)}70%{box-shadow:0 0 0 18px rgba(37,211,102,0)}100%{box-shadow:0 0 0 0 rgba(37,211,102,0)}}
        .btn-premium{font-weight:700;padding:1rem 2rem;border-radius:50px;box-shadow:var(--shadow-soft);transition:all .3s cubic-bezier(.175,.885,.32,1.275);border:none;display:inline-flex;align-items:center;justify-content:center;gap:.75rem;position:relative;overflow:hidden;text-decoration:none;cursor:none;font-size:1rem}
        .btn-premium:hover{transform:translateY(-4px) scale(1.1);box-shadow:var(--shadow-strong)}
        .btn-premium:disabled{background:#d1d5db;cursor:not-allowed;transform:none;box-shadow:none}
        .btn-primary{background:var(--gradient-secondary);color:#fff}
        .btn-secondary{background:var(--gradient-primary);color:#fff}
        .btn-tertiary{background:var(--gradient-tertiary);color:#fff}
        .btn-success{background:linear-gradient(135deg,#10b981,#059669);color:#fff}
        .btn-warning{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff}
        .hero-section{min-height:70vh;display:flex;align-items:center;justify-content:center;text-align:center;margin:0;border-radius:0;position:relative;overflow:hidden;color:#fff;background:var(--gradient-primary)}
        .hero-section video{position:absolute;top:50%;left:50%;width:100%;height:100%;object-fit:cover;transform:translate(-50%,-50%);z-index:0}
        .hero-overlay{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.4);z-index:1}
        .hero-content{position:relative;z-index:2;max-width:800px;padding:2rem}
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:2rem;margin:3rem 0}
        .stat-card{background:#fff;padding:2.5rem 1.5rem;border-radius:20px;text-align:center;box-shadow:var(--shadow-soft);transition:all .3s ease;position:relative;overflow:hidden}
        .stat-card:hover{transform:translateY(-8px);box-shadow:var(--shadow-medium)}
        .stat-number{font-size:3rem;font-weight:800;background:var(--gradient-secondary);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:.5rem}
        .coverage-area{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:8rem 2rem 4rem;text-align:center;position:relative;overflow:hidden}
        .coverage-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:2rem;margin-top:2rem}
        .coverage-item{background:rgba(255,255,255,.1);padding:1.5rem;border-radius:16px;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2);transition:all .3s ease}
        .coverage-item:hover{transform:translateY(-5px);background:rgba(255,255,255,.15)}
        .gallery-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1rem;margin:2rem 0}
        .gallery-item{position:relative;overflow:hidden;border-radius:20px;cursor:none;transition:all .4s ease;aspect-ratio:1;background:#f3f4f6}
        .gallery-item:hover{transform:scale(1.05);box-shadow:var(--shadow-strong)}
        .gallery-item img{width:100%;height:100%;object-fit:cover;transition:all .4s ease}
        .chat-header{background:var(--gradient-primary);color:#fff;padding:1rem;position:relative;overflow:hidden;flex-shrink:0}
        .chat-messages{flex-grow:1;padding:1rem;overflow-y:auto}
        .chat-input{padding:1rem;border-top:1px solid #e5e7eb;background:#f9fafb;flex-shrink:0}
        #chatModal .modal-content{height:80vh;max-height:700px;width:100%;max-width:500px;display:flex;flex-direction:column}
        .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(8px);z-index:1000;display:flex;align-items:center;justify-content:center;padding:1rem;opacity:0;visibility:hidden;transition:all .3s ease}
        .modal-backdrop.show{opacity:1;visibility:visible}
        .modal-content{background:#fff;border-radius:24px;box-shadow:var(--shadow-strong);max-width:90vw;max-height:90vh;overflow-y:auto;transform:scale(.9);transition:all .3s cubic-bezier(.25,.46,.45,.94)}
        .modal-backdrop.show .modal-content{transform:scale(1)}
        .form-input{width:100%;padding:1rem 1.25rem;border:2px solid #e5e7eb;border-radius:16px;font-size:1rem;transition:all .3s ease;background:#fff}
        .form-input:focus{outline:none;border-color:var(--primary-purple);box-shadow:0 0 0 4px rgba(124,58,237,.1)}
        .animate-slide-up{animation:slideUpFadeIn .8s ease-out forwards;opacity:0}
        @keyframes slideUpFadeIn{from{opacity:0;transform:translateY(40px)}to{opacity:1;transform:translateY(0)}}
        .float-animation{animation:float 4s ease-in-out infinite}
        @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-12px)}}
        #toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);z-index:10000;padding:1rem 1.5rem;border-radius:50px;color:#fff;font-weight:600;opacity:0;visibility:hidden;transition:all .4s cubic-bezier(.25,.46,.45,.94);display:flex;align-items:center;gap:.75rem}
        #toast.show{opacity:1;visibility:visible;transform:translateX(-50%) translateY(10px)}
        #toast.success{background:linear-gradient(135deg,#10b981,#059669)}
        #toast.error{background:linear-gradient(135deg,#ef4444,#dc2626)}
        .loading-spinner{border:4px solid #f3f3f3;border-top:4px solid var(--primary-purple);border-radius:50%;width:50px;height:50px;animation:spin 1s linear infinite;margin:0 auto}
        @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
        #mobile-nav{transition:transform .3s ease-in-out}
        .mobile-nav-link-bottom{transition:all .2s ease-in-out;padding:.5rem}
        .mobile-nav-link-bottom.active{color:var(--primary-purple);transform:translateY(-4px)}
        .mobile-nav-link-bottom i{width:1.75rem;height:1.75rem}
        .card-detailed{transition:transform .3s ease,box-shadow .3s ease}
        .card-detailed:hover{transform:translateY(-12px);box-shadow:0 25px 50px -12px rgba(0,0,0,.25)}
        .card-detailed ul li i{flex-shrink:0}
        #promo-banner{transition:transform .5s ease-out,opacity .5s ease-out,max-height .5s ease-in-out,padding .5s ease-in-out;max-height:100px;overflow:hidden}
        #promo-banner.hide{max-height:0;opacity:0;padding-top:0;padding-bottom:0}
        .hide-scrollbar::-webkit-scrollbar{display:none}
        .hide-scrollbar{-ms-overflow-style:none;scrollbar-width:none}
        .pulse-booking{animation:pulse-booking 2s infinite}
        @keyframes pulse-booking{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}
        .cart-icon-shake{animation:cart-shake .5s}
        @keyframes cart-shake{10%,90%{transform:translate3d(-1px,0,0)}20%,80%{transform:translate3d(2px,0,0)}30%,50%,70%{transform:translate3d(-4px,0,0)}40%,60%{transform:translate3d(4px,0,0)}}
        #confetti-canvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;pointer-events:none}
        .wavy-divider{position:absolute;bottom:-1px;left:0;width:100%;overflow:hidden;line-height:0}
        .wavy-divider.top{top:-1px;bottom:auto;transform:rotate(180deg)}
        .wavy-divider svg{position:relative;display:block;width:calc(100% + 1.3px);height:90px}
        .wavy-divider .shape-fill{fill:var(--bg-light)}
        #magic-cursor{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9999}
        .review-card{background:#fff;border-radius:20px;box-shadow:var(--shadow-soft);transition:all .3s ease;display:flex;flex-direction:column}
        .review-card:hover{transform:translateY(-8px);box-shadow:var(--shadow-medium)}
        .review-header{display:flex;align-items:center;padding:1rem 1.5rem;border-bottom:1px solid #f3f4f6}
        .review-avatar{width:48px;height:48px;border-radius:50%;margin-right:1rem;border:2px solid var(--primary-purple)}
        .review-user{font-weight:700;color:#1f2937}
        .review-location{font-size:.8rem;color:#6b7280}
        .review-body{padding:1.5rem;font-style:italic;color:#4b5563;flex-grow:1}
        .review-footer{padding:1rem 1.5rem;border-top:1px solid #f3f4f6;display:flex;justify-content:space-between;align-items:center}
        .review-rating{display:flex;color:#f59e0b}
        .verified-badge{font-size:.75rem;font-weight:600;color:#059669;background-color:#d1fae5;padding:.25rem .75rem;border-radius:50px;display:inline-flex;align-items:center}
    </style>
</head>
<body class="min-h-screen text-gray-800 flex flex-col">
    
    <canvas id="confetti-canvas"></canvas>
    <canvas id="magic-cursor"></canvas>

    <div id="promo-banner" class="bg-gradient-to-r from-pink-500 to-orange-400 text-white p-3 text-center font-bold text-sm sm:text-base relative flex items-center justify-center">
        <span>¬°Promociones de Agosto! ‚òÄÔ∏è 10% OFF en Plan Diverty y Paquetes de Burbujas.</span>
        <button id="close-promo-banner" class="absolute right-2 sm:right-4 p-2 rounded-full bg-black/20 hover:bg-black/40 transition-colors" aria-label="Cerrar promoci√≥n">
            <i data-lucide="x" class="w-5 h-5"></i>
        </button>
    </div>

    <header id="mainHeader" class="py-4 px-4 w-full sticky top-0 z-40">
        <div class="container mx-auto flex justify-between items-center">
            <a href="#home" class="flex items-center logo-container nav-action" aria-label="P√°gina de inicio de Diverty Eventos">
                <img src="https://divertyeventos.online/android-chrome-512x512.png" alt="Diverty Eventos - Fiestas Infantiles Panam√°" class="w-16 h-16 sm:w-20 sm:h-20 lg:w-24 lg:h-24 mr-3 rounded-full object-cover border-3 border-pink-400 shadow-lg float-animation" loading="lazy" width="96" height="96" onerror="this.onerror=null;this.src='https://placehold.co/96x96/7c3aed/ffffff?text=Diverty';">
                <div class="text-2xl sm:text-3xl lg:text-4xl font-extrabold text-purple-900 font-nunito">Diverty Eventos</div>
            </a>
            <nav class="hidden lg:flex items-center space-x-2">
                <a href="#home" id="navHome" class="nav-link text-gray-600"><i data-lucide="home" class="w-4 h-4 mr-2"></i>Inicio</a>
                <a href="#services" id="navServices" class="nav-link text-gray-600"><i data-lucide="sparkles" class="w-4 h-4 mr-2"></i>Servicios</a>
                <a href="#ideas" id="navIdeas" class="nav-link text-gray-600"><i data-lucide="lightbulb" class="w-4 h-4 mr-2"></i>‚ú® Ideas</a>
                <a href="#animators" id="navAnimators" class="nav-link text-gray-600"><i data-lucide="user-check" class="w-4 h-4 mr-2"></i>Animadores</a>
                <a href="#clowns" id="navClowns" class="nav-link text-gray-600"><i data-lucide="smile" class="w-4 h-4 mr-2"></i>Payasos</a>
                <a href="#bubbles" id="navBubbles" class="nav-link text-gray-600"><i data-lucide="wind" class="w-4 h-4 mr-2"></i>Burbujas</a>
                <a href="#gallery" id="navGallery" class="nav-link text-gray-600"><i data-lucide="image" class="w-4 h-4 mr-2"></i>Galer√≠a</a>
                <a href="#blog" id="navBlog" class="nav-link text-gray-600"><i data-lucide="book-open" class="w-4 h-4 mr-2"></i>Blog</a>
                <a href="#reviews" id="navReviews" class="nav-link text-gray-600"><i data-lucide="star" class="w-4 h-4 mr-2"></i>Rese√±as</a>
                <a href="#booking" id="navBooking" class="btn-premium btn-primary nav-action pulse-booking"><i data-lucide="calendar-check" class="w-4 h-4"></i>¬°Reserva Ahora!</a>
            </nav>
            <button id="mobileToggle" class="lg:hidden p-3 rounded-xl text-gray-700 hover:bg-gray-100 transition-colors" aria-label="Abrir men√∫"><i data-lucide="menu" class="h-6 w-6"></i></button>
        </div>
    </header>
    
    <div id="cartSummary" class="hidden sticky top-20 z-30 bg-white bg-opacity-95 backdrop-blur-sm border-b border-purple-200 p-4 shadow-lg">
        <div class="container mx-auto flex flex-col sm:flex-row justify-between items-center gap-3">
            <div class="flex items-center gap-4 text-purple-800 font-bold">
                <div id="cart-icon-container" class="flex items-center gap-2"><i data-lucide="shopping-cart" class="w-5 h-5"></i><span>√çtems: <span id="itemCount" class="text-purple-700">0</span></span></div>
                <div>Total: <span id="totalPrice" class="text-pink-700">$0.00</span></div>
            </div>
            <div class="flex gap-3">
                <button id="openCalculator" class="btn-premium btn-success text-sm"><i data-lucide="calculator" class="w-4 h-4"></i>Calcular</button>
                <button id="viewCart" class="btn-premium btn-secondary text-sm"><i data-lucide="shopping-cart" class="w-4 h-4"></i>Ver Carrito</button>
            </div>
        </div>
    </div>

    <div id="mobileMenuOverlay" class="fixed inset-0 bg-black bg-opacity-60 z-[999] opacity-0 visibility-hidden transition-all duration-400"></div>
    <nav id="mobileMenu">
        <div class="mobile-menu-header">
            <div class="flex justify-between items-center relative z-10">
                <div>
                    <h2 class="text-2xl font-bold font-nunito">Diverty Eventos</h2>
                    <p class="text-sm opacity-90">Fiestas Infantiles en Panam√°</p>
                </div>
                <button id="closeMobile" class="p-2 text-white hover:text-gray-200 transition-colors" aria-label="Cerrar men√∫"><i data-lucide="x" class="h-6 w-6"></i></button>
            </div>
        </div>
        <div class="flex-1 p-6">
            <div class="space-y-1">
                <a href="#home" id="mobileHome" class="mobile-nav-link text-gray-700 w-full text-left nav-action"><i data-lucide="home" class="w-5 h-5"></i>Inicio</a>
                <a href="#services" id="mobileServices" class="mobile-nav-link text-gray-700 w-full text-left nav-action"><i data-lucide="sparkles" class="w-5 h-5"></i>Servicios</a>
                <a href="#ideas" id="mobileIdeas" class="mobile-nav-link text-gray-700 w-full text-left nav-action"><i data-lucide="lightbulb" class="w-5 h-5"></i>‚ú® Ideas</a>
                <a href="#animators" id="mobileAnimators" class="mobile-nav-link text-gray-700 w-full text-left nav-action"><i data-lucide="user-check" class="w-5 h-5"></i>Animadores</a>
                <a href="#clowns" id="mobileClowns" class="mobile-nav-link text-gray-700 w-full text-left nav-action"><i data-lucide="smile" class="w-5 h-5"></i>Payasos</a>
                <a href="#bubbles" id="mobileBubbles" class="mobile-nav-link text-gray-700 w-full text-left nav-action"><i data-lucide="wind" class="w-5 h-5"></i>Burbujas</a>
                <a href="#gallery" id="mobileGallery" class="mobile-nav-link text-gray-700 w-full text-left nav-action"><i data-lucide="image" class="w-5 h-5"></i>Galer√≠a</a>
                <a href="#blog" id="mobileBlog" class="mobile-nav-link text-gray-700 w-full text-left nav-action"><i data-lucide="book-open" class="w-5 h-5"></i>Blog</a>
                <a href="#reviews" id="mobileReviews" class="mobile-nav-link text-gray-700 w-full text-left nav-action"><i data-lucide="star" class="w-5 h-5"></i>Rese√±as</a>
            </div>
            <div class="mt-8 pt-6 border-t border-gray-200">
                <a href="#booking" id="mobileBooking" class="w-full btn-premium btn-primary nav-action"><i data-lucide="calendar-check" class="w-5 h-5"></i>¬°Reserva Ahora!</a>
            </div>
        </div>
    </nav>

    <main id="mainContent" class="flex-grow pb-24">
        <!-- Home section is now pre-rendered for faster loading -->
    </main>

    <footer class="bg-gradient-to-tr from-purple-700 to-indigo-800 text-white shadow-inner relative pt-20">
        <!-- NEW: Wavy divider for footer top -->
        <div class="wavy-divider top">
            <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none">
                <path d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z" class="shape-fill" style="fill: #667eea;"></path>
            </svg>
        </div>
        <div class="container mx-auto px-6 py-12 text-center">
            <p class="font-bold text-2xl mb-2 font-nunito">Diverty<span class="text-teal-300">Eventos</span></p>
            <p class="text-indigo-200 mt-2">&copy; 2025. Todos los derechos reservados. Creamos momentos inolvidables.</p>
        </div>
    </footer>
    
    <nav id="mobile-nav" class="lg:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg flex justify-around items-center h-16 z-40">
        <a href="#home" class="mobile-nav-link-bottom flex flex-col items-center justify-center text-gray-600 nav-action">
            <i data-lucide="home" class="w-7 h-7"></i>
            <span class="text-xs font-medium">Inicio</span>
        </a>
        <a href="#services" class="mobile-nav-link-bottom flex flex-col items-center justify-center text-gray-600 nav-action">
            <i data-lucide="sparkles" class="w-7 h-7"></i>
            <span class="text-xs font-medium">Servicios</span>
        </a>
        <a href="#booking" class="mobile-nav-link-bottom flex flex-col items-center justify-center text-gray-600 nav-action bg-purple-600 text-white rounded-full w-16 h-16 -mt-8 shadow-lg">
            <i data-lucide="calendar-check" class="w-8 h-8"></i>
            <span class="text-xs font-medium">Reservar</span>
        </a>
        <a href="#gallery" class="mobile-nav-link-bottom flex flex-col items-center justify-center text-gray-600 nav-action">
            <i data-lucide="image" class="w-7 h-7"></i>
            <span class="text-xs font-medium">Galer√≠a</span>
        </a>
        <a href="#ideas" class="mobile-nav-link-bottom flex flex-col items-center justify-center text-gray-600 nav-action">
            <i data-lucide="lightbulb" class="w-7 h-7"></i>
            <span class="text-xs font-medium">Ideas</span>
        </a>
    </nav>

    <div class="floating-buttons">
        <button id="chatToggle" class="floating-btn chat-btn" aria-label="Abrir chat de ayuda"><i data-lucide="message-circle" class="text-white w-6 h-6"></i></button>
        <a href="https://wa.me/50766677965?text=¬°Hola! Tengo una consulta sobre Diverty Eventos." class="floating-btn whatsapp-btn" target="_blank" rel="noopener noreferrer" aria-label="Contactar por WhatsApp"><i data-lucide="phone" class="text-white w-7 h-7"></i></a>
    </div>
    <div id="infoModal" class="modal-backdrop">
        <div class="modal-content bg-gradient-to-br from-purple-600 to-purple-800 text-white rounded-3xl shadow-2xl p-8 max-w-md w-full text-center">
            <div class="mb-6"><div class="w-20 h-20 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4"><i data-lucide="check-circle" class="w-10 h-10"></i></div><p id="modalMessage" class="text-xl font-bold mb-4"></p></div>
            <button id="closeModal" class="btn-premium bg-white text-purple-700 w-full" aria-label="Cerrar mensaje"><i data-lucide="thumbs-up"></i>¬°Entendido!</button>
        </div>
    </div>
    <div id="cartModal" class="modal-backdrop">
        <div class="modal-content bg-gradient-to-br from-purple-600 to-purple-800 text-white rounded-3xl shadow-2xl p-8 max-w-lg w-full">
            <h2 class="text-3xl font-bold mb-6 flex items-center justify-center gap-3 text-center"><i data-lucide="shopping-cart"></i>Tu Carrito</h2>
            <div id="cartItems" class="max-h-60 overflow-y-auto text-left mb-6 p-4 bg-white bg-opacity-10 rounded-2xl backdrop-blur-sm"></div>
            <div class="text-left mb-4"><label for="cartLocation" class="font-bold text-purple-200">Ubicaci√≥n del Evento:</label><select id="cartLocation" class="w-full mt-2 p-3 rounded-xl text-gray-800 font-semibold"></select></div>
            <div class="text-right font-bold mb-6 space-y-2"><p class="text-lg text-purple-200">Subtotal: <span id="cartTotal">$0.00</span></p><p class="text-sm text-purple-300">Transporte: <span id="transportCost">$0.00</span></p><p class="text-2xl text-yellow-300 border-t border-white border-opacity-20 pt-3">Total Final: <span id="finalTotal">$0.00</span></p></div>
            <div class="flex gap-4"><button id="closeCart" class="btn-premium bg-gray-400 text-gray-800 flex-1" aria-label="Cerrar carrito"><i data-lucide="x"></i>Cerrar</button><a href="#booking" id="proceedBooking" class="btn-premium btn-tertiary flex-1 nav-action"><i data-lucide="sparkles"></i>Reservar</a></div>
        </div>
    </div>
    <div id="calculatorModal" class="modal-backdrop">
        <div class="modal-content bg-gradient-to-br from-purple-600 to-purple-800 text-white rounded-3xl shadow-2xl p-8 max-w-2xl w-full">
            <h2 class="text-3xl font-bold mb-6 flex items-center justify-center gap-3"><i data-lucide="calculator"></i>Calculadora de Presupuesto</h2>
            <div class="bg-white bg-opacity-10 rounded-2xl p-6 mb-6"><h3 class="text-xl font-bold mb-4">Servicios Disponibles:</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-60 overflow-y-auto"><div id="calculatorServices"></div></div></div>
            <div class="bg-white bg-opacity-10 rounded-2xl p-6 mb-6"><h3 class="text-xl font-bold mb-4">Ubicaci√≥n del Evento:</h3><select id="calculatorLocation" class="w-full p-3 rounded-xl text-gray-800 font-semibold"></select></div>
            <div class="bg-gradient-to-r from-yellow-400 to-orange-400 text-gray-900 rounded-2xl p-6 mb-6">
                <div class="flex justify-between items-center mb-3"><span class="text-lg font-bold">Subtotal Servicios:</span><span id="calcSubtotal" class="text-2xl font-bold">$0.00</span></div>
                <div class="flex justify-between items-center mb-3"><span class="text-lg font-bold">Costo de Transporte:</span><span id="calcTransport" class="text-2xl font-bold">$0.00</span></div>
                <div class="border-t-2 border-gray-700 pt-3"><div class="flex justify-between items-center"><span class="text-xl font-bold">TOTAL ESTIMADO:</span><span id="calcTotal" class="text-3xl font-bold">$0.00</span></div></div>
            </div>
            <div class="flex gap-4"><button id="closeCalculator" class="btn-premium bg-gray-400 text-gray-800 flex-1" aria-label="Cerrar calculadora"><i data-lucide="x"></i>Cerrar</button><button id="addCalculatedToCart" class="btn-premium btn-tertiary flex-1"><i data-lucide="shopping-cart"></i>Agregar al Carrito</button></div>
        </div>
    </div>
    <div id="chatModal" class="modal-backdrop">
        <div class="modal-content">
            <div class="chat-header">
                <div class="flex justify-between items-center relative z-10">
                    <div class="flex items-center gap-3"><div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center"><i data-lucide="bot" class="w-5 h-5"></i></div><div><h3 class="font-bold">DivertyBot</h3><p class="text-xs opacity-90">Asistente Virtual</p></div></div>
                    <button id="closeChat" class="text-white hover:text-gray-200 p-2 transition-colors" aria-label="Cerrar chat"><i data-lucide="x" class="w-5 h-5"></i></button>
                </div>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="mb-4 p-4 bg-purple-100 rounded-2xl mr-8">
                    <div class="flex items-center gap-3 mb-3"><div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center"><i data-lucide="bot" class="w-4 h-4 text-white"></i></div><span class="text-sm font-semibold text-purple-800">DivertyBot</span></div>
                    <p class="text-sm text-purple-800">¬°Hola! üëã Soy DivertyBot, tu asistente virtual para las fiestas m√°s divertidas de Panam√°. ¬øEn qu√© puedo ayudarte hoy?</p>
                </div>
            </div>
            <div class="chat-input">
                <div class="flex gap-2 mb-2"><input type="text" id="chatInput" placeholder="Escribe tu pregunta..." class="flex-1 p-3 border border-gray-300 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-purple-500"><button id="sendChat" class="btn-premium btn-secondary !p-3 !w-12 !h-12"><i data-lucide="send" class="w-5 h-5"></i></button></div>
                <div id="quick-replies" class="flex flex-wrap justify-center gap-2">
                    <button class="quick-question bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-xs hover:bg-purple-200 transition-colors" data-question="¬øQu√© paquetes de payasos tienen?">ü§° Payasos</button>
                    <button class="quick-question bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-xs hover:bg-purple-200 transition-colors" data-question="¬øCu√°nto cuesta el show de burbujas?">üíß Burbujas</button>
                    <button class="quick-question bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-xs hover:bg-purple-200 transition-colors" data-question="¬øA qu√© zonas llegan?">üìç Zonas</button>
                </div>
            </div>
        </div>
    </div>
    <div id="bookingConfirmModal" class="modal-backdrop">
        <div class="modal-content text-center p-8 max-w-md w-full bg-white rounded-3xl shadow-2xl">
            <div class="w-20 h-20 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i data-lucide="alert-triangle" class="w-10 h-10 text-yellow-500"></i>
            </div>
            <h2 class="text-2xl font-bold mb-4 text-gray-800">¬°Un Momento!</h2>
            <p class="text-gray-600 mb-8">
                Importante: Antes de realizar la reserva, por favor consulte la disponibilidad de la fecha por WhatsApp para asegurar que podamos celebrar con usted.
            </p>
            <div class="flex flex-col sm:flex-row gap-4">
                <a href="https://wa.me/50766677965?text=¬°Hola! Quiero consultar la disponibilidad para una fecha." target="_blank" class="btn-premium btn-success flex-1">
                    <i data-lucide="phone"></i>Consultar por WhatsApp
                </a>
                <button id="continueToBookingBtn" class="btn-premium btn-secondary flex-1">
                    Continuar a la Reserva
                </button>
            </div>
        </div>
    </div>
    <div id="toast"></div>
    <div id="loadingOverlay" class="fixed inset-0 bg-white bg-opacity-95 flex items-center justify-center z-50 hidden">
        <div class="text-center"><div class="loading-spinner"></div><p class="mt-6 text-purple-700 font-semibold text-lg">Cargando...</p></div>
    </div>

    <!-- =========== SCRIPTS =========== -->
    <!-- jQuery y Lightbox ya no son necesarios -->
    
    <!-- 
    ================================================================
    |                     JAVASCRIPT LOGIC                         |
    ================================================================
    -->
    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // ================================================================
        // |               DATOS DE LA APLICACI√ìN (data.js)               |
        // |   Para cambiar precios o paquetes, edita esta secci√≥n.       |
        // ================================================================
        const locations = [
            { value: 'panama-centro', label: 'Panam√° Centro (Gratis)', cost: 0 },
            { value: 'arraijan', label: 'Arraij√°n (+$15)', cost: 15 },
            { value: 'la-chorrera', label: 'La Chorrera (+$15)', cost: 15 },
            { value: 'panama-norte', label: 'Panam√° Norte (+$10)', cost: 10 },
            { value: 'panama-este', label: 'Panam√° Este (+$10)', cost: 10 },
            { value: 'ancon', label: 'Anc√≥n (+$10)', cost: 10 }
        ];

        const services = [
            { id: 'service_facepaint', name: 'Pintacaritas', price: 45, description: 'Servicio profesional de pintacaritas en Panam√° con pinturas hipoalerg√©nicas. Transformamos a los ni√±os en sus personajes favoritos. Servicio por 1 hora.', image: 'https://i.ibb.co/Kj8pkBJP/IMG-20250711-211956.jpg', isHourly: true },
            { id: 'service_balloons', name: 'Globoflexia', price: 40, description: 'Figuras divertidas y creativas hechas con globos para cada invitado en Panam√°. Arte con globos profesional. Servicio por 1 hora.', image: 'https://i.ibb.co/3nNBDNh/1000156690-f40525f3ffe7fcc4f65d41f55096c0bc-Editado-20250808-161453-0000.jpg', isHourly: true },
            { id: 'service_snacks', name: 'M√°quinas de Snack', price: 100, description: 'Alquiler de m√°quinas de algod√≥n de az√∫car y palomitas para fiestas en Panam√°. Servicio por 3 horas.', image: 'https://i.ibb.co/ycF665wh/1000166060-468200627b3f51bc4bbb7d47cc634544-Editado-20250812-132914-0000.jpg' },
            { id: 'service_inflatable', name: 'Alquiler de Inflables', price: 90, description: 'Alquiler de inflables seguros para fiestas infantiles en Panam√° por 4 horas.', image: 'https://i.ibb.co/zWqyrbKP/1000171895-1915883b5932d9d77d10e75b74d8102b-Editado-20250812-133521-0000.jpg' },
            { id: 'service_magic', name: 'Show de Magia C√≥mica', price: 100, description: '1.5 horas de espect√°culo interactivo que asombrar√° a todos. Incluye figuras con globos.', image: 'https://i.ibb.co/Gvwbr34b/1000166148-07728f00941825383160a10b58da6f49-Editado-Editado-20250808-161017-0000.jpg' },
            { 
                id: 'service_characters', 
                name: 'Personajes Tem√°ticos', 
                type: 'character-group',
                description: '¬°Sorprende a todos con la visita de tu personaje favorito! Elige los que quieras y a√±√°delos a tu carrito.',
                characters: [
                    { id: 'char_mickey', name: 'Personaje: Mickey Mouse', price: 75, image: 'https://i.ibb.co/qMzjGmVP/1000115409-2be9f20a9f4b71257a0ef39431ce5e81-Editado-20250812-145651-0000.jpg' },
                    { id: 'char_minnie', name: 'Personaje: Minnie Mouse', price: 75, image: 'https://i.ibb.co/7J86Pshb/1000173618-c8140aed0fade6ffd165667c35177481-Editado-20250812-152335-0000.jpg' },
                    { id: 'char_mario', name: 'Personaje: Mario Bros', price: 75, image: 'https://i.ibb.co/V0L3smxc/9bc62c03-03f6-4693-be31-1ee6fc9cabaf-20250812-145204-0000.jpg' },
                    { id: 'char_stitch', name: 'Personaje: Stitch', price: 75, image: 'https://i.ibb.co/39pNmTvD/1000173616-67a0a0a93ba9656714e1d4090d078cf7-Editado-20250812-145043-0000.jpg' }
                ]
            },
            { id: 'service_workshop', name: 'Mini Taller de Manualidades', price: 12.00, description: 'Taller creativo con 2 manualidades, mobiliario, recreadora y materiales. M√≠nimo 10 ni√±os.', image: 'https://i.ibb.co/ynXVt81f/IMG-20250709-164447.jpg', isPerChild: true },
            { id: 'service_decor', name: 'Decoraciones Tem√°ticas', price: 100, description: 'Decoraciones profesionales para fiestas infantiles en Panam√°. Transformamos cualquier espacio en un mundo m√°gico.', image: 'https://i.ibb.co/p61CY7CW/IMG-20250624-WA0000.jpg' }
        ];

        const animatorPackages = [
            { id: 'animator_basic', name: 'Plan B√°sico (Animador)', price: 70, services: ['1 Animador profesional', 'Animaci√≥n infantil', 'Juegos y concursos', 'Figuras con globos', 'Romper la pi√±ata'], description: '1h de diversi√≥n con animador profesional en Panam√°: juegos, globos, pi√±ata. ¬°R√°pido y alegre!', image: 'https://i.ibb.co/Kcz1xx4K/IMG-20240420-WA0038.jpg' },
            { id: 'animator_recreative', name: 'Plan Recreativo (Animador)', price: 95, services: ['Animador profesional', 'Pintacaritas b√°sica (1 hora)', 'Animaci√≥n infantil (1 hora)', 'Juegos y concursos', 'Figuras con globos', 'Romper la pi√±ata'], description: '2h de aventura con animador en Panam√°: pintacaritas b√°sica, animaci√≥n, juegos, globos, pi√±ata. ¬°Inolvidable!', image: 'https://i.ibb.co/KzqY2dxd/1000166059-19d1c374d1a4d6d9e0386ce90dc0be60-Editado-Editado-20250808-142449-0000.jpg' }
        ];

        const clownPackages = [
            { id: 'clown_circus', name: 'Paquete Circo', price: 85, services: ['Payaso profesional', 'Integraci√≥n de ni√±os y adultos', 'Juegos y concursos', 'Figuras b√°sicas con globos', 'Canto de cumplea√±os', 'Romper la pi√±ata'], description: '1.5h de risas garantizadas en Panam√° con nuestro Payaso Risitas, lleno de juegos y humor profesional.', image: 'https://i.ibb.co/XZSZ4zTV/1000071229-68972d392b6b1b8ff16caa7bd7f56686-Editado-20250808-152555-0000.jpg' },
            { id: 'clown_recreative', name: 'Plan Recreativo (Payaso)', price: 110, services: ['1 Payasito profesional', '1 Pintacaritas (1 hora)', 'Animaci√≥n infantil (1 hora)', 'Juegos y concursos', 'Figuras con globos', 'Romper la pi√±ata', 'Canto de cumplea√±os'], description: '2h de aventura con payaso en Panam√°: pintacaritas, animaci√≥n, juegos, globos, pi√±ata. ¬°Inolvidable!', image: 'https://i.ibb.co/ZRBN0mb5/2913b329-e65a-4574-846d-03d72a8ed6e1-20250808-145823-0000.jpg' },
            { id: 'clown_magic', name: 'Plan Magic (Payaso)', price: 135, services: ['1 Payaso profesional', 'Animaci√≥n, juegos y concursos (1.5 horas)', '1 Pintacaritas (1 hora)', 'Show de magia c√≥mica', 'Asistencia para la pi√±ata', 'Canto de cumplea√±os'], description: '2.5h premium con payaso en Panam√°: juegos, pintacaritas, magia c√≥mica, asistencia de pi√±ata. ¬°Tu fiesta perfecta!', image: 'https://i.ibb.co/Gvwbr34b/1000166148-07728f00941825383160a10b58da6f49-Editado-Editado-20250808-161017-0000.jpg' },
            { id: 'clown_diverty', name: 'Plan Diverty (Payaso)', price: 200, services: ['1 Payaso profesional', 'Juegos y concursos', '1 Pintacaritas', 'Globoflexia', 'Show de Burbujas Gigantes', 'Asistencia en la pi√±ata', 'Canto de cumplea√±os'], description: '3h de diversi√≥n completa en Panam√°: Payaso, juegos, pintacaritas, globoflexia, show de burbujas, y asistencia pi√±ata. ¬°La magia garantizada!', image: 'https://i.ibb.co/JXbv2Hy/1000099577-6bef3c87bff7ee22e2b0606e02467bf8-Editado-20250808-150335-0000.jpg' }
        ];

        const bubblePackages = [
            { id: 'bubble_party', name: 'Paquete Fiesta Burbuja Completa', price: 190, services: ['Animaci√≥n infantil', 'Juegos y concursos', 'Payasito o Animador', 'Show de Burbujas Gigantes', 'Romper la pi√±ata'], description: '2 horas de diversi√≥n completa en Panam√° con animaci√≥n, juegos, payasito, show de burbujas gigantes y pi√±ata.', image: 'https://i.ibb.co/p6gZT5JD/d8f8cf5e-4117-4f65-990e-43730827aa41-20250412-012526-0000.jpg' },
            { id: 'bubble_premium', name: 'Show de Burbujas Premium', price: 150, services: ['Burbujas gigantes', 'Humo', 'Burbujas LED', 'Interacci√≥n con el p√∫blico', 'Fotos dentro de la burbuja', 'Trucos con burbujas', 'Burbujas de espuma'], description: '1 hora de show profesional en Panam√° con burbujas gigantes, humo, LED, interacci√≥n, fotos, trucos y espuma.', image: 'https://i.ibb.co/MJQgpHx/IMG-20250706-172005.jpg' },
            { id: 'bubble_corporate', name: 'Show Corporativo/Especial', price: 220, services: ['Show personalizado para centros comerciales, colegios o eventos grandes', 'Luces especiales'], description: '1 hora de show personalizable en Panam√° para eventos corporativos, centros comerciales o colegios, con luces especiales.', image: 'https://i.ibb.co/qLdys8KJ/IMG-20250711-195845.jpg' }
        ];

        const gallery = [
            { image: 'https://i.ibb.co/Kj8pkBJP/IMG-20250711-211956.jpg', alt: 'Pintacaritas profesional de mariposa en fiesta infantil en Panam√°', category: 'pintacaritas' },
            { image: 'https://i.ibb.co/21gCBMm3/IMG-20230423-173048-1.jpg', alt: 'Animador creando figuras con globos para ni√±os en La Chorrera', category: 'globoflexia' },
            { image: 'https://i.ibb.co/MJQgpHx/IMG-20250706-172005.jpg', alt: 'Espectacular show de burbujas gigantes en evento en Panam√° Centro', category: 'burbujas' },
            { image: 'https://i.ibb.co/p61CY7CW/IMG-20250624-WA0000.jpg', alt: 'Decoraci√≥n de cumplea√±os tem√°tica de superh√©roes en Arraij√°n', category: 'decoracion' },
            { image: 'https://i.ibb.co/nqvDyb7Y/IMG-20250623-WA0019.jpg', alt: 'Personaje de Mario Bros animando fiesta infantil en Panam√° Norte', category: 'personajes' },
            { image: 'https://i.ibb.co/ynXVt81f/IMG-20250709-164447.jpg', alt: 'Ni√±os participando en taller de manualidades en Pacora, Panam√°', category: 'talleres' },
            { image: 'https://i.ibb.co/p6gZT5JD/d8f8cf5e-4117-4f65-990e-43730827aa41-20250412-012526-0000.jpg', alt: 'Fiesta completa con payaso y show de burbujas en Panam√° Este', category: 'burbujas' },
            { image: 'https://i.ibb.co/qLdys8KJ/IMG-20250711-195845.jpg', alt: 'Show de Diverty Eventos para evento corporativo en Anc√≥n', category: 'corporativo' }
        ];

        const blogPosts = [
            { id: 'blog1', title: 'Las 7 Tem√°ticas de Fiestas Infantiles m√°s Pedidas en Panam√° para 2025', description: 'Descubre las tem√°ticas que est√°n arrasando en las fiestas infantiles de Panam√° este a√±o. Gu√≠a completa para padres paname√±os.', image: 'https://i.ibb.co/LX4wC8zS/file-0000000009586230bcad512887ad5a53-1.png', date: '2024-12-15', author: 'Equipo Diverty Panam√°', content: `<p>Organizar una fiesta infantil en Panam√° es una aventura emocionante. Para 2025, las tendencias en el pa√≠s son fascinantes. Aqu√≠ te presentamos las 7 tem√°ticas m√°s pedidas en Panam√° Centro, Arraij√°n, La Chorrera, Pacora y Panam√° Norte:</p><h3>1. El Mundo M√°gico de Encanto</h3><p>Inspirada en la pel√≠cula de Disney, esta tem√°tica llena de color colombiano es perfecta para so√±adores paname√±os. Muy popular en Panam√° Centro.</p><h3>2. Aventura con Bluey</h3><p>La popular perrita Bluey trae juegos interactivos perfectos para el clima de Panam√°. Ideal para fiestas al aire libre en Arraij√°n y Pacora.</p><h3>3. Superh√©roes al Rescate</h3><p>Los cl√°sicos nunca pasan de moda en Panam√°. Spiderman, Batman y la Mujer Maravilla siguen siendo los favoritos en La Chorrera y Panam√° Norte.</p><h3>4. Princesas con un Toque Moderno</h3><p>Las princesas de Disney reinventadas con actividades que empoderan a las ni√±as paname√±as. Muy solicitado en todas nuestras zonas de cobertura.</p><h3>5. Exploradores de Dinosaurios</h3><p>Un viaje prehist√≥rico perfecto para el clima tropical de Panam√°, con decoraciones de dinosaurios que fascinan a los ni√±os.</p><h3>6. Fiesta de Videojuegos (Minecraft/Mario Bros)</h3><p>Para los peque√±os gamers paname√±os, una fiesta inspirada en Minecraft o Mario Bros es garant√≠a de diversi√≥n en cualquier zona de Panam√°.</p><h3>7. Unicornios y Fantas√≠a</h3><p>La magia de los unicornios y arco√≠ris sigue cautivando a las ni√±as paname√±as, creando un ambiente de ensue√±o tropical.</p><p>En Diverty Eventos Panam√°, podemos ayudarte a hacer realidad cualquiera de estas tem√°ticas en Panam√° Centro, Arraij√°n, La Chorrera, Pacora y Panam√° Norte. ¬°Cont√°ctanos!</p><a href="#clowns" class="btn-premium btn-primary nav-action mt-6">Ver Paquetes de Personajes</a>`},
            { id: 'blog2', title: 'Shows de Burbujas Gigantes en Panam√°: La Tendencia que Enamorar√° a Todos', description: 'Descubre por qu√© los shows de burbujas gigantes son el entretenimiento m√°s buscado para fiestas infantiles en Panam√°.', image: 'https://i.ibb.co/7J5JM84n/file-000000003a0461fa918e3a8f30f312e2.png', date: '2024-12-10', author: 'Equipo Diverty Panam√°', content: `<p>Si buscas un show que deje a todos con la boca abierta en Panam√°, ¬°el show de burbujas gigantes es la respuesta perfecta! Ha ganado una popularidad inmensa en todo el pa√≠s por su capacidad de asombrar tanto a ni√±os como adultos.</p><h3>¬øQu√© lo hace tan especial en Panam√°?</h3><ul><li><strong>Magia Visual Tropical:</strong> Las burbujas de tama√±os incre√≠bles crean un espect√°culo hipnotizante perfecto para el ambiente paname√±o.</li><li><strong>Interactividad Total:</strong> Los ni√±os paname√±os no solo observan, ¬°participan! Pueden entrar en una burbuja gigante para una foto inolvidable.</li><li><strong>Momentos √önicos:</strong> Las fotos con burbujas son recuerdos que durar√°n para siempre en las familias paname√±as.</li><li><strong>Diversi√≥n para Todas las Edades:</strong> Es un entretenimiento que une a toda la familia paname√±a, desde los m√°s peque√±os hasta los abuelos.</li><li><strong>Perfecto para el Clima:</strong> Funciona excelentemente tanto en interiores como exteriores, adapt√°ndose al clima tropical de Panam√°.</li></ul><p>En Diverty Eventos, somos los especialistas en shows de burbujas gigantes en Panam√° Centro, Arraij√°n, La Chorrera, Pacora y Panam√° Norte. ¬°A√±ade este toque m√°gico a tu fiesta paname√±a!</p><a href="#bubbles" class="btn-premium btn-secondary nav-action mt-6">Ver Shows de Burbujas</a>`},
            { id: 'blog3', title: 'Errores Comunes al Planear una Fiesta Infantil en Panam√° (y C√≥mo Evitarlos)', description: 'Gu√≠a pr√°ctica para padres paname√±os: descubre los errores m√°s frecuentes al organizar una fiesta infantil en Panam√° y c√≥mo evitarlos.', image: 'https://i.ibb.co/gb4WkYzD/aichat-423527.jpg', date: '2024-12-05', author: 'Equipo Diverty Panam√°', content: `<p>Planear la fiesta infantil perfecta en Panam√° puede ser un desaf√≠o √∫nico. El clima tropical, las tradiciones locales y las expectativas familiares pueden complicar la organizaci√≥n. Queremos que todo salga m√°gico, pero a menudo se cometen errores que pueden convertir la diversi√≥n en estr√©s. Aqu√≠ te mostramos los m√°s comunes en Panam√° y c√≥mo evitarlos:</p><h3>1. No considerar el clima tropical de Panam√°</h3><p>Uno de los mayores errores es no planificar considerando el calor y la humedad t√≠picos de Panam√°.</p><p><strong>C√≥mo evitarlo:</strong> Elige horarios m√°s frescos (ma√±ana temprano o tarde), asegura buena ventilaci√≥n, y ten bebidas frescas siempre disponibles.</p><h3>2. No tener un presupuesto adaptado a Panam√°</h3><p>Los costos en Panam√° pueden variar seg√∫n la zona. Lo que cuesta en Panam√° Centro puede ser diferente en Arraij√°n o La Chorrera.</p><p><strong>C√≥mo evitarlo:</strong> Investiga precios locales, considera costos de transporte entre zonas, y establece un presupuesto realista para tu √°rea.</p><h3>3. Ignorar las tradiciones paname√±as</h3><p>No incorporar elementos culturales paname√±os puede hacer que la fiesta se sienta gen√©rica.</p><p><strong>C√≥mo evitarlo:</strong> Incluye m√∫sica t√≠pica paname√±a, comidas tradicionales adaptadas para ni√±os, y celebra la rica cultura local.</p><h3>4. Subestimar el entretenimiento profesional</h3><p>Una fiesta infantil en Panam√° sin entretenimiento adecuado puede decaer r√°pidamente, especialmente con el calor.</p><p><strong>C√≥mo evitarlo:</strong> Contrata profesionales locales como Diverty Eventos. Un animador, payaso o show de burbujas paname√±o puede mantener a todos frescos y entretenidos.</p><p>En Diverty Eventos Panam√°, conocemos perfectamente estos desaf√≠os y estamos aqu√≠ para ayudarte a evitar estos errores. Servimos en Panam√° Centro, Arraij√°n, La Chorrera, Pacora y Panam√° Norte, garantizando que la fiesta de tus hijos sea un √©xito rotundo adaptado a nuestra hermosa cultura paname√±a.</p><a href="#services" class="btn-premium btn-tertiary nav-action mt-6">Ver Todos los Servicios</a>`}
        ];

        const customerReviews = [
            { id: 1, name: "Mar√≠a Gonz√°lez - Panam√° Centro", rating: 5, comment: "Excelente servicio en Panam√° Centro, los ni√±os quedaron encantados con el show de burbujas. Muy profesionales y puntuales. Recomendado 100% para fiestas en Panam√°.", date: "2024-11-20", service: "Show de Burbujas Premium", avatar: "https://i.pravatar.cc/48?img=1", location: "Panam√° Centro" },
            { id: 2, name: "Carlos Mendoza - Arraij√°n", rating: 5, comment: "Muy profesionales en Arraij√°n, llegaron puntuales y la animaci√≥n fue incre√≠ble. Los ni√±os no pararon de re√≠r. Diverty es lo mejor en fiestas infantiles de Panam√°.", date: "2024-11-15", service: "Plan Recreativo (Payaso)", avatar: "https://i.pravatar.cc/48?img=2", location: "Arraij√°n" },
            { id: 3, name: "Ana Rodr√≠guez - La Chorrera", rating: 5, comment: "La pintacaritas en La Chorrera fue un √©xito total. Los dise√±os eran hermosos y los ni√±os estaban felices. El mejor servicio de entretenimiento infantil en Panam√°.", date: "2024-11-10", service: "Pintacaritas", avatar: "https://i.pravatar.cc/48?img=3", location: "La Chorrera" },
            { id: 4, name: "Roberto Silva - Pacora", rating: 5, comment: "Contratamos el Plan Diverty para una fiesta en Pacora y fue espectacular. Vale cada centavo, s√∫per recomendado para toda la familia paname√±a.", date: "2024-11-05", service: "Plan Diverty (Payaso)", avatar: "https://i.pravatar.cc/48?img=4", location: "Pacora" },
            { id: 5, name: "Luc√≠a Herrera - Panam√° Norte", rating: 5, comment: "El taller de manualidades en Panam√° Norte fue perfecto para el cumplea√±os de mi hija. Muy organizados y los ni√±os aprendieron mucho. Excelente servicio paname√±o.", date: "2024-10-28", service: "Mini Taller de Manualidades", avatar: "https://i.pravatar.cc/48?img=5", location: "Panam√° Norte" },
            { id: 6, name: "Diego Morales - Panam√° Centro", rating: 5, comment: "Los inflables fueron un hit en nuestra fiesta en Panam√° Centro. Los ni√±os jugaron todo el tiempo y los padres pudimos relajarnos. Diverty es lo m√°ximo.", date: "2024-10-20", service: "Alquiler de Inflables", avatar: "https://i.pravatar.cc/48?img=6", location: "Panam√° Centro" }
        ];

        // ================================================================
        // |               L√ìGICA DE LA APLICACI√ìN (app.js)               |
        // ================================================================
        const app = { 
            activeSection: 'home', 
            cart: [], 
            location: 'panama-centro', 
            chatOpen: false
        };
        let bookingFormState = {};

        const applyPromotions = (packages, discountRate, packageIds = []) => {
            const currentDate = new Date();
            const isAugust = currentDate.getMonth() === 7;
            if (isAugust) {
                return packages.map(pkg => {
                    if (packageIds.length === 0 || packageIds.includes(pkg.id)) {
                        return { ...pkg, originalPrice: pkg.price, price: parseFloat((pkg.price * (1 - discountRate)).toFixed(2)), discountApplied: true, discountMessage: `¬°${Math.round(discountRate * 100)}% OFF!` };
                    }
                    return pkg;
                });
            }
            return packages;
        };

        const bubblePackagesWithDiscount = applyPromotions(bubblePackages, 0.10, []);
        const clownPackagesWithDiscount = applyPromotions(clownPackages, 0.10, ['clown_diverty']);
        const allServices = [...services, ...animatorPackages, ...clownPackagesWithDiscount, ...bubblePackagesWithDiscount];
        
        const characterItems = services.find(s => s.type === 'character-group')?.characters || [];
        const allPurchasableItems = [...services.filter(s => s.type !== 'character-group'), ...animatorPackages, ...clownPackages, ...bubblePackages, ...characterItems];


        const $ = (selector) => document.querySelector(selector);
        const $$ = (selector) => document.querySelectorAll(selector);
        
        function showToast(message, type = 'info') {
            const toast = $('#toast');
            toast.className = `show ${type}`;
            toast.innerHTML = `<i data-lucide="${type === 'success' ? 'check-circle' : 'info'}"></i> ${message}`;
            lucide.createIcons();
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
        const showModal = (modalId) => $(`#${modalId}`).classList.add('show');
        const hideModal = (modalId) => $(`#${modalId}`).classList.remove('show');

        const popSound = new Tone.MembraneSynth({ pitchDecay: 0.01, octaves: 6, envelope: { attack: 0.001, decay: 0.3, sustain: 0.01, release: 0.2, }, }).toDestination();
        let isSoundPlaying = false;

        function playPopSound() {
            if (isSoundPlaying) return;
            if (Tone.context.state !== 'running') {
                Tone.start();
            }
            popSound.triggerAttackRelease("C2", "8n", Tone.now());
            isSoundPlaying = true;
            setTimeout(() => { isSoundPlaying = false; }, 100);
        }

        function addToCart(item, quantity = 1) {
            playPopSound();
            const existing = app.cart.find(i => i.id === item.id);
            if (existing) {
                existing.quantity += quantity;
            } else {
                app.cart.push({ ...item, quantity });
            }
            updateCartUI();
            showToast(`${item.name} a√±adido al carrito`, 'success');
            const cartIcon = $('#cart-icon-container');
            if(cartIcon) {
                cartIcon.classList.add('cart-icon-shake');
                setTimeout(() => cartIcon.classList.remove('cart-icon-shake'), 500);
            }
            window.dataLayer.push({ event: 'add_to_cart', ecommerce: { items: [{ item_id: item.id, item_name: item.name, price: item.price, quantity: quantity }] } });
        }

        function removeFromCart(itemId) {
            playPopSound();
            app.cart = app.cart.filter(i => i.id !== itemId);
            updateCartUI();
            showToast('Producto eliminado', 'info');
        }

        function calculateTransportCost(locationValue) {
            const location = locations.find(l => l.value === locationValue);
            return location ? location.cost : 0;
        }

        function updateCartUI() {
            const count = app.cart.reduce((sum, item) => sum + item.quantity, 0);
            const total = app.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const transportCost = calculateTransportCost(app.location);
            const finalTotal = total + transportCost;
            
            $('#itemCount').textContent = count;
            $('#totalPrice').textContent = `$${total.toFixed(2)}`;
            count > 0 ? $('#cartSummary').classList.remove('hidden') : $('#cartSummary').classList.add('hidden');

            const cartItemsContainer = $('#cartItems');
            if (cartItemsContainer) {
                if (app.cart.length === 0) {
                    cartItemsContainer.innerHTML = '<p class="text-center opacity-70">Tu carrito est√° vac√≠o</p>';
                } else {
                    cartItemsContainer.innerHTML = app.cart.map(item => `
                        <div class="flex justify-between items-center py-3 border-b border-white border-opacity-20">
                            <img src="${item.image}" alt="Imagen de ${item.name}" class="w-12 h-12 object-cover rounded-lg mr-4" loading="lazy">
                            <span class="text-sm flex-1">${item.name} (x${item.quantity})</span>
                            <div class="flex items-center gap-3">
                                <span class="font-bold">$${(item.price * item.quantity).toFixed(2)}</span>
                                <button data-action="remove-from-cart" data-item-id="${item.id}" class="text-red-300 hover:text-red-100" aria-label="Eliminar ${item.name}"><i data-lucide="x-circle" class="w-4 h-4"></i></button>
                            </div>
                        </div>`).join('');
                }
            }
            $('#cartTotal').textContent = `$${total.toFixed(2)}`;
            $('#transportCost').textContent = `$${transportCost.toFixed(2)}`;
            $('#finalTotal').textContent = `$${finalTotal.toFixed(2)}`;
            populateLocationSelects();
            if ($('#cartLocation')) $('#cartLocation').value = app.location;
            lucide.createIcons();
        }

        let calculatorItems = [];
        function openCalculator() {
            showModal('calculatorModal');
            renderCalculatorServices();
            updateCalculatorTotal();
        }

        function renderCalculatorServices() {
            const servicesHtml = allServices.map(service => `
                <div class="bg-white bg-opacity-20 rounded-xl p-4 mb-3">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="font-bold text-sm">${service.name}</h4>
                        <span class="text-lg font-bold text-yellow-300">$${service.price}</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <button data-action="change-calc-qty" data-item-id="${service.id}" data-change="-1" class="w-8 h-8 bg-red-500 hover:bg-red-600 rounded-full flex items-center justify-center"><i data-lucide="minus" class="w-4 h-4"></i></button>
                        <span id="calc-qty-${service.id}" class="text-lg font-bold min-w-[2rem] text-center">0</span>
                        <button data-action="change-calc-qty" data-item-id="${service.id}" data-change="1" class="w-8 h-8 bg-green-500 hover:bg-green-600 rounded-full flex items-center justify-center"><i data-lucide="plus" class="w-4 h-4"></i></button>
                    </div>
                </div>`).join('');
            $('#calculatorServices').innerHTML = servicesHtml;
            lucide.createIcons();
        }

        function changeCalculatorQuantity(serviceId, change) {
            const service = allServices.find(s => s.id === serviceId);
            if (!service) return;
            const existingItem = calculatorItems.find(item => item.id === serviceId);
            if (existingItem) {
                existingItem.quantity = Math.max(0, existingItem.quantity + change);
                if (existingItem.quantity === 0) calculatorItems = calculatorItems.filter(item => item.id !== serviceId);
            } else if (change > 0) {
                calculatorItems.push({ ...service, quantity: 1 });
            }
            const qtyElement = $(`#calc-qty-${service.id}`);
            if(qtyElement) qtyElement.textContent = calculatorItems.find(item => item.id === serviceId)?.quantity || 0;
            updateCalculatorTotal();
        }

        function updateCalculatorTotal() {
            const subtotal = calculatorItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const location = $('#calculatorLocation').value;
            const transportCost = calculateTransportCost(location);
            const total = subtotal + transportCost;
            $('#calcSubtotal').textContent = `$${subtotal.toFixed(2)}`;
            $('#calcTransport').textContent = `$${transportCost.toFixed(2)}`;
            $('#calcTotal').textContent = `$${total.toFixed(2)}`;
        }

        function addCalculatedToCart() {
            if (calculatorItems.length === 0) { showToast('Selecciona al menos un servicio', 'error'); return; }
            calculatorItems.forEach(item => { if(item.quantity > 0) addToCart(item, item.quantity); });
            hideModal('calculatorModal');
            showToast(`${calculatorItems.length} tipos de servicio agregados al carrito`, 'success');
            calculatorItems = [];
        }

        async function callGeminiAPI(chatHistory, generationConfig = null) {
            const apiKey = "AIzaSyDodScQKDGDHU1otAhZTJpZpRY5NltSFYE";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = { contents: chatHistory };
            if (generationConfig) payload.generationConfig = generationConfig;
            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                const result = await response.json();
                if (!response.ok) throw new Error(result?.error?.message || `Error de API: ${response.status}`);
                const textResponse = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (textResponse) {
                    if (generationConfig?.responseMimeType === "application/json") {
                        try { return JSON.parse(textResponse); }
                        catch (e) { throw new Error("La IA devolvi√≥ una respuesta en un formato inesperado."); }
                    }
                    return textResponse;
                }
                throw new Error("No se recibi√≥ una respuesta de texto de la IA.");
            } catch (error) {
                console.error("Error al llamar a la API de Gemini:", error);
                return { error: true, responseText: "¬°Ups! üéà Tuve un problema para conectarme. Por favor, intenta de nuevo." };
            }
        }

        function executeBotAction(action) {
            if (!action || !action.type) return;
            switch (action.type) {
                case 'addToCart':
                    const itemToAdd = allServices.find(s => s.id === action.itemId);
                    if (itemToAdd) {
                        const quantity = action.quantity || 1;
                        if (itemToAdd.isHourly) {
                            const hourlyItem = { ...itemToAdd, id: `${itemToAdd.id}_${quantity}h`, name: `${itemToAdd.name} (${quantity} horas)`, price: itemToAdd.price * quantity, quantity: 1 };
                            addToCart(hourlyItem);
                        } else if (itemToAdd.isPerChild) {
                            if (quantity < 10) { showToast('El taller requiere un m√≠nimo de 10 ni√±os.', 'error'); return; }
                            const workshopItem = { ...itemToAdd, id: `${itemToAdd.id}_${quantity}kids`, name: `${itemToAdd.name} (${quantity} ni√±os)`, price: itemToAdd.price * quantity, quantity: 1 };
                            addToCart(workshopItem);
                        } else {
                            addToCart(itemToAdd, quantity);
                        }
                        showModal('cartModal');
                    }
                    break;
                case 'navigateTo':
                    setActiveSection(action.sectionId);
                    break;
            }
        }

        function initChat() {
            const chatInput = $('#chatInput');
            const sendBtn = $('#sendChat');
            const messagesContainer = $('#chatMessages');
            let chatHistory = [];
            function addMessage(text, role) {
                const messageDiv = document.createElement('div');
                const isUser = role === 'user';
                messageDiv.className = isUser ? 'mb-4 p-4 rounded-2xl bg-purple-600 text-white ml-8' : 'mb-4 p-4 rounded-2xl bg-purple-100 text-purple-800 mr-8';
                const header = isUser ? `<div class="flex items-center gap-3 mb-3 justify-end"><span class="text-sm font-semibold text-white opacity-90">T√∫</span><div class="w-8 h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center"><i data-lucide="user" class="w-4 h-4 text-white"></i></div></div>` : `<div class="flex items-center gap-3 mb-3"><div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center"><i data-lucide="bot" class="w-4 h-4 text-white"></i></div><span class="text-sm font-semibold text-purple-800">DivertyBot</span></div>`;
                messageDiv.innerHTML = `${header}<p class="text-sm">${text}</p>`;
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                lucide.createIcons();
            }
            async function sendMessage() {
                const messageText = chatInput.value.trim();
                if (!messageText) return;
                addMessage(messageText, 'user');
                if (chatHistory.length === 0) {
                    const systemPrompt = `Eres DivertyBot, un asistente amigable y √∫til para "Diverty Eventos", una empresa de planificaci√≥n de fiestas infantiles en Panam√°. Tu objetivo es responder preguntas, ayudar a los usuarios a navegar por el sitio y agregar servicios al carrito. Conoces los siguientes servicios y paquetes: ${JSON.stringify(allServices)}. Conoces las siguientes ubicaciones: ${JSON.stringify(locations)}. S√© breve y divertido. Debes responder siempre en el formato JSON solicitado.`;
                    chatHistory.push({ role: 'user', parts: [{ text: systemPrompt }] });
                    chatHistory.push({ role: 'model', parts: [{ text: "¬°Entendido! Estoy listo para ayudar a planificar la mejor fiesta en Panam√° y responder√© en formato JSON." }] });
                }
                chatHistory.push({ role: 'user', parts: [{ text: messageText }] });
                chatInput.value = '';
                const loadingMsg = document.createElement('div');
                loadingMsg.id = 'loading-message';
                loadingMsg.className = 'mb-4 p-4 rounded-2xl bg-purple-100 text-purple-800 mr-8';
                loadingMsg.innerHTML = `<div class="flex items-center gap-3 mb-3"><div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center"><i data-lucide="bot" class="w-4 h-4 text-white"></i></div><span class="text-sm font-semibold text-purple-800">DivertyBot</span></div><p class="text-sm">Pensando... ‚ú®</p>`;
                messagesContainer.appendChild(loadingMsg);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                lucide.createIcons();
                const chatbotGenerationConfig = {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "responseText": { "type": "STRING", "description": "Tu respuesta corta y amigable para el usuario, sin mencionar precios." },
                            "action": {
                                "type": "OBJECT", "description": "La acci√≥n a ejecutar (opcional).",
                                "properties": {
                                    "type": { "type": "STRING", "enum": ["addToCart", "navigateTo"], "description": "El tipo de acci√≥n." },
                                    "itemId": { "type": "STRING", "description": "El ID √∫nico del servicio a agregar (ej: 'clown_magic')." },
                                    "quantity": { "type": "NUMBER", "description": "La cantidad (para servicios por hora o por ni√±o)." },
                                    "sectionId": { "type": "STRING", "description": "El ID de la secci√≥n a la que navegar (ej: 'clowns')." }
                                }
                            }
                        }
                    }
                };
                const response = await callGeminiAPI(chatHistory, chatbotGenerationConfig);
                loadingMsg.remove();
                if (response && response.responseText && !response.error) {
                    addMessage(response.responseText, 'model');
                    chatHistory.push({ role: 'model', parts: [{ text: JSON.stringify(response) }] });
                    if (response.action) executeBotAction(response.action);
                } else {
                    addMessage(response.responseText || "Lo siento, no pude procesar tu solicitud en este momento.", 'model');
                }
                if (chatHistory.length > 8) chatHistory = chatHistory.slice(-8);
            }
            sendBtn.onclick = sendMessage;
            chatInput.onkeypress = (e) => { if (e.key === 'Enter') sendMessage(); };
            $$('.quick-question').forEach(btn => {
                btn.onclick = () => { chatInput.value = btn.dataset.question; sendMessage(); };
            });
        }

        function setActiveSection(sectionId) {
            if (!sectionId) sectionId = 'home';

            const noticeShown = sessionStorage.getItem('bookingNoticeShown');
            if (sectionId === 'booking' && !noticeShown) {
                sessionStorage.setItem('bookingNoticeShown', 'true');
                showModal('bookingConfirmModal');
                return;
            }

            const mainContent = $('#mainContent');
            
            if (sectionId !== 'home') {
                mainContent.innerHTML = `<div id="loading-placeholder" class="flex items-center justify-center h-full pt-20"><div class="text-center"><div class="loading-spinner"></div><p class="mt-6 text-purple-700 font-semibold text-lg">Cargando...</p></div></div>`;
            }

            setTimeout(() => {
                app.activeSection = sectionId;
                $$('.nav-link, .mobile-nav-link, .mobile-nav-link-bottom').forEach(link => link.classList.remove('active'));
                const navMap = { home: ['#navHome', '#mobileHome'], services: ['#navServices', '#mobileServices'], ideas: ['#navIdeas', '#mobileIdeas'], animators: ['#navAnimators', '#mobileAnimators'], clowns: ['#navClowns', '#mobileClowns'], bubbles: ['#navBubbles', '#mobileBubbles'], gallery: ['#navGallery', '#mobileGallery'], blog: ['#navBlog', '#mobileBlog'], reviews: ['#navReviews', '#mobileReviews'], booking: ['#navBooking', '#mobileBooking'] };
                navMap[sectionId]?.forEach(selector => $(selector)?.classList.add('active'));
                $$(`.mobile-nav-link-bottom[href="#${sectionId}"]`).forEach(link => link.classList.add('active'));
                const sections = { home: renderHome, services: renderServices, ideas: renderIdeaGenerator, animators: renderAnimators, clowns: renderClowns, bubbles: renderBubbles, gallery: renderGallery, blog: renderBlog, reviews: renderReviews, booking: renderBooking };
                
                if (sectionId !== 'home' && sections[sectionId]) {
                    sections[sectionId]();
                } else if (sectionId === 'home') {
                     if(!$('#hero-section-identifier')) renderHome();
                }

                toggleMobileMenu(false);
                if(sectionId === 'home') window.scrollTo(0, 0);
            }, 50);
        }

        function renderHome() {
            const featuredPackage = allServices.find(s => s.id === 'clown_diverty');
            let priceHTML = `<span class="text-3xl font-bold text-gray-800">$${featuredPackage.price.toFixed(0)}</span>`;
            if (featuredPackage.discountApplied) {
                priceHTML = `
                    <div class="flex items-baseline justify-center gap-3">
                        <span class="text-2xl font-bold text-gray-400 line-through">$${featuredPackage.originalPrice.toFixed(0)}</span>
                        <span class="text-4xl font-extrabold text-green-600">$${featuredPackage.price.toFixed(0)}</span>
                    </div>
                `;
            }

            $('#mainContent').innerHTML = `
                <div id="hero-section-identifier">
                    <section class="hero-section animate-slide-up">
                        <div class="hero-overlay"></div>
                        <video autoplay loop muted playsinline poster="https://res.cloudinary.com/dv40hkeyz/video/upload/v1723578146/20250813_151416_0001_p5lwst.jpg" preload="metadata">
                            <source src="https://res.cloudinary.com/dv40hkeyz/video/upload/v1723578146/20250813_151416_0001_p5lwst.mp4" type="video/mp4">
                            Tu navegador no soporta la etiqueta de video.
                        </video>
                        <div class="hero-content">
                            <h1 class="text-3xl sm:text-4xl lg:text-6xl font-bold mb-6 font-nunito">üéâ ¬°Las Mejores Fiestas Infantiles en Panam√°! üéà</h1>
                            <p class="text-lg sm:text-xl lg:text-2xl mb-10 opacity-90">Especialistas en animaci√≥n, shows de burbujas y entretenimiento infantil en Panam√° Centro, Panam√° Este, Arraij√°n, La Chorrera, Anc√≥n, Pacora y Panam√° Norte. ¬°M√°s de 500 fiestas realizadas!</p>
                            <div class="grid grid-cols-2 sm:flex sm:flex-row justify-center gap-4">
                                <a href="#services" class="btn-premium btn-primary nav-action text-base py-3 px-6"><i data-lucide="sparkles"></i>Servicios</a>
                                <a href="#animators" class="btn-premium btn-tertiary nav-action text-base py-3 px-6"><i data-lucide="user-check"></i>Animadores</a>
                                <a href="#clowns" class="btn-premium btn-warning nav-action text-base py-3 px-6"><i data-lucide="smile"></i>Payasos</a>
                                <a href="#bubbles" class="btn-premium btn-secondary nav-action text-base py-3 px-6"><i data-lucide="wind"></i>Burbujas</a>
                            </div>
                        </div>
                        <div class="wavy-divider">
                            <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none">
                                <path d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z" class="shape-fill"></path>
                            </svg>
                        </div>
                    </section>

                    <div class="container mx-auto px-4">
                        <section class="my-12 animate-slide-up">
                            <div class="bg-white rounded-3xl shadow-lg overflow-hidden">
                                <div class="relative">
                                    <img src="${featuredPackage.image}" alt="${featuredPackage.name}" class="w-full h-64 object-cover" loading="lazy">
                                    ${featuredPackage.discountApplied ? `<div class="absolute top-4 right-4 bg-pink-500 text-white text-sm font-bold px-4 py-1.5 rounded-full shadow-lg animate-pulse">${featuredPackage.discountMessage}</div>` : ''}
                                    <div class="absolute bottom-4 left-4 right-4 bg-white/90 backdrop-blur-sm p-3 rounded-xl text-center shadow-md">
                                        ${priceHTML}
                                    </div>
                                </div>
                                <div class="p-6">
                                    <h2 class="text-sm font-bold uppercase text-purple-500 tracking-widest mb-2">Paquete Destacado del Mes</h2>
                                    <h3 class="text-2xl font-extrabold text-gray-800 mb-3 font-poppins">${featuredPackage.name}</h3>
                                    <p class="text-gray-600 mb-4 text-sm">${featuredPackage.description}</p>
                                    <ul class="space-y-2 text-gray-700 text-sm mb-6">
                                        ${featuredPackage.services.map(s => `<li class="flex items-center"><i data-lucide="check" class="w-5 h-5 mr-3 text-green-500 flex-shrink-0"></i><span>${s}</span></li>`).join('')}
                                    </ul>
                                    <button data-action="add-to-cart" data-item-id="${featuredPackage.id}" class="w-full btn-premium btn-primary py-4 text-lg"><i data-lucide="shopping-cart"></i>¬°Lo Quiero!</button>
                                </div>
                            </div>
                        </section>

                        <div class="stats-grid">
                            <div class="stat-card animate-slide-up"><div class="stat-number">500+</div><div class="text-gray-600 font-semibold">Fiestas en Panam√°</div><div class="text-xs text-green-600 mt-2">‚úÖ Todas las zonas</div></div>
                            <div class="stat-card animate-slide-up"><div class="stat-number">4.9‚≠ê</div><div class="text-gray-600 font-semibold">Calificaci√≥n</div><div class="text-xs text-blue-600 mt-2">üìà 127+ rese√±as</div></div>
                            <div class="stat-card animate-slide-up"><div class="stat-number">6</div><div class="text-gray-600 font-semibold">Zonas de Panam√°</div><div class="text-xs text-purple-600 mt-2">üöó Centro, Este, Oeste, Norte, Anc√≥n</div></div>
                            <div class="stat-card animate-slide-up"><div class="stat-number">24/7</div><div class="text-gray-600 font-semibold">Atenci√≥n</div><div class="text-xs text-orange-600 mt-2">üì± WhatsApp +507 6667-7965</div></div>
                        </div>
                    </div>
                    
                    <section class="coverage-area animate-slide-up">
                         <div class="wavy-divider top">
                            <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none">
                                <path d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z" class="shape-fill"></path>
                            </svg>
                        </div>
                        <div class="relative z-10 container mx-auto px-4">
                            <h2 class="text-3xl lg:text-4xl font-bold mb-4 font-nunito">üó∫Ô∏è Zonas que Cubrimos en Panam√°</h2>
                            <p class="text-lg mb-6 opacity-90">Llevamos la diversi√≥n a toda el √°rea metropolitana de Panam√°</p>
                            <div class="coverage-grid">
                                <div class="coverage-item"><h3 class="font-bold text-lg mb-2">üìç Panam√° Centro</h3><p class="text-sm opacity-90">Transporte GRATIS</p><p class="text-xs mt-1">Juan D√≠az, San Miguelito, El Cangrejo, San Francisco</p></div>
                                <div class="coverage-item"><h3 class="font-bold text-lg mb-2">üìç Arraij√°n</h3><p class="text-sm opacity-90">Transporte +$15</p><p class="text-xs mt-1">Arraij√°n Centro</p></div>
                                <div class="coverage-item"><h3 class="font-bold text-lg mb-2">üìç La Chorrera</h3><p class="text-sm opacity-90">Transporte +$15</p><p class="text-xs mt-1">La Chorrera Centro</p></div>
                                <div class="coverage-item"><h3 class="font-bold text-lg mb-2">üìç Panam√° Norte</h3><p class="text-sm opacity-90">Transporte +$10</p><p class="text-xs mt-1">La Cabima, Villa Grecia</p></div>
                                <div class="coverage-item"><h3 class="font-bold text-lg mb-2">üìç Panam√° Este</h3><p class="text-sm opacity-90">Transporte +$10</p><p class="text-xs mt-1">Pacora, 24 de Diciembre</p></div>
                                <div class="coverage-item"><h3 class="font-bold text-lg mb-2">üìç Anc√≥n</h3><p class="text-sm opacity-90">Transporte +$10</p><p class="text-xs mt-1">Albrook, Clayton</p></div>
                            </div>
                            <div class="text-center mt-8"><a href="https://wa.me/50766677965?text=Hola! Quiero consultar sobre servicios de fiestas infantiles en Panam√°" class="btn-premium bg-white text-purple-600" target="_blank" rel="noopener noreferrer"><i data-lucide="phone"></i>Consulta tu Zona en WhatsApp</a></div>
                        </div>
                    </section>
                </div>`;
            lucide.createIcons();
        }

        function createDetailedCardHTML(item, index) {
            const isPackage = !!item.services;
            const isBlog = !!item.author;
            const isCharacterSelector = item.type === 'character-group';
            const title = item.name || item.title;
            let priceDisplayHTML = '';
            
            if (item.price || (isCharacterSelector && item.characters[0].price)) {
                const price = isCharacterSelector ? item.characters[0].price : item.price;
                if (item.discountApplied) {
                    priceDisplayHTML = `<div class="absolute top-4 right-4 text-right"><span class="bg-pink-500 text-white text-sm font-bold px-3 py-1.5 rounded-full shadow-lg animate-pulse">${item.discountMessage}</span><div class="mt-2 bg-white/80 backdrop-blur-sm p-2 rounded-lg"><span class="text-gray-500 line-through text-xl font-poppins">$${item.originalPrice.toFixed(0)}</span><span class="text-green-600 text-3xl font-bold font-poppins ml-2">$${item.price.toFixed(0)}</span></div></div>`;
                } else {
                    priceDisplayHTML = `<div class="absolute top-4 right-4 bg-purple-600 text-white text-lg font-bold font-poppins py-2 px-4 rounded-full shadow-lg">$${price.toFixed(0)}${item.isHourly ? '/hr' : ''}${item.isPerChild ? '/ni√±o' : ''}</div>`;
                }
            }

            const imageHTML = isCharacterSelector 
                ? '' // No main image for the group card
                : item.image ? `<div class="relative"><img src="${item.image}" alt="${title}" class="w-full h-48 object-cover" loading="lazy" width="400" height="267" onerror="this.onerror=null;this.src='https://placehold.co/400x267/cccccc/ffffff?text=Imagen+no+disponible';">${priceDisplayHTML}</div>` : '';
            
            let actionButton;
            if (isBlog) {
                actionButton = `<button data-action="show-blog" data-item-id="${item.id}" class="w-full btn-premium btn-primary mt-auto">Leer M√°s</button>`;
            } else if (item.isHourly) {
                actionButton = `<div class="mt-auto"><div class="flex items-center justify-center gap-4 mb-4"><button data-action="change-service-qty" data-item-id="${item.id}" data-change="-1" class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center">-</button><span id="qty-${item.id}" class="text-2xl font-bold w-12 text-center">1</span><button data-action="change-service-qty" data-item-id="${item.id}" data-change="1" class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center">+</button></div><button data-action="add-hourly-to-cart" data-item-id="${item.id}" class="w-full btn-premium btn-primary">A√±adir</button></div>`;
            } else if (item.isPerChild) {
                actionButton = `<div class="mt-auto"><div class="form-group mb-4"><label for="qty-${item.id}" class="form-label text-center text-sm font-semibold text-gray-600 block mb-2"># de Ni√±os (m√≠n. 10):</label><input type="number" id="qty-${item.id}" class="form-input text-center w-full" value="10" min="10"></div><button data-action="add-workshop-to-cart" data-item-id="${item.id}" class="w-full btn-premium btn-primary">A√±adir</button></div>`;
            } else if (isCharacterSelector) {
                const characterCardsHTML = item.characters.map(char => `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg mb-2">
                        <img src="${char.image}" alt="${char.name}" class="w-16 h-16 rounded-md object-cover mr-4" loading="lazy">
                        <div class="flex-1">
                            <p class="font-bold text-gray-800">${char.name.replace('Personaje: ', '')}</p>
                            <p class="font-bold text-purple-600">$${char.price.toFixed(2)}</p>
                        </div>
                        <button data-action="add-to-cart" data-item-id="${char.id}" class="btn-premium btn-primary !p-0 !w-12 !h-12 !rounded-full"><i data-lucide="plus"></i></button>
                    </div>
                `).join('');
                return `<div class="card-detailed bg-white rounded-3xl shadow-lg flex flex-col h-full overflow-hidden animate-slide-up w-[80vw] max-w-[340px] sm:w-auto md:w-full flex-shrink-0 snap-center" style="animation-delay: ${index * 100}ms;">
                            <div class="p-6 flex flex-col flex-grow">
                                <h3 class="text-xl font-bold mb-2 text-gray-800 font-poppins">${title}</h3>
                                <p class="text-gray-600 mb-4 text-sm leading-relaxed">${item.description}</p>
                                <div class="mt-auto">${characterCardsHTML}</div>
                            </div>
                        </div>`;
            } else {
                actionButton = `<button data-action="add-to-cart" data-item-id="${item.id}" class="w-full btn-premium btn-primary mt-auto">A√±adir al Carrito</button>`;
            }
            const servicesListHTML = isPackage ? `<ul class="space-y-2 text-gray-700 text-sm mb-6 flex-grow">${item.services.map(s => `<li class="flex items-start"><i data-lucide="check" class="w-4 h-4 mr-2 text-green-500 mt-1 flex-shrink-0"></i><span>${s}</span></li>`).join('')}</ul>` : '';
            const blogMetaHTML = isBlog ? `<div class="flex items-center text-xs text-gray-500 mb-3"><i data-lucide="calendar" class="w-4 h-4 mr-2"></i>${item.date}<span class="mx-2">|</span><i data-lucide="user" class="w-4 h-4 mr-2"></i>${item.author}</div>` : '';
            return `<div class="card-detailed bg-white rounded-3xl shadow-lg flex flex-col h-full overflow-hidden animate-slide-up w-[80vw] max-w-[340px] sm:w-auto md:w-full flex-shrink-0 snap-center" style="animation-delay: ${index * 100}ms;">${imageHTML}<div class="p-6 flex flex-col flex-grow">${blogMetaHTML}<h3 class="text-xl font-bold mb-2 text-gray-800 font-poppins">${title}</h3><p class="text-gray-600 mb-4 text-sm leading-relaxed ${!isPackage && !isBlog && !item.isHourly && !item.isPerChild ? 'flex-grow' : ''}">${item.description}</p>${servicesListHTML}${actionButton}</div></div>`;
        }

        function renderSection(items, title, icon) {
            const itemsHtml = items.map(createDetailedCardHTML).join('');
            $('#mainContent').innerHTML = `<div class="container mx-auto px-4"><section class="my-8"><h2 class="text-3xl lg:text-5xl font-bold text-center mb-12 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent font-nunito">${title} en Panam√° <i data-lucide="${icon}" class="inline-block text-purple-600"></i></h2><div class="flex overflow-x-auto snap-x snap-mandatory scroll-smooth pb-4 gap-6 md:grid md:grid-cols-2 xl:grid-cols-3 hide-scrollbar -mx-4 px-4">${itemsHtml}</div></section></div>`;
            lucide.createIcons();
        }

        const renderServices = () => renderSection(services, 'Nuestros Servicios', 'sparkles');
        const renderAnimators = () => renderSection(animatorPackages, 'Paquetes de Animadores', 'user-check');
        const renderClowns = () => renderSection(clownPackagesWithDiscount, 'Paquetes de Payasos', 'smile');
        const renderBubbles = () => renderSection(bubblePackagesWithDiscount, 'Paquetes de Burbujas', 'wind');
        const renderBlog = () => renderSection(blogPosts, 'Blog de Fiestas Infantiles', 'book-open');

        function renderGallery() {
            const galleryHtml = gallery.map((item, index) => `<a href="${item.image}" data-lightbox="gallery" data-title="${item.alt}" class="gallery-item animate-slide-up" style="animation-delay: ${index * 50}ms;"><img src="${item.image}" alt="${item.alt}" loading="lazy" width="300" height="300" onerror="this.onerror=null;this.src='https://placehold.co/300x300/cccccc/ffffff?text=Error';"></a>`).join('');
            $('#mainContent').innerHTML = `<div class="container mx-auto px-4"><section class="my-8 animate-slide-up">
                <h2 class="text-3xl lg:text-5xl font-bold text-center mb-8 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">Momentos M√°gicos en Instagram</h2>
                <p class="text-center text-gray-600 max-w-2xl mx-auto mb-8">¬°S√≠guenos en <a href="https://www.instagram.com/diverty_eventos_pty" target="_blank" class="text-pink-500 font-bold hover:underline" rel="noopener noreferrer">@diverty_eventos_pty</a> para ver nuestras √∫ltimas fiestas y promociones!</p>
                <div class="gallery-grid">${galleryHtml}</div>
                <div class="text-center mt-12">
                    <a href="https://www.instagram.com/diverty_eventos_pty" target="_blank" class="btn-premium btn-primary" rel="noopener noreferrer"><i data-lucide="instagram"></i>Ver m√°s en Instagram</a>
                </div>
            </section></div>`;
            lucide.createIcons();
        }
        
        function renderReviews() {
            const reviewsHtml = customerReviews.map((review, index) => `
                <div class="review-card animate-slide-up" style="animation-delay: ${index * 100}ms;">
                    <div class="review-header">
                        <img src="${review.avatar}" alt="${review.name}" class="review-avatar" loading="lazy" width="48" height="48">
                        <div>
                            <div class="review-user">${review.name}</div>
                            <div class="review-location">${review.location}</div>
                        </div>
                    </div>
                    <div class="review-body">
                        <p>"${review.comment}"</p>
                    </div>
                    <div class="review-footer">
                        <div class="review-rating">${'‚≠ê'.repeat(review.rating)}</div>
                        <div class="verified-badge">
                            <i data-lucide="check-circle" class="w-4 h-4 mr-1"></i>
                            Cliente Verificado
                        </div>
                    </div>
                </div>`).join('');
            $('#mainContent').innerHTML = `<div class="container mx-auto px-4"><section class="my-8"><h2 class="text-3xl lg:text-5xl font-bold text-center mb-12 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent font-nunito">‚≠ê Lo que dicen nuestros clientes</h2><div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8">${reviewsHtml}</div><div class="text-center mt-12"><a href="https://www.google.com/search?q=diverty+eventos+panama+rese√±as" target="_blank" class="btn-premium btn-tertiary" rel="noopener noreferrer"><i data-lucide="external-link"></i>Ver m√°s rese√±as</a></div></section></div>`;
            lucide.createIcons();
        }

        function initReviewsCarousel() {
            const carousel = $('#reviews-carousel');
            const dotsContainer = $('#reviews-dots');
            if (!carousel || customerReviews.length === 0) return;
            
            const totalSlides = customerReviews.length;
            let currentIndex = 0;
            let intervalId;

            // Create dots
            for (let i = 0; i < totalSlides; i++) {
                const dot = document.createElement('button');
                dot.classList.add('w-3', 'h-3', 'rounded-full', 'bg-gray-300', 'transition-colors');
                dot.dataset.index = i;
                dotsContainer.appendChild(dot);
            }
            const dots = $$('#reviews-dots button');

            function updateCarousel() {
                carousel.style.transform = `translateX(-${currentIndex * 100}%)`;
                dots.forEach((dot, index) => {
                    dot.classList.toggle('bg-purple-600', index === currentIndex);
                });
            }

            function showNext() {
                currentIndex = (currentIndex + 1) % totalSlides;
                updateCarousel();
            }

            function startCarousel() {
                intervalId = setInterval(showNext, 5000);
            }

            function stopCarousel() {
                clearInterval(intervalId);
            }

            dots.forEach(dot => {
                dot.addEventListener('click', () => {
                    stopCarousel();
                    currentIndex = parseInt(dot.dataset.index);
                    updateCarousel();
                    startCarousel();
                });
            });

            carousel.addEventListener('mouseenter', stopCarousel);
            carousel.addEventListener('mouseleave', startCarousel);

            updateCarousel();
            startCarousel();
        }

        function saveBookingFormState() {
            const form = $('#bookingForm');
            if (form) {
                const formData = new FormData(form);
                bookingFormState = Object.fromEntries(formData.entries());
            }
        }
        function restoreBookingFormState() {
            const form = $('#bookingForm');
            if (form && Object.keys(bookingFormState).length > 0) {
                for (const key in bookingFormState) {
                    if (form.elements[key]) form.elements[key].value = bookingFormState[key];
                }
            }
        }
        function createJotFormData(formData, cartData) {
            const servicesText = cartData.map(item => `${item.name} (x${item.quantity}) - $${(item.price * item.quantity).toFixed(2)}`).join('\n');
            const total = cartData.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const transportCost = calculateTransportCost(app.location);
            const finalTotal = total + transportCost;
            return {
                'nombreCompleto': formData.get('name') || '', 'emailCliente': formData.get('email') || '', 'telefonoCliente': formData.get('phone') || '', 'fechaEvento': formData.get('date') || '', 'tipoEvento': formData.get('eventType') || '', 'ubicacionPanama': formData.get('location') || '', 'numeroInvitados': formData.get('guests') || '', 'horaEvento': formData.get('time') || '', 'direccionCompleta': formData.get('address') || '', 'serviciosSeleccionados': servicesText, 'subtotalReserva': `$${total.toFixed(2)}`, 'costoTransporte': `$${transportCost.toFixed(2)}`, 'totalFinal': `$${finalTotal.toFixed(2)}`, 'comentariosAdicionales': formData.get('comments') || ''
            };
        }
        function submitToJotForm(formData, cartData) {
            const jotformBaseUrl = 'https://form.jotform.com/251611549526054';
            const jotformData = createJotFormData(formData, cartData);
            const params = new URLSearchParams();
            for (const key in jotformData) {
                params.append(key, jotformData[key]);
            }
            const finalUrl = `${jotformBaseUrl}?${params.toString()}`;
            window.open(finalUrl, '_blank');
        }

        function renderBooking() {
            saveBookingFormState();
            const subtotal = app.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const transportCost = calculateTransportCost(app.location);
            const finalTotal = subtotal + transportCost;
            const cartSummary = app.cart.length === 0 ? 
                `<div class="text-center py-6"><div class="text-6xl mb-6">üõí</div><h3 class="text-2xl font-bold">Tu carrito est√° vac√≠o</h3><p class="mb-8 text-gray-600">A√±ade uno de nuestros paquetes m√°s populares para empezar:</p><div class="flex flex-col sm:flex-row justify-center gap-4"><a href="#clowns" class="btn-premium btn-warning nav-action"><i data-lucide="smile"></i>Paquetes de Payasos</a><a href="#bubbles" class="btn-premium btn-secondary nav-action"><i data-lucide="wind"></i>Shows de Burbujas</a></div></div>` 
                : app.cart.map(item => `<div class="flex justify-between bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-xl shadow-sm mb-3"><span class="font-semibold">${item.name} (x${item.quantity})</span><span class="font-bold text-pink-600">$${(item.price * item.quantity).toFixed(2)}</span></div>`).join('');
            const locationOptionsHtml = locations.map(opt => `<option value="${opt.value}" ${app.location === opt.value ? 'selected' : ''}>${opt.label}</option>`).join('');
            
            $('#mainContent').innerHTML = `<div class="container mx-auto px-4"><section class="premium-card p-4 sm:p-8 lg:p-12 my-8">
                <h2 class="text-3xl lg:text-5xl font-bold text-center mb-12 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">Reserva tu Fiesta en Panam√° <i data-lucide="calendar-check" class="inline-block text-purple-600"></i></h2>
                <div class="bg-gradient-to-br from-pink-50 to-purple-50 p-6 sm:p-8 rounded-3xl mb-8 border-2 border-pink-200">
                    <h3 class="text-2xl font-bold text-pink-700 mb-6">Tu Selecci√≥n:</h3>
                    <div id="booking-cart-summary">${cartSummary}</div>
                    ${app.cart.length > 0 ? `<div id="booking-totals" class="mt-6 pt-6 border-t-2 border-pink-200 space-y-2 text-right"><p class="text-lg">Subtotal: <span class="font-bold">$${subtotal.toFixed(2)}</span></p><p class="text-lg">Transporte: <span class="font-bold">$${transportCost.toFixed(2)}</span></p><p class="text-3xl font-bold text-purple-700">Total Final: <span class="font-extrabold">$${finalTotal.toFixed(2)}</span></p></div>` : ''}
                </div>
                ${app.cart.length > 0 ? `<form id="bookingForm" class="space-y-6">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="form-group"><label class="form-label">Nombre *</label><input type="text" name="name" required class="form-input"></div>
                        <div class="form-group"><label class="form-label">Email *</label><input type="email" name="email" required class="form-input"></div>
                        <div class="form-group"><label class="form-label">Tel√©fono *</label><input type="tel" name="phone" required class="form-input"></div>
                        <div class="form-group"><label class="form-label">Fecha *</label><input type="date" name="date" required class="form-input" min="${new Date().toISOString().split('T')[0]}"></div>
                        <div class="form-group"><label class="form-label">Hora del Evento *</label><input type="time" name="time" required class="form-input"></div>
                        <div class="form-group"><label class="form-label">N√∫mero Estimado de Ni√±os</label><input type="number" name="guests" class="form-input" min="1" placeholder="Ej: 25"></div>
                        <div class="form-group"><label class="form-label">Tipo de Evento *</label><select name="eventType" required class="form-input"><option value="">Selecciona una opci√≥n</option><option value="cumpleanos">üéâ Cumplea√±os</option><option value="bautizo">üïäÔ∏è Bautizo</option><option value="comunion">‚úùÔ∏è Comuni√≥n</option><option value="evento_escolar">üéí Evento Escolar</option><option value="evento_corporativo">üè¢ Evento Corporativo</option><option value="dia_del_nino">üéà D√≠a del Ni√±o</option><option value="otro">‚≠ê Otro</option></select></div>
                        <div class="form-group"><label class="form-label">Ubicaci√≥n *</label><select name="location" required class="form-input">${locationOptionsHtml}</select></div>
                    </div>
                    <div class="form-group"><label class="form-label">Direcci√≥n Completa *</label><textarea name="address" required class="form-input" rows="3"></textarea></div>
                    <div class="form-group"><label class="form-label">Comentarios</label><textarea name="comments" class="form-input" rows="4" placeholder="¬øAlguna petici√≥n especial o detalle importante?"></textarea></div>
                    <button type="submit" class="w-full btn-premium btn-primary py-4 text-xl"><i data-lucide="sparkles"></i>Enviar Reserva</button>
                </form>` : ''}
            </section></div>`;
            if (app.cart.length > 0) {
                $('#bookingForm').onsubmit = handleBookingSubmit;
                $('select[name="location"]').onchange = (e) => { app.location = e.target.value; renderBooking(); };
                restoreBookingFormState();
            }
            lucide.createIcons();
        }

        function handleBookingSubmit(e) {
            e.preventDefault();
            if (app.cart.length === 0) { showToast('Selecciona al menos un servicio', 'error'); return; }
            triggerBookingConfetti(); // NEW: Trigger confetti on booking
            const formData = new FormData(e.target);
            submitToJotForm(formData, app.cart);
            showModal('infoModal');
            $('#modalMessage').textContent = '¬°Reserva enviada! Te contactaremos pronto para confirmar.';
            app.cart = [];
            bookingFormState = {};
            updateCartUI();
            renderBooking();
        }

        function showBlogPost(postId) {
            const post = blogPosts.find(p => p.id === postId);
            if (!post) return;
            const modal = document.createElement('div');
            modal.className = 'modal-backdrop show';
            modal.innerHTML = `<div class="modal-content bg-white rounded-3xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto"><button data-action="close-modal" class="absolute top-4 right-4 p-2 rounded-full bg-gray-200 hover:bg-gray-300"><i data-lucide="x"></i></button><h2 class="text-3xl font-bold mb-6">${post.title}</h2><img src="${post.image}" alt="${post.title}" class="w-full h-64 object-cover rounded-2xl mb-6" loading="lazy" width="800" height="256" onerror="this.onerror=null;this.src='https://placehold.co/800x256/cccccc/ffffff?text=Error';"></img><div class="prose max-w-none mb-8">${post.content}</div><div class="flex justify-center"><button data-action="close-modal" class="btn-premium btn-primary"><i data-lucide="x-circle"></i>Cerrar</button></div></div>`;
            document.body.appendChild(modal);
            lucide.createIcons();
        }

        function toggleMobileMenu(show) {
            const menu = $('#mobileMenu');
            const overlay = $('#mobileMenuOverlay');
            if (show) {
                overlay.style.opacity = '1';
                overlay.style.visibility = 'visible';
                menu.classList.add('open');
            } else {
                overlay.style.opacity = '0';
                overlay.style.visibility = 'hidden';
                menu.classList.remove('open');
            }
        }

        function populateLocationSelects() {
            const optionsHtml = locations.map(opt => `<option value="${opt.value}">${opt.label}</option>`).join('');
            $$('#cartLocation, #calculatorLocation, select[name="location"]').forEach(select => {
                if (select) {
                    const currentValue = select.value;
                    select.innerHTML = optionsHtml;
                    if (currentValue) select.value = currentValue;
                }
            });
        }
        
        function handleGlobalClick(e) {
            const target = e.target.closest('[data-action]');
            if (!target) return;
            
            playPopSound(); // Play sound on any action click
            const { action, itemId, change, category } = target.dataset;

            switch (action) {
                case 'add-to-cart':
                    const item = allPurchasableItems.find(s => s.id === itemId);
                    if (item) addToCart(item);
                    break;
                case 'remove-from-cart':
                    removeFromCart(itemId);
                    break;
                case 'add-hourly-to-cart':
                    const serviceHourly = services.find(s => s.id === itemId);
                    const quantityHourly = parseInt($(`#qty-${itemId}`).textContent);
                    if (serviceHourly && quantityHourly > 0) {
                        const item = { ...serviceHourly, id: `${serviceHourly.id}_${quantityHourly}h`, name: `${serviceHourly.name} (${quantityHourly} horas)`, price: serviceHourly.price * quantityHourly, quantity: 1 };
                        addToCart(item);
                    }
                    break;
                case 'add-workshop-to-cart':
                    const serviceWorkshop = services.find(s => s.id === itemId);
                    let quantityWorkshop = parseInt($(`#qty-${item.id}`).value);
                    if (!serviceWorkshop) return;
                    if (quantityWorkshop < 10) {
                        showToast('El taller requiere un m√≠nimo de 10 ni√±os.', 'error');
                        quantityWorkshop = 10;
                        $(`#qty-${item.id}`).value = 10;
                    }
                    const itemWorkshop = { ...serviceWorkshop, id: `${serviceWorkshop.id}_${quantityWorkshop}kids`, name: `${serviceWorkshop.name} (${quantityWorkshop} ni√±os)`, price: serviceWorkshop.price * quantityWorkshop, quantity: 1 };
                    addToCart(itemWorkshop);
                    break;
                case 'change-service-qty':
                    const qtyElement = $(`#qty-${itemId}`);
                    if (qtyElement) {
                        let currentQty = parseInt(qtyElement.textContent);
                        const newQty = Math.max(1, currentQty + parseInt(change));
                        qtyElement.textContent = newQty;
                    }
                    break;
                case 'change-calc-qty':
                    changeCalculatorQuantity(itemId, parseInt(change));
                    break;
                case 'show-blog':
                    showBlogPost(itemId);
                    break;
                case 'filter-gallery':
                    filterGallery(category);
                    break;
                case 'close-modal':
                    const modal = target.closest('.modal-backdrop');
                    if(modal) modal.remove();
                    break;
            }
        }

        function setupEventListeners() {
            document.body.addEventListener('click', handleGlobalClick);
            
            document.body.addEventListener('click', (e) => {
                const navLink = e.target.closest('.nav-action');
                if (navLink && navLink.hash) {
                    e.preventDefault();
                    e.target.closest('.modal-backdrop')?.classList.remove('show');
                    setActiveSection(navLink.hash.substring(1));
                }
            });

            $('#mobileToggle').onclick = () => toggleMobileMenu(true);
            $('#closeMobile').onclick = () => toggleMobileMenu(false);
            $('#mobileMenuOverlay').onclick = () => toggleMobileMenu(false);
            $('#closeModal').onclick = () => hideModal('infoModal');
            $('#viewCart').onclick = () => showModal('cartModal');
            $('#closeCart').onclick = () => hideModal('cartModal');
            $('#chatToggle').onclick = () => showModal('chatModal');
            $('#closeChat').onclick = () => hideModal('chatModal');
            window.addEventListener('scroll', () => {
                const header = $('#mainHeader');
                const scrollPosition = window.scrollY;
                const heroSection = $('.hero-section');
                let heroHeight = heroSection ? heroSection.offsetHeight : 300;
                
                // Adjust opacity based on scroll position
                let opacity = Math.min(scrollPosition / (heroHeight * 0.5), 0.9);
                
                if (scrollPosition > 50) {
                    header.classList.add('scrolled');
                    header.style.background = `rgba(255, 255, 255, ${opacity})`;
                } else {
                    header.classList.remove('scrolled');
                    header.style.background = `rgba(255, 255, 255, 0)`;
                }
            });
            $('#openCalculator').onclick = openCalculator;
            $('#closeCalculator').onclick = () => hideModal('calculatorModal');
            $('#addCalculatedToCart').onclick = addCalculatedToCart;
            
            $('#continueToBookingBtn').onclick = () => {
                hideModal('bookingConfirmModal');
                setActiveSection('booking');
            };

            document.addEventListener('change', e => {
                if (e.target.matches('#cartLocation, #calculatorLocation')) {
                    app.location = e.target.value;
                    updateCartUI();
                    if ($('#calculatorModal').classList.contains('show')) updateCalculatorTotal();
                }
            });
            const promoBanner = $('#promo-banner');
            const closePromoBtn = $('#close-promo-banner');
            if (localStorage.getItem('promoBannerDismissed')) {
                promoBanner.classList.add('hide');
            }
            closePromoBtn.onclick = () => {
                promoBanner.classList.add('hide');
                localStorage.setItem('promoBannerDismissed', 'true');
            };
        }

        function renderIdeaGenerator() {
            $('#mainContent').innerHTML = `<div class="container mx-auto px-4"><section class="premium-card p-4 sm:p-8 lg:p-12 my-8">
                <h2 class="text-3xl lg:text-5xl font-bold text-center mb-8 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">‚ú® Generador de Ideas para Fiestas con IA</h2>
                <p class="text-center text-gray-600 mb-8 max-w-2xl mx-auto">¬øSin inspiraci√≥n? Describe tu fiesta ideal y deja que nuestra IA cree un plan m√°gico para ti. ¬°Es r√°pido, f√°cil y divertido!</p>
                
                <!-- Test Mode Disclaimer -->
                <div class="text-center bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-lg mb-8" role="alert">
                    <p class="font-bold">Modo de Prueba</p>
                    <p>Esta funci√≥n de IA es para fines de demostraci√≥n. Los resultados son generados autom√°ticamente.</p>
                </div>

                <div class="max-w-3xl mx-auto">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div><label class="form-label">Tem√°tica (ej. Superh√©roes)</label><input id="idea-theme" type="text" class="form-input" placeholder="Princesas, Dinosaurios..."></div>
                        <div><label class="form-label">Edad del ni√±o/a</label><input id="idea-age" type="number" class="form-input" placeholder="5"></div>
                        <div><label class="form-label"># de Invitados</label><input id="idea-guests" type="number" class="form-input" placeholder="15"></div>
                    </div>
                    <button id="generate-ideas" class="w-full btn-premium btn-primary py-4 text-xl"><i data-lucide="wand-2"></i>Generar Ideas M√°gicas</button>
                    <div id="idea-results" class="mt-8 p-6 bg-white/50 rounded-2xl shadow-inner min-h-[200px]"></div>
                </div>
            </section></div>`;
            $('#generate-ideas').onclick = generatePartyIdeas;
            lucide.createIcons();
        }

        async function generatePartyIdeas() {
            const theme = $('#idea-theme').value.trim();
            const age = $('#idea-age').value.trim();
            const guests = $('#idea-guests').value.trim();
            if (!theme || !age || !guests) {
                showToast('Por favor, completa todos los campos.', 'error');
                return;
            }
            const button = $('#generate-ideas');
            button.disabled = true;
            button.innerHTML = '<div class="loading-spinner !w-6 !h-6 !border-2 !border-t-white"></div> Generando...';
            const resultsContainer = $('#idea-results');
            resultsContainer.innerHTML = '<div class="flex justify-center items-center p-8"><div class="loading-spinner"></div></div>';
            const prompt = `Como un experto en fiestas infantiles en Panam√°, crea un plan para una fiesta de "${theme}" para un ni√±o/a de ${age} a√±os con ${guests} invitados. Completa el siguiente JSON.`;
            const generationConfig = {
                responseMimeType: "application/json",
                responseSchema: {
                    type: "OBJECT",
                    properties: {
                        "juegos": { "type": "ARRAY", "description": "Lista de 3-4 juegos tem√°ticos divertidos.", "items": { "type": "STRING" } },
                        "decoracion": { "type": "ARRAY", "description": "Lista de 3-4 ideas de decoraci√≥n m√°gica.", "items": { "type": "STRING" } },
                        "comida": { "type": "ARRAY", "description": "Lista de 3-4 ideas de comida y snacks tem√°ticos.", "items": { "type": "STRING" } }
                    },
                    required: ["juegos", "decoracion", "comida"]
                }
            };
            const chatHistory = [{ role: 'user', parts: [{ text: prompt }] }];
            const ideas = await callGeminiAPI(chatHistory, generationConfig);
            if (ideas && ideas.juegos && !ideas.error) {
                resultsContainer.innerHTML = `
                    <h4 class="text-xl font-bold text-purple-700 mt-4 mb-2">Juegos Divertidos</h4><ul class="list-disc pl-5 space-y-1 text-gray-700">${ideas.juegos.map(item => `<li>${item}</li>`).join('')}</ul>
                    <h4 class="text-xl font-bold text-purple-700 mt-4 mb-2">Decoraci√≥n M√°gica</h4><ul class="list-disc pl-5 space-y-1 text-gray-700">${ideas.decoracion.map(item => `<li>${item}</li>`).join('')}</ul>
                    <h4 class="text-xl font-bold text-purple-700 mt-4 mb-2">Comida Tem√°tica</h4><ul class="list-disc pl-5 space-y-1 text-gray-700">${ideas.comida.map(item => `<li>${item}</li>`).join('')}</ul>`;
            } else {
                resultsContainer.innerHTML = `<p class="text-red-600 text-center">${ideas.responseText || 'No se pudieron generar ideas. Intenta de nuevo.'}</p>`;
            }
            button.disabled = false;
            button.innerHTML = '<i data-lucide="wand-2"></i>Generar Ideas M√°gicas';
            lucide.createIcons();
        }

        function initializeSchemas() {
            // EventPlanner Schema
            $('#schema-event-planner').textContent = JSON.stringify({
                "@context": "https://schema.org",
                "@type": "EventPlanner",
                "name": "Diverty Eventos",
                "url": "https://divertyeventos.online/",
                "telephone": "+50766677965",
                "priceRange": "$40-$220",
                "address": {
                    "@type": "PostalAddress",
                    "addressLocality": "Panam√° Centro",
                    "addressRegion": "Panam√°",
                    "addressCountry": "PA"
                },
                "areaServed": ["Panam√° Centro", "Arraij√°n", "La Chorrera", "Panam√° Este", "Panam√° Norte", "Anc√≥n"]
            });

            // FAQ Schema
            $('#schema-faq').textContent = JSON.stringify({
                "@context": "https://schema.org",
                "@type": "FAQPage",
                "mainEntity": [
                    { "@type": "Question", "name": "¬øEn qu√© zonas de Panam√° ofrecen sus servicios?", "acceptedAnswer": { "@type": "Answer", "text": "Ofrecemos nuestros servicios de fiestas infantiles en Panam√° Centro (sin costo de transporte), Arraij√°n (+$15), La Chorrera (+$15), Panam√° Este (+$10), Panam√° Norte (+$10) y Anc√≥n (+$10)." } },
                    { "@type": "Question", "name": "¬øCu√°nto cuesta una fiesta infantil en Panam√°?", "acceptedAnswer": { "@type": "Answer", "text": "Nuestros precios van desde $40 para servicios individuales como globoflexia, hasta $220 para paquetes completos." } }
                ]
            });

            // Product Schema
            const productSchema = allPurchasableItems.map(service => ({
                "@context": "https://schema.org",
                "@type": "Product",
                "name": service.name,
                "image": service.image,
                "description": service.description,
                "brand": {
                    "@type": "Brand",
                    "name": "Diverty Eventos"
                },
                "offers": {
                    "@type": "Offer",
                    "url": `https://divertyeventos.online/#services`,
                    "priceCurrency": "USD",
                    "price": service.price,
                    "availability": "https://schema.org/InStock"
                }
            }));
            $('#schema-products').textContent = JSON.stringify(productSchema);
        }
        
        // --- NEW: Confetti Animation on Booking ---
        function triggerBookingConfetti() {
            const canvas = $('#confetti-canvas');
            const ctx = canvas.getContext('2d');
            let particles = [];
            const colors = ["#7c3aed", "#db2777", "#3b82f6", "#f97316", "#10b981"];
            const particleCount = 200;
            const duration = 3000; // 3 seconds

            class ConfettiParticle {
                constructor() {
                    this.x = canvas.width / 2;
                    this.y = canvas.height / 2;
                    this.size = Math.random() * 6 + 4;
                    this.speed = Math.random() * 8 + 5;
                    this.angle = Math.random() * Math.PI * 2;
                    this.vx = Math.cos(this.angle) * this.speed;
                    this.vy = Math.sin(this.angle) * this.speed;
                    this.color = colors[Math.floor(Math.random() * colors.length)];
                    this.spin = Math.random() * Math.PI * 2;
                    this.spinSpeed = Math.random() * 0.1 - 0.05;
                    this.life = 0;
                    this.maxLife = 100; // Frames
                }
                update() {
                    this.x += this.vx;
                    this.y += this.vy;
                    this.vy += 0.1; // Gravity
                    this.vx *= 0.99; // Air resistance
                    this.spin += this.spinSpeed;
                    this.life++;
                }
                draw() {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.rotate(this.spin);
                    ctx.fillStyle = this.color;
                    ctx.globalAlpha = 1 - (this.life / this.maxLife);
                    ctx.fillRect(-this.size / 2, -this.size / 2, this.size, this.size * 2);
                    ctx.restore();
                }
            }
            
            for (let i = 0; i < particleCount; i++) {
                particles.push(new ConfettiParticle());
            }

            let startTime = Date.now();
            function animate() {
                if (Date.now() - startTime > duration) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    return;
                }
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particles.forEach((p, index) => {
                    p.update();
                    p.draw();
                    if (p.life >= p.maxLife) {
                        particles.splice(index, 1);
                    }
                });
                requestAnimationFrame(animate);
            }
            animate();
        }

        // --- NEW: Magic Cursor ---
        function initMagicCursor() {
            const canvas = document.getElementById('magic-cursor');
            const ctx = canvas.getContext('2d');
            let particles = [];
            const colors = ["#7c3aed", "#db2777", "#3b82f6", "#f97316", "#10b981"];
            let mouse = { x: -100, y: -100 };

            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }

            class Particle {
                constructor(x, y) {
                    this.x = x;
                    this.y = y;
                    this.size = Math.random() * 4 + 1;
                    this.life = 0;
                    this.maxLife = Math.random() * 40 + 30;
                    this.vx = Math.random() * 2 - 1;
                    this.vy = Math.random() * 2 - 1;
                    this.color = colors[Math.floor(Math.random() * colors.length)];
                }
                update() {
                    this.x += this.vx;
                    this.y += this.vy;
                    this.life++;
                }
                draw() {
                    ctx.globalAlpha = 1 - (this.life / this.maxLife);
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particles.forEach((p, index) => {
                    p.update();
                    p.draw();
                    if (p.life >= p.maxLife) {
                        particles.splice(index, 1);
                    }
                });
                requestAnimationFrame(animate);
            }

            window.addEventListener('mousemove', (e) => {
                mouse.x = e.clientX;
                mouse.y = e.clientY;
                for (let i = 0; i < 2; i++) {
                    particles.push(new Particle(mouse.x, mouse.y));
                }
            });
            
            window.addEventListener('resize', resizeCanvas);
            
            resizeCanvas();
            animate();
        }


        // --- INITIALIZE APP ---
        setupEventListeners();
        initChat();
        populateLocationSelects();
        initializeSchemas();
        // Render home content statically on first load
        renderHome(); 
        setActiveSection(window.location.hash.substring(1) || 'home');
        updateCartUI();
        initMagicCursor(); // Start the magic cursor
        lucide.createIcons();
    });
    </script>
</body>
</html>
